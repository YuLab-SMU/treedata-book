<!DOCTYPE html>
<html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Chapter 3 Exporting tree with data | Data Integration, Manipulation and Visualization of Phylogenetic Trees</title>
<meta name="author" content="Guangchuang Yu">
<meta name="description" content="3.1 Introduction The treeio package (Wang et al., 2020) supports parsing various phylogenetic tree file formats including software outputs that contain evolutionary evidence. Some of the formats...">
<meta name="generator" content="bookdown 0.26 with bs4_book()">
<meta property="og:title" content="Chapter 3 Exporting tree with data | Data Integration, Manipulation and Visualization of Phylogenetic Trees">
<meta property="og:type" content="book">
<meta property="og:image" content="/book-cover.png">
<meta property="og:description" content="3.1 Introduction The treeio package (Wang et al., 2020) supports parsing various phylogenetic tree file formats including software outputs that contain evolutionary evidence. Some of the formats...">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Chapter 3 Exporting tree with data | Data Integration, Manipulation and Visualization of Phylogenetic Trees">
<meta name="twitter:description" content="3.1 Introduction The treeio package (Wang et al., 2020) supports parsing various phylogenetic tree file formats including software outputs that contain evolutionary evidence. Some of the formats...">
<meta name="twitter:image" content="/book-cover.png">
<!-- JS --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://kit.fontawesome.com/6ecbd6c532.js" crossorigin="anonymous"></script><script src="libs/jquery/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="libs/bootstrap/bootstrap.min.css" rel="stylesheet">
<script src="libs/bootstrap/bootstrap.bundle.min.js"></script><script src="libs/bs3compat/transition.js"></script><script src="libs/bs3compat/tabs.js"></script><script src="libs/bs3compat/bs3compat.js"></script><link href="libs/bs4_book/bs4_book.css" rel="stylesheet">
<script src="libs/bs4_book/bs4_book.js"></script><script src="libs/kePrint/kePrint.js"></script><link href="libs/lightable/lightable.css" rel="stylesheet">
<script src="libs/htmlwidgets/htmlwidgets.js"></script><script src="libs/pathseg/pathseg.js"></script><script src="libs/comic/comic.min.js"></script><script src="libs/comicR-binding/comicR.js"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- CSS --><style type="text/css">
    
    div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
  </style>
<style type="text/css">
    /* Used with Pandoc 2.11+ new --citeproc when CSL is used */
    div.csl-bib-body { }
    div.csl-entry {
      clear: both;
        }
    .hanging div.csl-entry {
      margin-left:2em;
      text-indent:-2em;
    }
    div.csl-left-margin {
      min-width:2em;
      float:left;
    }
    div.csl-right-inline {
      margin-left:2em;
      padding-left:1em;
    }
    div.csl-indent {
      margin-left: 2em;
    }
  </style>
</head>
<body data-spy="scroll" data-target="#toc">

<div class="container-fluid">
<div class="row">
  <header class="col-sm-12 col-lg-3 sidebar sidebar-book"><a class="sr-only sr-only-focusable" href="#content">Skip to main content</a>

    <div class="d-flex align-items-start justify-content-between">
      <h1>
        <a href="index.html" title="">Data Integration, Manipulation and Visualization of Phylogenetic Trees</a>
      </h1>
      <button class="btn btn-outline-primary d-lg-none ml-2 mt-1" type="button" data-toggle="collapse" data-target="#main-nav" aria-expanded="true" aria-controls="main-nav"><i class="fas fa-bars"></i><span class="sr-only">Show table of contents</span></button>
    </div>

    <div id="main-nav" class="collapse-lg">
      <form role="search">
        <input id="search" class="form-control" type="search" placeholder="Search" aria-label="Search">
</form>

      <nav aria-label="Table of contents"><h2>Table of contents</h2>
        <ul class="book-toc list-unstyled">
<li><a class="" href="index.html">Preface</a></li>
<li><a class="" href="author.html">About the Author</a></li>
<li class="book-part">Part I: Tree data input, output, and manipulation</li>
<li><a class="" href="chapter1.html"><span class="header-section-number">1</span> Importing Tree with Data</a></li>
<li><a class="" href="chapter2.html"><span class="header-section-number">2</span> Manipulating Tree with Data</a></li>
<li><a class="active" href="chapter3.html"><span class="header-section-number">3</span> Exporting tree with data</a></li>
<li class="book-part">Part II: Tree data visualization and annotation</li>
<li><a class="" href="chapter4.html"><span class="header-section-number">4</span> Phylogenetic Tree Visualization</a></li>
<li><a class="" href="chapter5.html"><span class="header-section-number">5</span> Phylogenetic Tree Annotation</a></li>
<li><a class="" href="chapter6.html"><span class="header-section-number">6</span> Visual Exploration of Phylogenetic Trees</a></li>
<li><a class="" href="chapter7.html"><span class="header-section-number">7</span> Plotting tree with data</a></li>
<li><a class="" href="chapter8.html"><span class="header-section-number">8</span> Annotating Tree with Silhouette Images and Sub-plots</a></li>
<li><a class="" href="chapter9.html"><span class="header-section-number">9</span> ggtree for Other Tree-like Objects</a></li>
<li class="book-part">Part III: ggtree extensions</li>
<li><a class="" href="chapter10.html"><span class="header-section-number">10</span> ggtreeExtra for Presenting Data on a Circular Layout</a></li>
<li><a class="" href="chapter11.html"><span class="header-section-number">11</span> Other ggtree Extensions</a></li>
<li class="book-part">Part IV: Miscellaneous topics</li>
<li><a class="" href="chapter12.html"><span class="header-section-number">12</span> ggtree Utilities</a></li>
<li><a class="" href="chapter13.html"><span class="header-section-number">13</span> Gallery of Reproducible Examples</a></li>
<li class="book-part">Appendix</li>
<li><a class="" href="faq.html"><span class="header-section-number">A</span> Frequently Asked Questions</a></li>
<li><a class="" href="related-tools.html"><span class="header-section-number">B</span> Related Tools</a></li>
<li><a class="" href="figures-and-tables.html"><span class="header-section-number">C</span> Figures and Tables</a></li>
<li><a class="" href="publications-of-the-ggtree-package-suite.html"><span class="header-section-number">D</span> Publications of the ggtree Package Suite</a></li>
<li><a class="" href="references.html">References</a></li>
</ul>

        <div class="book-extra">
          
        </div>
      </nav>
</div>
  </header><main class="col-sm-12 col-md-9 col-lg-7" id="content"><div id="chapter3" class="section level1" number="3">
<h1>
<span class="header-section-number">3</span> Exporting tree with data<a class="anchor" aria-label="anchor" href="#chapter3"><i class="fas fa-link"></i></a>
</h1>
<div id="introduction" class="section level2" number="3.1">
<h2>
<span class="header-section-number">3.1</span> Introduction<a class="anchor" aria-label="anchor" href="#introduction"><i class="fas fa-link"></i></a>
</h2>
<p>The <a href="http://bioconductor.org/packages/treeio"><strong>treeio</strong></a> package <span class="citation">(<a href="references.html#ref-wang_treeio_2020" role="doc-biblioref">Wang et al., 2020</a>)</span> supports parsing various phylogenetic tree file formats including software outputs that contain evolutionary evidence. Some of the formats are just log files
(<em>e.g.</em>, <a href="http://abacus.gene.ucl.ac.uk/software/paml.html"><strong>PAML</strong></a>
and <a href="http://loco.biosci.arizona.edu/r8s/"><strong>r8s</strong></a> output), while some of the others are
non-standard formats (<em>e.g.</em>, <a href="http://beast2.org/"><strong>BEAST</strong></a>
and <a href="http://nbisweden.github.io/MrBayes/"><strong>MrBayes</strong></a> output that introduce a square
bracket, which was reserved to store comments in standard Nexus format, to store
inferences). With <a href="http://bioconductor.org/packages/treeio"><strong>treeio</strong></a>, we are
now able to parse these files to extract phylogenetic trees and map associated
data on the tree structure. Exporting tree structure is easy, users can use
the <code>as.phyo()</code> method defined in <a href="http://bioconductor.org/packages/treeio"><strong>treeio</strong></a> to
convert a <code>treedata</code> object to a <code>phylo</code> object and then use <code><a href="https://rdrr.io/pkg/ape/man/write.tree.html">write.tree()</a></code> or
<code><a href="https://rdrr.io/pkg/ape/man/write.nexus.html">write.nexus()</a></code> implemented
in <a href="https://CRAN.R-project.org/package=ape"><strong>ape</strong></a> package
<span class="citation">(<a href="references.html#ref-paradis_ape_2004" role="doc-biblioref">Paradis et al., 2004</a>)</span> to export the tree structure as Newick text or Nexus file.
This is quite useful for converting non-standard formats to a standard format and
for extracting trees from software outputs, such as log files.</p>
<p>However, exporting a tree with associated data is still challenging. These
associated data can be parsed from analysis programs or obtained from external
sources (<em>e.g.</em>, phenotypic data, experimental data, and clinical data). The major
obstacle here is that there is no standard format designed for storing a
tree with data. <a href="http://www.nexml.org/">NeXML</a> <span class="citation">(<a href="references.html#ref-vos_nexml:_2012" role="doc-biblioref">Vos et al., 2012</a>)</span> may be the most
flexible format. However, it is currently not widely supported. Most of the
analysis programs in this field rely extensively on Newick string and Nexus
format. In my opinion, although <a href="http://beast.community/nexus_metacomments">BEAST Nexus
format</a> may not be the best solution,
it is currently a good approach for storing heterogeneous associated data. The
beauty of the format is that all the annotated elements are stored within square
brackets, which are reserved for comments. In this way, existing programs that can read standard Nexus format are able to parse it by ignoring the annotated elements.</p>
</div>
<div id="exporting-tree-data-to-beast-nexus-format" class="section level2" number="3.2">
<h2>
<span class="header-section-number">3.2</span> Exporting Tree Data to <em>BEAST</em> Nexus Format<a class="anchor" aria-label="anchor" href="#exporting-tree-data-to-beast-nexus-format"><i class="fas fa-link"></i></a>
</h2>
<div id="exportingconverting-software-output" class="section level3" number="3.2.1">
<h3>
<span class="header-section-number">3.2.1</span> Exporting/converting software output<a class="anchor" aria-label="anchor" href="#exportingconverting-software-output"><i class="fas fa-link"></i></a>
</h3>
<p>The <a href="http://bioconductor.org/packages/treeio"><strong>treeio</strong></a> package <span class="citation">(<a href="references.html#ref-wang_treeio_2020" role="doc-biblioref">Wang et al., 2020</a>)</span> provides the <code><a href="https://docs.ropensci.org/treeio/reference/write.beast.html">write.beast()</a></code> function to export <code>treedata</code> object as BEAST Nexus file <span class="citation">(<a href="references.html#ref-bouckaert_beast_2014" role="doc-biblioref">Bouckaert et al., 2014</a>)</span>.
With <a href="http://bioconductor.org/packages/treeio"><strong>treeio</strong></a>, it is easy to convert
software output to BEAST format if the output can be parsed
by <a href="http://bioconductor.org/packages/treeio"><strong>treeio</strong></a> (see <a href="chapter1.html#chapter1">Chapter 1</a>).</p>
<p>Here is an example of converting NHX file to BEAST format:</p>
<div class="sourceCode" id="cb111"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">nhxfile</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/system.file.html">system.file</a></span><span class="op">(</span><span class="st">"extdata/NHX"</span>, <span class="st">"phyldog.nhx"</span>, package<span class="op">=</span><span class="st">"treeio"</span><span class="op">)</span>
<span class="va">nhx</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://docs.ropensci.org/treeio/reference/read.nhx.html">read.nhx</a></span><span class="op">(</span><span class="va">nhxfile</span><span class="op">)</span>
<span class="co"># write.beast(nhx, file = "phyldog.tree")</span>
<span class="fu"><a href="https://docs.ropensci.org/treeio/reference/write.beast.html">write.beast</a></span><span class="op">(</span><span class="va">nhx</span><span class="op">)</span></code></pre></div>
<pre><code>#NEXUS
[R-package treeio, Thu Oct 14 11:24:19 2021]

BEGIN TAXA;
    DIMENSIONS NTAX = 16;
    TAXLABELS
        Prayidae_D27SS7@2825365
        Kephyes_ovata@2606431
        Chuniphyes_multidentata@1277217
        Apolemia_sp_@1353964
        Bargmannia_amoena@263997
        Bargmannia_elongata@946788
        Physonect_sp_@2066767
        Stephalia_dilata@2960089
        Frillagalma_vityazi@1155031
        Resomia_ornicephala@3111757
        Lychnagalma_utricularia@2253871
        Nanomia_bijuga@717864
        Cordagalma_sp_@1525873
        Rhizophysa_filiformis@3073669
        Hydra_magnipapillata@52244
        Ectopleura_larynx@3556167
    ;
END;
BEGIN TREES;
    TRANSLATE
        1   Prayidae_D27SS7@2825365,
        2   Kephyes_ovata@2606431,
        3   Chuniphyes_multidentata@1277217,
        4   Apolemia_sp_@1353964,
        5   Bargmannia_amoena@263997,
        6   Bargmannia_elongata@946788,
        7   Physonect_sp_@2066767,
        8   Stephalia_dilata@2960089,
        9   Frillagalma_vityazi@1155031,
        10  Resomia_ornicephala@3111757,
        11  Lychnagalma_utricularia@2253871,
        12  Nanomia_bijuga@717864,
        13  Cordagalma_sp_@1525873,
        14  Rhizophysa_filiformis@3073669,
        15  Hydra_magnipapillata@52244,
        16  Ectopleura_larynx@3556167
    ;
    TREE * UNTITLED = [&amp;R] (((1[&amp;Ev=S,ND=0,S=58]:0.0682841,(2[&amp;Ev=S,ND=1,
S=69]:0.0193941,3[&amp;Ev=S,ND=2,S=70]:0.0121378)[&amp;Ev=S,ND=3,S=60]:0.0217782)
[&amp;Ev=S,ND=4,S=36]:0.0607598,((4[&amp;Ev=S,ND=9,S=31]:0.11832,(((5[&amp;Ev=S,ND=10,
S=37]:0.0144549,6[&amp;Ev=S,ND=11,S=38]:0.0149723)[&amp;Ev=S,ND=12,S=33]:0.0925388,
7[&amp;Ev=S,ND=13,S=61]:0.077429)[&amp;Ev=S,ND=14,S=24]:0.0274637,(8[&amp;Ev=S,ND=15,
S=52]:0.0761163,((9[&amp;Ev=S,ND=16,S=53]:0.0906068,10[&amp;Ev=S,ND=17,S=54]:1e-06)
[&amp;Ev=S,ND=18,S=45]:1e-06,((11[&amp;Ev=S,ND=19,S=65]:0.120851,12[&amp;Ev=S,ND=20,
S=71]:0.133939)[&amp;Ev=S,ND=21,S=56]:1e-06,13[&amp;Ev=S,ND=22,S=64]:0.0693814)
[&amp;Ev=S,ND=23,S=46]:1e-06)[&amp;Ev=S,ND=24,S=40]:0.0333823)[&amp;Ev=S,ND=25,S=35]:
1e-06)[&amp;Ev=D,ND=26,S=24]:0.0431861)[&amp;Ev=S,ND=27,S=19]:1e-06,14[&amp;Ev=S,ND=28,
S=26]:0.22283)[&amp;Ev=S,ND=29,S=17]:0.0292362)[&amp;Ev=D,ND=8,S=17]:0.185603,
(15[&amp;Ev=S,ND=5,S=16]:0.0621782,16[&amp;Ev=S,ND=6,S=15]:0.332505)[&amp;Ev=S,ND=7,
S=12]:0.185603)[&amp;Ev=S,ND=30,S=9];
END;</code></pre>
<p>Another example of converting <a href="http://abacus.gene.ucl.ac.uk/software/paml.html"><strong>CODEML</strong></a> output to BEAST format:</p>
<div class="sourceCode" id="cb113"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">mlcfile</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/system.file.html">system.file</a></span><span class="op">(</span><span class="st">"extdata/PAML_Codeml"</span>, <span class="st">"mlc"</span>, package<span class="op">=</span><span class="st">"treeio"</span><span class="op">)</span>
<span class="va">ml</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://docs.ropensci.org/treeio/reference/read.codeml_mlc.html">read.codeml_mlc</a></span><span class="op">(</span><span class="va">mlcfile</span><span class="op">)</span>
<span class="co"># write.beast(ml, file = "codeml.tree")</span>
<span class="fu"><a href="https://docs.ropensci.org/treeio/reference/write.beast.html">write.beast</a></span><span class="op">(</span><span class="va">ml</span><span class="op">)</span> <span class="co"># output not shown</span></code></pre></div>
<p>Some software tools that do not support these outputs can be supported through data conversion. For example, we can convert the NHX file to BEAST file and use NHX tags to color the tree using
<a href="http://beast.community/figtree"><strong>FigTree</strong></a> (Figure <a href="chapter3.html#fig:beastFigtree">3.1</a>A) or convert <a href="http://abacus.gene.ucl.ac.uk/software/paml.html"><strong>CODEML</strong></a> output and use
<em>d<sub>N</sub>/d<sub>S</sub></em>, <em>d<sub>N</sub></em>, or <em>d<sub>S</sub></em> to color the tree in <a href="http://beast.community/figtree"><strong>FigTree</strong></a> (Figure <a href="chapter3.html#fig:beastFigtree">3.1</a>B). Before conversion, these files could not be opened in Figtree. Treeio’s conversion function makes data available to other software tools and expands the application range of these tools.</p>


<div class="figure">
<span style="display:block;" id="fig:beastFigtree"></span>
<img src="treedata_files/figure-html/beastFigtree-1.svg" alt="Visualizing BEAST file in FigTree. Directly visualizing NHX file (A) and CodeML output (B) in FigTree is not supported. treeio can convert these files to BEAST compatible NEXUS format which can be directly opened in FigTree and visualized together with annotated data." width="100%"><p class="caption">
FIGURE 3.1: <strong>Visualizing BEAST file in FigTree.</strong> Directly visualizing <code>NHX</code> file (A) and <code>CodeML</code> output (B) in <code>FigTree</code> is not supported. <code>treeio</code> can convert these files to BEAST compatible NEXUS format which can be directly opened in <code>FigTree</code> and visualized together with annotated data.
</p>
</div>
</div>
<div id="combining-tree-with-external-data" class="section level3" number="3.2.2">
<h3>
<span class="header-section-number">3.2.2</span> Combining tree with external data<a class="anchor" aria-label="anchor" href="#combining-tree-with-external-data"><i class="fas fa-link"></i></a>
</h3>
<p>Using the utilities provided
by <a href="https://CRAN.R-project.org/package=tidytree"><strong>tidytree</strong></a> and <a href="http://bioconductor.org/packages/treeio"><strong>treeio</strong></a>, it is easy to link
external data onto the corresponding phylogeny. The <code><a href="https://docs.ropensci.org/treeio/reference/write.beast.html">write.beast()</a></code> function enables users to export the tree with external data to a single tree file.</p>
<div class="sourceCode" id="cb114"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">phylo</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/ape/man/as.phylo.html">as.phylo</a></span><span class="op">(</span><span class="va">nhx</span><span class="op">)</span>
<span class="co">## save space for printing the tree text</span>
<span class="va">phylo</span><span class="op">$</span><span class="va">edge.length</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Round.html">round</a></span><span class="op">(</span><span class="va">phylo</span><span class="op">$</span><span class="va">edge.length</span>, <span class="fl">2</span><span class="op">)</span>

<span class="co">## print the newick text</span>
<span class="fu"><a href="https://rdrr.io/pkg/ape/man/write.tree.html">write.tree</a></span><span class="op">(</span><span class="va">phylo</span><span class="op">)</span></code></pre></div>
<pre><code>(((Prayidae_D27SS7@2825365:0.07,(Kephyes_ovata@2606431:0.02,
Chuniphyes_multidentata@1277217:0.01):0.02):0.06,((Apolemia_sp_@1353964:0.12,
(((Bargmannia_amoena@263997:0.01,Bargmannia_elongata@946788:0.01):0.09,
Physonect_sp_@2066767:0.08):0.03,(Stephalia_dilata@2960089:0.08,
((Frillagalma_vityazi@1155031:0.09,Resomia_ornicephala@3111757:0):0,
((Lychnagalma_utricularia@2253871:0.12,Nanomia_bijuga@717864:0.13):0,
Cordagalma_sp_@1525873:0.07):0):0.03):0):0.04):0,Rhizophysa_filiformis@3073669:
0.22):0.03):0.19,(Hydra_magnipapillata@52244:0.06,
Ectopleura_larynx@3556167:0.33):0.19);</code></pre>
<div class="sourceCode" id="cb116"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">N</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://docs.ropensci.org/treeio/reference/getNodeNum.html">Nnode2</a></span><span class="op">(</span><span class="va">phylo</span><span class="op">)</span>
<span class="va">fake_data</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://tibble.tidyverse.org/reference/tibble.html">tibble</a></span><span class="op">(</span>node <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="va">N</span>, fake_trait <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Round.html">round</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/Normal.html">rnorm</a></span><span class="op">(</span><span class="va">N</span><span class="op">)</span>, <span class="fl">2</span><span class="op">)</span>, 
                    another_trait <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Round.html">round</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/Uniform.html">runif</a></span><span class="op">(</span><span class="va">N</span><span class="op">)</span>, <span class="fl">2</span><span class="op">)</span><span class="op">)</span>
<span class="va">fake_tree</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html">full_join</a></span><span class="op">(</span><span class="va">phylo</span>, <span class="va">fake_data</span>, by <span class="op">=</span> <span class="st">"node"</span><span class="op">)</span>
<span class="co"># write.beast(fake_tree)</span>

<span class="co">## to save space, use a subtree</span>
<span class="va">fake_tree2</span> <span class="op">=</span> <span class="fu"><a href="https://docs.ropensci.org/treeio/reference/tree_subset.html">tree_subset</a></span><span class="op">(</span><span class="va">fake_tree</span>, node<span class="op">=</span><span class="fl">27</span>, levels_back<span class="op">=</span><span class="fl">0</span><span class="op">)</span>
<span class="fu"><a href="https://docs.ropensci.org/treeio/reference/write.beast.html">write.beast</a></span><span class="op">(</span><span class="va">fake_tree2</span><span class="op">)</span></code></pre></div>
<pre><code>#NEXUS
[R-package treeio, Tue Nov 16 10:13:32 2021]

BEGIN TAXA;
    DIMENSIONS NTAX = 5;
    TAXLABELS
        Frillagalma_vityazi@1155031
        Resomia_ornicephala@3111757
        Lychnagalma_utricularia@2253871
        Nanomia_bijuga@717864
        Cordagalma_sp_@1525873
    ;
END;
BEGIN TREES;
    TRANSLATE
        1   Frillagalma_vityazi@1155031,
        2   Resomia_ornicephala@3111757,
        3   Lychnagalma_utricularia@2253871,
        4   Nanomia_bijuga@717864,
        5   Cordagalma_sp_@1525873
    ;
    TREE * UNTITLED = [&amp;R] ((1[&amp;fake_trait=-1.42,another_trait=0.17]:0.09,
2[&amp;fake_trait=0.19,another_trait=0.04]:0)[&amp;fake_trait=0.85,
another_trait=0.56]:0,(5[&amp;fake_trait=0.22,another_trait=0.73]:0.07,
(3[&amp;fake_trait=0.02,another_trait=0.29]:0.12,4[&amp;fake_trait=-1.29,
another_trait=0.35]:0.13)[&amp;fake_trait=-0.33,another_trait=0.88]:0)
[&amp;fake_trait=0.27,another_trait=0.94]:0):0.29;
END;</code></pre>
<p>After merging, the <code>fake_trait</code> and <code>another_trait</code> stored in <code>fake_data</code> will be linked to the tree, <code>phylo</code>, and stored in the <code>treedata</code> object, the <code>fake_tree</code>. The <code><a href="https://docs.ropensci.org/treeio/reference/write.beast.html">write.beast()</a></code> function exports the tree with associated data to a single BEAST format file. The associated data can be used to visualize the tree using <a href="http://bioconductor.org/packages/ggtree"><strong>ggtree</strong></a> (Figure <a href="chapter5.html#fig:beast">5.8</a>) or <a href="http://beast.community/figtree"><strong>FigTree</strong></a> (Figure <a href="chapter3.html#fig:beastFigtree">3.1</a>).</p>
</div>
<div id="merging-tree-data-from-different-sources" class="section level3" number="3.2.3">
<h3>
<span class="header-section-number">3.2.3</span> Merging tree data from different sources<a class="anchor" aria-label="anchor" href="#merging-tree-data-from-different-sources"><i class="fas fa-link"></i></a>
</h3>
<p>Not only Newick tree text can be combined with associated data, but also tree
data obtained from software output can be combined with external data, as well
as different tree objects can be merged (for details, see <a href="chapter2.html#chapter2">Chapter 2</a>).</p>
<div class="sourceCode" id="cb118"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">## combine tree object with data</span>
<span class="va">tree_with_data</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html">full_join</a></span><span class="op">(</span><span class="va">nhx</span>, <span class="va">fake_data</span>, by <span class="op">=</span> <span class="st">"node"</span><span class="op">)</span>
<span class="va">tree_with_data</span></code></pre></div>
<pre><code>## 'treedata' S4 object that stored information
## of
##  '/home/ygc/R/library/treeio/extdata/NHX/phyldog.nhx'.
## 
## ...@ phylo:
## 
## Phylogenetic tree with 16 tips and 15 internal nodes.
## 
## Tip labels:
##   Prayidae_D27SS7@2825365, Kephyes_ovata@2606431,
## Chuniphyes_multidentata@1277217,
## Apolemia_sp_@1353964, Bargmannia_amoena@263997,
## Bargmannia_elongata@946788, ...
## 
## Rooted; includes branch lengths.
## 
## with the following features available:
##   'Ev', 'ND', 'S', 'fake_trait', 'another_trait'.</code></pre>
<div class="sourceCode" id="cb120"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">## merge two tree object</span>
<span class="va">tree2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://docs.ropensci.org/treeio/reference/merge_tree.html">merge_tree</a></span><span class="op">(</span><span class="va">nhx</span>, <span class="va">fake_tree</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/identical.html">identical</a></span><span class="op">(</span><span class="va">tree_with_data</span>, <span class="va">tree2</span><span class="op">)</span></code></pre></div>
<pre><code>## [1] TRUE</code></pre>
<p>After merging data from different sources, the tree with the associated data can
be exported into a single file.</p>
<div class="sourceCode" id="cb122"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">outfile</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/tempfile.html">tempfile</a></span><span class="op">(</span>fileext <span class="op">=</span> <span class="st">".tree"</span><span class="op">)</span>
<span class="fu"><a href="https://docs.ropensci.org/treeio/reference/write.beast.html">write.beast</a></span><span class="op">(</span><span class="va">tree2</span>, file <span class="op">=</span> <span class="va">outfile</span><span class="op">)</span></code></pre></div>
<p>The output BEAST Nexus file can be imported into R using the <code>read.beast</code>
function and all the associated data can be used to annotate the tree
using <a href="https://bioconductor.org/packages/ggtree/">ggtree</a> <span class="citation">(<a href="references.html#ref-yu_ggtree:_2017" role="doc-biblioref">Yu et al., 2017</a>)</span>.</p>
<div class="sourceCode" id="cb123"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://docs.ropensci.org/treeio/reference/beast-parser.html">read.beast</a></span><span class="op">(</span><span class="va">outfile</span><span class="op">)</span></code></pre></div>
<pre><code>## 'treedata' S4 object that stored information
## of
##  '/tmp/RtmptB56oN/file1199b451d3d90.tree'.
## 
## ...@ phylo:
## 
## Phylogenetic tree with 16 tips and 15 internal nodes.
## 
## Tip labels:
##   Prayidae_D27SS7@2825365, Kephyes_ovata@2606431,
## Chuniphyes_multidentata@1277217,
## Apolemia_sp_@1353964, Bargmannia_amoena@263997,
## Bargmannia_elongata@946788, ...
## 
## Rooted; includes branch lengths.
## 
## with the following features available:
##   'another_trait', 'Ev', 'fake_trait', 'ND', 'S'.</code></pre>
</div>
</div>
<div id="write-jtree" class="section level2" number="3.3">
<h2>
<span class="header-section-number">3.3</span> Exporting Tree Data to the <em>jtree</em> Format<a class="anchor" aria-label="anchor" href="#write-jtree"><i class="fas fa-link"></i></a>
</h2>
<p>The <a href="http://bioconductor.org/packages/treeio"><strong>treeio</strong></a> package <span class="citation">(<a href="references.html#ref-wang_treeio_2020" role="doc-biblioref">Wang et al., 2020</a>)</span> provides the
<code><a href="https://docs.ropensci.org/treeio/reference/write.beast.html">write.beast()</a></code> function to export <code>treedata</code> to BEAST Nexus file. This is quite useful
to convert file format, combine tree with data and merge tree data from
different sources as we demonstrated in
<a href="chapter3.html#exporting-tree-data-to-beast-nexus-format">the previous session</a>.
The <a href="http://bioconductor.org/packages/treeio"><strong>treeio</strong></a> package also supplies
the <code><a href="https://docs.ropensci.org/treeio/reference/beast-parser.html">read.beast()</a></code> function to parse the output file of the <code><a href="https://docs.ropensci.org/treeio/reference/write.beast.html">write.beast()</a></code> function. Although
with <a href="http://bioconductor.org/packages/treeio"><strong>treeio</strong></a>, the R community has the ability to
manipulate BEAST Nexus format and process tree data, there is still a lacking
library/package for parsing BEAST files in other programming languages.</p>
<p><a href="https://www.json.org/">JSON</a> (JavaScript Object Notation) is a lightweight data-interchange format and
is widely supported in almost all modern programming languages. To make it easy
to import a tree with data in other programming
languages, <a href="http://bioconductor.org/packages/treeio"><strong>treeio</strong></a> supports
exporting a tree with data in the <code>jtree</code> format, which is JSON-based and can be easy to parse using any language that supports JSON.</p>
<div class="sourceCode" id="cb125"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># write.jtree(tree2)</span>

<span class="co"># to save space, use a subtree</span>
<span class="va">tree3</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://docs.ropensci.org/treeio/reference/tree_subset.html">tree_subset</a></span><span class="op">(</span><span class="va">tree2</span>, node<span class="op">=</span><span class="fl">24</span>, levels_back<span class="op">=</span><span class="fl">0</span><span class="op">)</span> 
<span class="fu"><a href="https://docs.ropensci.org/treeio/reference/write-jtree.html">write.jtree</a></span><span class="op">(</span><span class="va">tree3</span><span class="op">)</span></code></pre></div>
<pre><code>{
    "tree": "(Physonect_sp_@2066767:0.077429{3},(Bargmannia_amoena@263997:0.0144549
{1},Bargmannia_elongata@946788:0.0149723{2}):0.0925388{5}):0.28549{4};",
    "data":[
  {
    "edge_num": 1,
    "Ev": "S",
    "ND": 10,
    "S": 37,
    "fake_trait": -0.69,
    "another_trait": 0.42
  },
  {
    "edge_num": 2,
    "Ev": "S",
    "ND": 11,
    "S": 38,
    "fake_trait": -0.95,
    "another_trait": 0.38
  },
  {
    "edge_num": 3,
    "Ev": "S",
    "ND": 13,
    "S": 61,
    "fake_trait": 0.59,
    "another_trait": 0.65
  },
  {
    "edge_num": 4,
    "Ev": "S",
    "ND": 14,
    "S": 24,
    "fake_trait": -0.69,
    "another_trait": 0.06
  },
  {
    "edge_num": 5,
    "Ev": "S",
    "ND": 12,
    "S": 33,
    "fake_trait": -0.58,
    "another_trait": 0.4
  }
],
    "metadata": {"info": "R-package treeio", "data": "Tue Nov 16 10:21:20 2021"}
}</code></pre>
<p>The <code>jtree</code> format is based on JSON and can be parsed using JSON parser.</p>
<div class="sourceCode" id="cb127"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">jtree_file</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/tempfile.html">tempfile</a></span><span class="op">(</span>fileext <span class="op">=</span> <span class="st">'.jtree'</span><span class="op">)</span>
<span class="fu"><a href="https://docs.ropensci.org/treeio/reference/write-jtree.html">write.jtree</a></span><span class="op">(</span><span class="va">tree3</span>, file <span class="op">=</span> <span class="va">jtree_file</span><span class="op">)</span>
<span class="fu">jsonlite</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/jsonlite/man/fromJSON.html">fromJSON</a></span><span class="op">(</span><span class="va">jtree_file</span><span class="op">)</span></code></pre></div>
<pre><code>$tree
[1] "(Physonect_sp_@2066767:0.077429{3},(Bargmannia_amoena@263997:0.0144549{1},
Bargmannia_elongata@946788:0.0149723{2}):0.0925388{5}):0.28549{4};"

$data
  edge_num Ev ND  S fake_trait another_trait
1        1  S 10 37      -0.69          0.42
2        2  S 11 38      -0.95          0.38
3        3  S 13 61       0.59          0.65
4        4  S 14 24      -0.69          0.06
5        5  S 12 33      -0.58          0.40

$metadata
$metadata$info
[1] "R-package treeio"

$metadata$data
[1] "Tue Nov 16 10:24:34 2021"</code></pre>
<p>The <code>jtree</code> file can be directly imported as a <code>treedata</code> object using
the <code><a href="https://docs.ropensci.org/treeio/reference/read-jtree.html">read.jtree()</a></code> function provided also
in <a href="http://bioconductor.org/packages/treeio"><strong>treeio</strong></a> package (see also <a href="chapter1.html#jtree">session 1.3</a>).</p>
<div class="sourceCode" id="cb129"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://docs.ropensci.org/treeio/reference/read-jtree.html">read.jtree</a></span><span class="op">(</span><span class="va">jtree_file</span><span class="op">)</span></code></pre></div>
<pre><code>## 'treedata' S4 object that stored information
## of
##  '/tmp/RtmptB56oN/file1199b3bc025dc.jtree'.
## 
## ...@ phylo:
## 
## Phylogenetic tree with 3 tips and 2 internal nodes.
## 
## Tip labels:
##   Physonect_sp_@2066767, Bargmannia_amoena@263997,
## Bargmannia_elongata@946788
## 
## Rooted; includes branch lengths.
## 
## with the following features available:
##   'Ev', 'ND', 'S', 'fake_trait', 'another_trait'.</code></pre>
</div>
<div id="summary3" class="section level2" number="3.4">
<h2>
<span class="header-section-number">3.4</span> Summary<a class="anchor" aria-label="anchor" href="#summary3"><i class="fas fa-link"></i></a>
</h2>
<p>Phylogenetic tree-associated data is often stored in a separate file and needs the expertise to map the data to the tree structure. Lacking standardization to store and represent phylogeny and associated data makes it difficult for researchers to access and integrate the phylogenetic data into their studies. The <a href="http://bioconductor.org/packages/treeio"><strong>treeio</strong></a> package provides functions to import phylogeny with associated data from several sources, including analysis findings from commonly used software and external data such as experimental data, clinical data, or meta-data. These trees and their associated data can be exported into a single file as <code>BEAST</code> or <code>jtree</code> formats, and the output file can be parsed back to R by <a href="http://bioconductor.org/packages/treeio"><strong>treeio</strong></a> and the data is easy to access. The input and output utilities supplied by <a href="http://bioconductor.org/packages/treeio"><strong>treeio</strong></a> package lay the foundation for phylogenetic data integration for downstream comparative study and visualization. It creates the possibility of integrating a tree with associated data from different sources and extends the applications of phylogenetic analysis in different disciplines.</p>

</div>
</div>



<div class="chapter-nav">
<div class="prev"><a href="chapter2.html"><span class="header-section-number">2</span> Manipulating Tree with Data</a></div>
<div class="next"><a href="chapter4.html"><span class="header-section-number">4</span> Phylogenetic Tree Visualization</a></div>
</div></main><div class="col-md-3 col-lg-2 d-none d-md-block sidebar sidebar-chapter">
    <nav id="toc" data-toggle="toc" aria-label="On this page"><h2>On this page</h2>
      <ul class="nav navbar-nav">
<li><a class="nav-link" href="#chapter3"><span class="header-section-number">3</span> Exporting tree with data</a></li>
<li><a class="nav-link" href="#introduction"><span class="header-section-number">3.1</span> Introduction</a></li>
<li>
<a class="nav-link" href="#exporting-tree-data-to-beast-nexus-format"><span class="header-section-number">3.2</span> Exporting Tree Data to BEAST Nexus Format</a><ul class="nav navbar-nav">
<li><a class="nav-link" href="#exportingconverting-software-output"><span class="header-section-number">3.2.1</span> Exporting/converting software output</a></li>
<li><a class="nav-link" href="#combining-tree-with-external-data"><span class="header-section-number">3.2.2</span> Combining tree with external data</a></li>
<li><a class="nav-link" href="#merging-tree-data-from-different-sources"><span class="header-section-number">3.2.3</span> Merging tree data from different sources</a></li>
</ul>
</li>
<li><a class="nav-link" href="#write-jtree"><span class="header-section-number">3.3</span> Exporting Tree Data to the jtree Format</a></li>
<li><a class="nav-link" href="#summary3"><span class="header-section-number">3.4</span> Summary</a></li>
</ul>

      <div class="book-extra">
        <ul class="list-unstyled">
          
        </ul>
</div>
    </nav>
</div>
</div>
  

  

</div>
 <!-- .container -->

<footer class="bg-primary text-light mt-5"><div class="container"><div class="row">

  <div class="col-12 col-md-6 mt-3">
    <p>"<strong>Data Integration, Manipulation and Visualization of Phylogenetic Trees</strong>" was written by Guangchuang Yu. It was last built on 2022-04-22.</p>
  </div>

  <div class="col-12 col-md-6 mt-3">
    <p>This book was built by the <a class="text-light" href="https://bookdown.org">bookdown</a> R package.</p>
  </div>

</div></div>
</footer><!-- dynamically load mathjax for compatibility with self-contained --><script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script><script type="text/x-mathjax-config">const popovers = document.querySelectorAll('a.footnote-ref[data-toggle="popover"]');
for (let popover of popovers) {
  const div = document.createElement('div');
  div.setAttribute('style', 'position: absolute; top: 0, left:0; width:0, height:0, overflow: hidden; visibility: hidden;');
  div.innerHTML = popover.getAttribute('data-content');

  var has_math = div.querySelector("span.math");
  if (has_math) {
    document.body.appendChild(div);
    MathJax.Hub.Queue(["Typeset", MathJax.Hub, div]);
    MathJax.Hub.Queue(function() {
      popover.setAttribute('data-content', div.innerHTML);
      document.body.removeChild(div);
    })
  }
}
</script>
</body>
</html>
