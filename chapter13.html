<!DOCTYPE html>
<html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Chapter 13 Gallery of Reproducible Examples | Data Integration, Manipulation and Visualization of Phylogenetic Trees with R</title>
<meta name="author" content="Guangchuang Yu">
<meta name="description" content="13.1 Visualizing pairwise nucleotide sequence distance with a phylogenetic tree This example reproduces figure 1 of (Chen et al., 2017). It extracts accession numbers from tip labels of the HPV58...">
<meta name="generator" content="bookdown 0.25 with bs4_book()">
<meta property="og:title" content="Chapter 13 Gallery of Reproducible Examples | Data Integration, Manipulation and Visualization of Phylogenetic Trees with R">
<meta property="og:type" content="book">
<meta property="og:image" content="/book-cover.png">
<meta property="og:description" content="13.1 Visualizing pairwise nucleotide sequence distance with a phylogenetic tree This example reproduces figure 1 of (Chen et al., 2017). It extracts accession numbers from tip labels of the HPV58...">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Chapter 13 Gallery of Reproducible Examples | Data Integration, Manipulation and Visualization of Phylogenetic Trees with R">
<meta name="twitter:description" content="13.1 Visualizing pairwise nucleotide sequence distance with a phylogenetic tree This example reproduces figure 1 of (Chen et al., 2017). It extracts accession numbers from tip labels of the HPV58...">
<meta name="twitter:image" content="/book-cover.png">
<!-- JS --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://kit.fontawesome.com/6ecbd6c532.js" crossorigin="anonymous"></script><script src="libs/jquery/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="libs/bootstrap/bootstrap.min.css" rel="stylesheet">
<script src="libs/bootstrap/bootstrap.bundle.min.js"></script><script src="libs/bs3compat/transition.js"></script><script src="libs/bs3compat/tabs.js"></script><script src="libs/bs3compat/bs3compat.js"></script><link href="libs/bs4_book/bs4_book.css" rel="stylesheet">
<script src="libs/bs4_book/bs4_book.js"></script><script src="libs/kePrint/kePrint.js"></script><link href="libs/lightable/lightable.css" rel="stylesheet">
<script src="libs/htmlwidgets/htmlwidgets.js"></script><script src="libs/pathseg/pathseg.js"></script><script src="libs/comic/comic.min.js"></script><script src="libs/comicR-binding/comicR.js"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- CSS --><style type="text/css">
    
    div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
  </style>
<style type="text/css">
    /* Used with Pandoc 2.11+ new --citeproc when CSL is used */
    div.csl-bib-body { }
    div.csl-entry {
      clear: both;
        }
    .hanging div.csl-entry {
      margin-left:2em;
      text-indent:-2em;
    }
    div.csl-left-margin {
      min-width:2em;
      float:left;
    }
    div.csl-right-inline {
      margin-left:2em;
      padding-left:1em;
    }
    div.csl-indent {
      margin-left: 2em;
    }
  </style>
</head>
<body data-spy="scroll" data-target="#toc">

<div class="container-fluid">
<div class="row">
  <header class="col-sm-12 col-lg-3 sidebar sidebar-book"><a class="sr-only sr-only-focusable" href="#content">Skip to main content</a>

    <div class="d-flex align-items-start justify-content-between">
      <h1>
        <a href="index.html" title="">Data Integration, Manipulation and Visualization of Phylogenetic Trees with R</a>
      </h1>
      <button class="btn btn-outline-primary d-lg-none ml-2 mt-1" type="button" data-toggle="collapse" data-target="#main-nav" aria-expanded="true" aria-controls="main-nav"><i class="fas fa-bars"></i><span class="sr-only">Show table of contents</span></button>
    </div>

    <div id="main-nav" class="collapse-lg">
      <form role="search">
        <input id="search" class="form-control" type="search" placeholder="Search" aria-label="Search">
</form>

      <nav aria-label="Table of contents"><h2>Table of contents</h2>
        <ul class="book-toc list-unstyled">
<li><a class="" href="index.html">Preface</a></li>
<li><a class="" href="author.html">About the Author</a></li>
<li class="book-part">Part I: Tree data input, output, and manipulation</li>
<li><a class="" href="chapter1.html"><span class="header-section-number">1</span> Importing Tree with Data</a></li>
<li><a class="" href="chapter2.html"><span class="header-section-number">2</span> Manipulating Tree with Data</a></li>
<li><a class="" href="chapter3.html"><span class="header-section-number">3</span> Exporting tree with data</a></li>
<li class="book-part">Part II: Tree data visualization and annotation</li>
<li><a class="" href="chapter4.html"><span class="header-section-number">4</span> Phylogenetic Tree Visualization</a></li>
<li><a class="" href="chapter5.html"><span class="header-section-number">5</span> Phylogenetic Tree Annotation</a></li>
<li><a class="" href="chapter6.html"><span class="header-section-number">6</span> Visual Exploration of Phylogenetic Trees</a></li>
<li><a class="" href="chapter7.html"><span class="header-section-number">7</span> Plotting tree with data</a></li>
<li><a class="" href="chapter8.html"><span class="header-section-number">8</span> Annotating Tree with Silhouette Images and Sub-plots</a></li>
<li><a class="" href="chapter9.html"><span class="header-section-number">9</span> ggtree for Other Tree-like Objects</a></li>
<li class="book-part">Part III: ggtree extensions</li>
<li><a class="" href="chapter10.html"><span class="header-section-number">10</span> ggtreeExtra for Presenting Data on a Circular Layout</a></li>
<li><a class="" href="chapter11.html"><span class="header-section-number">11</span> Other ggtree Extensions</a></li>
<li class="book-part">Part IV: Miscellaneous topics</li>
<li><a class="" href="chapter12.html"><span class="header-section-number">12</span> ggtree Utilities</a></li>
<li><a class="active" href="chapter13.html"><span class="header-section-number">13</span> Gallery of Reproducible Examples</a></li>
<li class="book-part">Appendix</li>
<li><a class="" href="faq.html"><span class="header-section-number">A</span> Frequently Asked Questions</a></li>
<li><a class="" href="related-tools.html"><span class="header-section-number">B</span> Related Tools</a></li>
<li><a class="" href="figures-and-tables.html"><span class="header-section-number">C</span> Figures and Tables</a></li>
<li><a class="" href="publications-of-the-ggtree-package-suite.html"><span class="header-section-number">D</span> Publications of the ggtree Package Suite</a></li>
<li><a class="" href="references.html">References</a></li>
</ul>

        <div class="book-extra">
          
        </div>
      </nav>
</div>
  </header><main class="col-sm-12 col-md-9 col-lg-7" id="content"><div id="chapter13" class="section level1" number="13">
<h1>
<span class="header-section-number">13</span> Gallery of Reproducible Examples<a class="anchor" aria-label="anchor" href="#chapter13"><i class="fas fa-link"></i></a>
</h1>
<div id="hpv58" class="section level2" number="13.1">
<h2>
<span class="header-section-number">13.1</span> Visualizing pairwise nucleotide sequence distance with a phylogenetic tree<a class="anchor" aria-label="anchor" href="#hpv58"><i class="fas fa-link"></i></a>
</h2>
<p>This example reproduces figure 1 of <span class="citation">(<a href="references.html#ref-chen_ancient_2017" role="doc-biblioref">Chen et al., 2017</a>)</span>. It extracts accession numbers from tip labels of the HPV58 tree and calculates pairwise nucleotide sequence distances. The distance matrix is visualized as dot and line plots. This example demonstrates the ability to add multiple layers to a specific panel. As illustrated in Figure <a href="chapter13.html#fig:jv2017">13.1</a>, the <code><a href="https://rdrr.io/pkg/ggtree/man/facet-plot.html">geom_facet()</a></code> function displays sequence distances as a dot plot and then adds a layer of line plot to the same panel, <em>i.e.</em>, sequence distance. In addition, the tree in <code><a href="https://rdrr.io/pkg/ggtree/man/facet-plot.html">geom_facet()</a></code> can be fully annotated with multiple layers (clade labels, bootstrap support values, <em>etc.</em>). The source code is modified from the supplemental file of <span class="citation">(<a href="references.html#ref-yu_two_2018" role="doc-biblioref">Yu et al., 2018</a>)</span>.</p>
<div class="sourceCode" id="cb256"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/YuLab-SMU/TDBook">TDbook</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://tibble.tidyverse.org/">tibble</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://tidyr.tidyverse.org">tidyr</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://bioconductor.org/packages/Biostrings">Biostrings</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/YuLab-SMU/treeio">treeio</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://ggplot2.tidyverse.org">ggplot2</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://yulab-smu.top/treedata-book/">ggtree</a></span><span class="op">)</span>

<span class="co"># loaded from TDbook package</span>
<span class="va">tree</span> <span class="op">&lt;-</span> <span class="va">tree_HPV58</span>

<span class="va">clade</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/S4Vectors/man/Vector-class.html">c</a></span><span class="op">(</span>A3 <span class="op">=</span> <span class="fl">92</span>, A1 <span class="op">=</span> <span class="fl">94</span>, A2 <span class="op">=</span> <span class="fl">108</span>, B1 <span class="op">=</span> <span class="fl">156</span>, 
            B2 <span class="op">=</span> <span class="fl">159</span>, C <span class="op">=</span> <span class="fl">163</span>, D1 <span class="op">=</span> <span class="fl">173</span>, D2 <span class="op">=</span> <span class="fl">176</span><span class="op">)</span>
<span class="va">tree</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/tidytree/man/groupClade.html">groupClade</a></span><span class="op">(</span><span class="va">tree</span>, <span class="va">clade</span><span class="op">)</span>
<span class="va">cols</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/S4Vectors/man/Vector-class.html">c</a></span><span class="op">(</span>A1 <span class="op">=</span> <span class="st">"#EC762F"</span>, A2 <span class="op">=</span> <span class="st">"#CA6629"</span>, A3 <span class="op">=</span> <span class="st">"#894418"</span>, B1 <span class="op">=</span> <span class="st">"#0923FA"</span>, 
         B2 <span class="op">=</span> <span class="st">"#020D87"</span>, C <span class="op">=</span> <span class="st">"#000000"</span>, D1 <span class="op">=</span> <span class="st">"#9ACD32"</span>,D2 <span class="op">=</span> <span class="st">"#08630A"</span><span class="op">)</span>

<span class="co">## visualize the tree with tip labels and tree scale</span>
<span class="va">p</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/ggtree/man/ggtree.html">ggtree</a></span><span class="op">(</span><span class="va">tree</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>color <span class="op">=</span> <span class="va">group</span><span class="op">)</span>, ladderize <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> 
    <span class="fu"><a href="https://rdrr.io/pkg/ggtree/man/rotate.html">rotate</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/tidytree/man/rootnode.html">rootnode</a></span><span class="op">(</span><span class="va">tree</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> 
    <span class="fu"><a href="https://rdrr.io/pkg/ggtree/man/geom_tiplab.html">geom_tiplab</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>label <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span><span class="st">"italic('"</span>, <span class="va">label</span>, <span class="st">"')"</span><span class="op">)</span><span class="op">)</span>, 
                parse <span class="op">=</span> <span class="cn">TRUE</span>, size <span class="op">=</span> <span class="fl">2.5</span><span class="op">)</span> <span class="op">+</span>
    <span class="fu"><a href="https://rdrr.io/pkg/ggtree/man/geom_treescale.html">geom_treescale</a></span><span class="op">(</span>x <span class="op">=</span> <span class="fl">0</span>, y <span class="op">=</span> <span class="fl">1</span>, width <span class="op">=</span> <span class="fl">0.002</span><span class="op">)</span> <span class="op">+</span> 
    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_manual.html">scale_color_manual</a></span><span class="op">(</span>values <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/S4Vectors/man/Vector-class.html">c</a></span><span class="op">(</span><span class="va">cols</span>, <span class="st">"black"</span><span class="op">)</span>, 
                na.value <span class="op">=</span> <span class="st">"black"</span>, name <span class="op">=</span> <span class="st">"Lineage"</span>,
                breaks <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/S4Vectors/man/Vector-class.html">c</a></span><span class="op">(</span><span class="st">"A1"</span>, <span class="st">"A2"</span>, <span class="st">"A3"</span>, <span class="st">"B1"</span>, <span class="st">"B2"</span>, <span class="st">"C"</span>, <span class="st">"D1"</span>, <span class="st">"D2"</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/guides.html">guides</a></span><span class="op">(</span>color <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/guide_legend.html">guide_legend</a></span><span class="op">(</span>override.aes <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>size <span class="op">=</span> <span class="fl">5</span>, shape <span class="op">=</span> <span class="fl">15</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
    <span class="fu"><a href="https://rdrr.io/pkg/ggtree/man/theme_tree2.html">theme_tree2</a></span><span class="op">(</span>legend.position <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/S4Vectors/man/Vector-class.html">c</a></span><span class="op">(</span><span class="fl">.1</span>, <span class="fl">.88</span><span class="op">)</span><span class="op">)</span>
<span class="co">## Optional</span>
<span class="co">## add labels for monophyletic (A, C and D) and paraphyletic (B) groups </span>
<span class="va">dat</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://tibble.tidyverse.org/reference/tibble.html">tibble</a></span><span class="op">(</span>node <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/S4Vectors/man/Vector-class.html">c</a></span><span class="op">(</span><span class="fl">94</span>, <span class="fl">108</span>, <span class="fl">131</span>, <span class="fl">92</span>, <span class="fl">156</span>, <span class="fl">159</span>, <span class="fl">163</span>, <span class="fl">173</span>, <span class="fl">176</span>,<span class="fl">172</span><span class="op">)</span>,
              name <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/S4Vectors/man/Vector-class.html">c</a></span><span class="op">(</span><span class="st">"A1"</span>, <span class="st">"A2"</span>, <span class="st">"A3"</span>, <span class="st">"A"</span>, <span class="st">"B1"</span>, 
                        <span class="st">"B2"</span>, <span class="st">"C"</span>, <span class="st">"D1"</span>, <span class="st">"D2"</span>, <span class="st">"D"</span><span class="op">)</span>,
              offset <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/S4Vectors/man/Vector-class.html">c</a></span><span class="op">(</span><span class="fl">0.003</span>, <span class="fl">0.003</span>, <span class="fl">0.003</span>, <span class="fl">0.00315</span>, <span class="fl">0.003</span>, 
                        <span class="fl">0.003</span>, <span class="fl">0.0031</span>, <span class="fl">0.003</span>, <span class="fl">0.003</span>, <span class="fl">0.00315</span><span class="op">)</span>,
              offset.text <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/S4Vectors/man/Vector-class.html">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">.001</span>, <span class="op">-</span><span class="fl">.001</span>, <span class="op">-</span><span class="fl">.001</span>, <span class="fl">0.0002</span>, <span class="op">-</span><span class="fl">.001</span>, 
                        <span class="op">-</span><span class="fl">.001</span>, <span class="fl">0.0002</span>, <span class="op">-</span><span class="fl">.001</span>, <span class="op">-</span><span class="fl">.001</span>, <span class="fl">0.0002</span><span class="op">)</span>,
              barsize <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/S4Vectors/man/Vector-class.html">c</a></span><span class="op">(</span><span class="fl">1.2</span>, <span class="fl">1.2</span>, <span class="fl">1.2</span>, <span class="fl">2</span>, <span class="fl">1.2</span>, <span class="fl">1.2</span>, <span class="fl">3.2</span>, <span class="fl">1.2</span>, <span class="fl">1.2</span>, <span class="fl">2</span><span class="op">)</span>,
              extend <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/S4Vectors/man/Vector-class.html">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">0.5</span><span class="op">)</span>, <span class="fl">0.5</span>, <span class="fu"><a href="https://rdrr.io/pkg/S4Vectors/man/Vector-class.html">c</a></span><span class="op">(</span><span class="fl">0.5</span>, <span class="fl">0</span><span class="op">)</span>, <span class="fl">0</span>, <span class="fu"><a href="https://rdrr.io/pkg/S4Vectors/man/Vector-class.html">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">0.5</span><span class="op">)</span>, 
                        <span class="fu"><a href="https://rdrr.io/pkg/S4Vectors/man/Vector-class.html">c</a></span><span class="op">(</span><span class="fl">0.5</span>, <span class="fl">0</span><span class="op">)</span>, <span class="fl">0</span>, <span class="fu"><a href="https://rdrr.io/pkg/S4Vectors/man/Vector-class.html">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">0.5</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/pkg/S4Vectors/man/Vector-class.html">c</a></span><span class="op">(</span><span class="fl">0.5</span>, <span class="fl">0</span><span class="op">)</span>, <span class="fl">0</span><span class="op">)</span>
            <span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> 
       <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_split.html">group_split</a></span><span class="op">(</span><span class="va">barsize</span><span class="op">)</span>

<span class="va">p</span> <span class="op">&lt;-</span> <span class="va">p</span> <span class="op">+</span>
     <span class="fu"><a href="https://rdrr.io/pkg/ggtree/man/geom_cladelab.html">geom_cladelab</a></span><span class="op">(</span>
         data <span class="op">=</span> <span class="va">dat</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span>,
         mapping <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>
             node <span class="op">=</span> <span class="va">node</span>,
             label <span class="op">=</span> <span class="va">name</span>,
             color <span class="op">=</span> <span class="va">group</span>,
             offset <span class="op">=</span> <span class="va">offset</span>,
             offset.text <span class="op">=</span> <span class="va">offset.text</span>,
             extend <span class="op">=</span> <span class="va">extend</span>
         <span class="op">)</span>,
         barsize <span class="op">=</span> <span class="fl">1.2</span>,
         fontface <span class="op">=</span> <span class="fl">3</span>,
         align <span class="op">=</span> <span class="cn">TRUE</span>
     <span class="op">)</span> <span class="op">+</span>
     <span class="fu"><a href="https://rdrr.io/pkg/ggtree/man/geom_cladelab.html">geom_cladelab</a></span><span class="op">(</span>
         data <span class="op">=</span> <span class="va">dat</span><span class="op">[[</span><span class="fl">2</span><span class="op">]</span><span class="op">]</span>,
         mapping <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>
             node <span class="op">=</span> <span class="va">node</span>,
             label <span class="op">=</span> <span class="va">name</span>,
             offset <span class="op">=</span> <span class="va">offset</span>,
             offset.text <span class="op">=</span><span class="va">offset.text</span>,
             extend <span class="op">=</span> <span class="va">extend</span>
         <span class="op">)</span>,
         barcolor <span class="op">=</span> <span class="st">"darkgrey"</span>,
         textcolor <span class="op">=</span> <span class="st">"darkgrey"</span>,
         barsize <span class="op">=</span> <span class="fl">2</span>,
         fontsize <span class="op">=</span> <span class="fl">5</span>,
         fontface <span class="op">=</span> <span class="fl">3</span>,
         align <span class="op">=</span> <span class="cn">TRUE</span>
     <span class="op">)</span> <span class="op">+</span>
     <span class="fu"><a href="https://rdrr.io/pkg/ggtree/man/geom_cladelab.html">geom_cladelab</a></span><span class="op">(</span>
         data <span class="op">=</span> <span class="va">dat</span><span class="op">[[</span><span class="fl">3</span><span class="op">]</span><span class="op">]</span>,
         mapping <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>
             node <span class="op">=</span> <span class="va">node</span>,
             label <span class="op">=</span> <span class="va">name</span>,
             offset <span class="op">=</span> <span class="va">offset</span>,
             offset.text <span class="op">=</span> <span class="va">offset.text</span>,
             extend <span class="op">=</span> <span class="va">extend</span>
         <span class="op">)</span>,
         barcolor <span class="op">=</span> <span class="st">"darkgrey"</span>,
         textcolor <span class="op">=</span> <span class="st">"darkgrey"</span>,
         barsize <span class="op">=</span> <span class="fl">3.2</span>,
         fontsize <span class="op">=</span> <span class="fl">5</span>,
         fontface <span class="op">=</span> <span class="fl">3</span>,
         align <span class="op">=</span> <span class="cn">TRUE</span>
     <span class="op">)</span> <span class="op">+</span>
     <span class="fu"><a href="https://rdrr.io/pkg/ggtree/man/geom_strip.html">geom_strip</a></span><span class="op">(</span><span class="fl">65</span>, <span class="fl">71</span>, <span class="st">"italic(B)"</span>, color <span class="op">=</span> <span class="st">"darkgrey"</span>, 
                offset <span class="op">=</span> <span class="fl">0.00315</span>, align <span class="op">=</span> <span class="cn">TRUE</span>, offset.text <span class="op">=</span> <span class="fl">0.0002</span>, 
                barsize <span class="op">=</span> <span class="fl">2</span>, fontsize <span class="op">=</span> <span class="fl">5</span>, parse <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>

<span class="co">## Optional</span>
<span class="co">## display support values</span>
<span class="va">p</span> <span class="op">&lt;-</span> <span class="va">p</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/pkg/ggtree/man/geom_nodelab.html">geom_nodelab</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>subset <span class="op">=</span> <span class="op">(</span><span class="va">node</span> <span class="op">==</span> <span class="fl">92</span><span class="op">)</span>, label <span class="op">=</span> <span class="st">"*"</span><span class="op">)</span>, 
                    color <span class="op">=</span> <span class="st">"black"</span>, nudge_x <span class="op">=</span> <span class="op">-</span><span class="fl">.001</span>, nudge_y <span class="op">=</span> <span class="fl">1</span><span class="op">)</span> <span class="op">+</span>
    <span class="fu"><a href="https://rdrr.io/pkg/ggtree/man/geom_nodelab.html">geom_nodelab</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>subset <span class="op">=</span> <span class="op">(</span><span class="va">node</span> <span class="op">==</span> <span class="fl">155</span><span class="op">)</span>, label <span class="op">=</span> <span class="st">"*"</span><span class="op">)</span>, 
                    color <span class="op">=</span> <span class="st">"black"</span>, nudge_x <span class="op">=</span> <span class="op">-</span><span class="fl">.0003</span>, nudge_y <span class="op">=</span> <span class="op">-</span><span class="fl">1</span><span class="op">)</span> <span class="op">+</span>
    <span class="fu"><a href="https://rdrr.io/pkg/ggtree/man/geom_nodelab.html">geom_nodelab</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>subset <span class="op">=</span> <span class="op">(</span><span class="va">node</span> <span class="op">==</span> <span class="fl">158</span><span class="op">)</span>, label <span class="op">=</span> <span class="st">"95/92/1.00"</span><span class="op">)</span>, 
                    color <span class="op">=</span> <span class="st">"black"</span>, nudge_x <span class="op">=</span> <span class="op">-</span><span class="fl">0.0001</span>, 
                    nudge_y <span class="op">=</span> <span class="op">-</span><span class="fl">1</span>, hjust <span class="op">=</span> <span class="fl">1</span><span class="op">)</span> <span class="op">+</span>
    <span class="fu"><a href="https://rdrr.io/pkg/ggtree/man/geom_nodelab.html">geom_nodelab</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>subset <span class="op">=</span> <span class="op">(</span><span class="va">node</span> <span class="op">==</span> <span class="fl">162</span><span class="op">)</span>, label <span class="op">=</span> <span class="st">"98/97/1.00"</span><span class="op">)</span>, 
                    color <span class="op">=</span> <span class="st">"black"</span>, nudge_x <span class="op">=</span> <span class="op">-</span><span class="fl">0.0001</span>, 
                    nudge_y <span class="op">=</span> <span class="op">-</span><span class="fl">1</span>, hjust <span class="op">=</span> <span class="fl">1</span><span class="op">)</span> <span class="op">+</span>
    <span class="fu"><a href="https://rdrr.io/pkg/ggtree/man/geom_nodelab.html">geom_nodelab</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>subset <span class="op">=</span> <span class="op">(</span><span class="va">node</span> <span class="op">==</span> <span class="fl">172</span><span class="op">)</span>, label <span class="op">=</span> <span class="st">"*"</span><span class="op">)</span>, 
                    color <span class="op">=</span> <span class="st">"black"</span>, nudge_x <span class="op">=</span> <span class="op">-</span><span class="fl">.0003</span>, nudge_y <span class="op">=</span> <span class="op">-</span><span class="fl">1</span><span class="op">)</span> </code></pre></div>
<div class="sourceCode" id="cb257"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">## extract accession numbers from tip labels</span>
<span class="va">tl</span> <span class="op">&lt;-</span> <span class="va">tree</span><span class="op">$</span><span class="va">tip.label</span>
<span class="va">acc</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/grep.html">sub</a></span><span class="op">(</span><span class="st">"\\w+\\|"</span>, <span class="st">""</span>, <span class="va">tl</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/pkg/phylobase/man/print-methods.html">names</a></span><span class="op">(</span><span class="va">tl</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="va">acc</span>

<span class="co">## read sequences from GenBank directly into R</span>
<span class="co">## and convert the object to DNAStringSet</span>
<span class="va">tipseq</span> <span class="op">&lt;-</span> <span class="fu">ape</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/ape/man/read.GenBank.html">read.GenBank</a></span><span class="op">(</span><span class="va">acc</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> <span class="va">as.character</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> 
    <span class="fu"><a href="https://rdrr.io/pkg/BiocGenerics/man/lapply.html">lapply</a></span><span class="op">(</span><span class="va">.</span>, <span class="va">paste0</span>, collapse <span class="op">=</span> <span class="st">""</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> <span class="va">unlist</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> 
    <span class="va">DNAStringSet</span>
<span class="co">## align the sequences using muscle</span>
<span class="va">tipseq_aln</span> <span class="op">&lt;-</span> <span class="fu">muscle</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/muscle/man/muscle.html">muscle</a></span><span class="op">(</span><span class="va">tipseq</span><span class="op">)</span>
<span class="va">tipseq_aln</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/Biostrings/man/XStringSet-class.html">DNAStringSet</a></span><span class="op">(</span><span class="va">tipseq_aln</span><span class="op">)</span></code></pre></div>


<div class="sourceCode" id="cb258"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">## calculate pairwise hamming distances among sequences</span>
<span class="va">tipseq_dist</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/Biostrings/man/stringDist.html">stringDist</a></span><span class="op">(</span><span class="va">tipseq_aln</span>, method <span class="op">=</span> <span class="st">"hamming"</span><span class="op">)</span>

<span class="co">## calculate the percentage of differences</span>
<span class="va">tipseq_d</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html">as.matrix</a></span><span class="op">(</span><span class="va">tipseq_dist</span><span class="op">)</span> <span class="op">/</span> <span class="fu"><a href="https://rdrr.io/pkg/BiocGenerics/man/start.html">width</a></span><span class="op">(</span><span class="va">tipseq_aln</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span><span class="op">)</span> <span class="op">*</span> <span class="fl">100</span>

<span class="co">## convert the matrix to a tidy data frame for facet_plot</span>
<span class="va">dd</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://tibble.tidyverse.org/reference/as_tibble.html">as_tibble</a></span><span class="op">(</span><span class="va">tipseq_d</span><span class="op">)</span>
<span class="va">dd</span><span class="op">$</span><span class="va">seq1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://tibble.tidyverse.org/reference/rownames.html">rownames</a></span><span class="op">(</span><span class="va">tipseq_d</span><span class="op">)</span>
<span class="va">td</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://tidyr.tidyverse.org/reference/gather.html">gather</a></span><span class="op">(</span><span class="va">dd</span>,<span class="va">seq2</span>, <span class="va">dist</span>, <span class="op">-</span><span class="va">seq1</span><span class="op">)</span>
<span class="va">td</span><span class="op">$</span><span class="va">seq1</span> <span class="op">&lt;-</span> <span class="va">tl</span><span class="op">[</span><span class="va">td</span><span class="op">$</span><span class="va">seq1</span><span class="op">]</span>
<span class="va">td</span><span class="op">$</span><span class="va">seq2</span> <span class="op">&lt;-</span> <span class="va">tl</span><span class="op">[</span><span class="va">td</span><span class="op">$</span><span class="va">seq2</span><span class="op">]</span>

<span class="va">g</span> <span class="op">&lt;-</span> <span class="va">p</span><span class="op">$</span><span class="va">data</span><span class="op">$</span><span class="va">group</span>
<span class="fu"><a href="https://rdrr.io/pkg/phylobase/man/print-methods.html">names</a></span><span class="op">(</span><span class="va">g</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="va">p</span><span class="op">$</span><span class="va">data</span><span class="op">$</span><span class="va">label</span>
<span class="va">td</span><span class="op">$</span><span class="va">clade</span> <span class="op">&lt;-</span> <span class="va">g</span><span class="op">[</span><span class="va">td</span><span class="op">$</span><span class="va">seq2</span><span class="op">]</span> 

<span class="co">## visualize the sequence differences using dot plot and line plot</span>
<span class="co">## and align the sequence difference plot to the tree using facet_plot</span>
<span class="va">p2</span> <span class="op">&lt;-</span> <span class="va">p</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/pkg/ggtree/man/facet-plot.html">geom_facet</a></span><span class="op">(</span>panel <span class="op">=</span> <span class="st">"Sequence Distance"</span>, 
            data <span class="op">=</span> <span class="va">td</span>, geom <span class="op">=</span> <span class="va">geom_point</span>, alpha <span class="op">=</span> <span class="fl">.6</span>, 
            mapping <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">dist</span>, color <span class="op">=</span> <span class="va">clade</span>, shape <span class="op">=</span> <span class="va">clade</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
    <span class="fu"><a href="https://rdrr.io/pkg/ggtree/man/facet-plot.html">geom_facet</a></span><span class="op">(</span>panel <span class="op">=</span> <span class="st">"Sequence Distance"</span>, 
            data <span class="op">=</span> <span class="va">td</span>, geom <span class="op">=</span> <span class="va">geom_path</span>, alpha <span class="op">=</span> <span class="fl">.6</span>, 
            mapping<span class="op">=</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">dist</span>, group <span class="op">=</span> <span class="va">seq2</span>, color <span class="op">=</span> <span class="va">clade</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> 
    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_manual.html">scale_shape_manual</a></span><span class="op">(</span>values <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="fl">8</span>, guide <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span> 

<span class="fu"><a href="https://rdrr.io/pkg/MicrobiotaProcess/man/print.html">print</a></span><span class="op">(</span><span class="va">p2</span><span class="op">)</span></code></pre></div>
<div class="figure">
<span style="display:block;" id="fig:jv2017"></span>
<img src="treedata_files/figure-html/jv2017-1.png" alt="Phylogeny of HPV58 complete genomes with dot and line plots of pairwise nucleotide sequence distances." width="100%"><p class="caption">
FIGURE 13.1: <strong>Phylogeny of HPV58 complete genomes with dot and line plots of pairwise nucleotide sequence distances</strong>.
</p>
</div>
</div>
<div id="symbolic-bootstrap" class="section level2" number="13.2">
<h2>
<span class="header-section-number">13.2</span> Displaying Different Symbolic Points for Bootstrap Values.<a class="anchor" aria-label="anchor" href="#symbolic-bootstrap"><i class="fas fa-link"></i></a>
</h2>
<p>We can cut the bootstrap values into several intervals, <em>e.g.</em>, to indicate whether the clade is of high, moderate, or low support. Then we can use these intervals as categorical variables to set different colors or shapes of symbolic points to indicate the bootstrap values belong to which category (Figure <a href="chapter13.html#fig:bpinterval">13.2</a>).</p>


<div class="sourceCode" id="cb259"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/YuLab-SMU/treeio">treeio</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://ggplot2.tidyverse.org">ggplot2</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://yulab-smu.top/treedata-book/">ggtree</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/YuLab-SMU/TDBook">TDbook</a></span><span class="op">)</span>

<span class="va">tree</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://docs.ropensci.org/treeio/reference/read.newick.html">read.newick</a></span><span class="op">(</span>text<span class="op">=</span><span class="va">text_RMI_tree</span>, node.label <span class="op">=</span> <span class="st">"support"</span><span class="op">)</span>
<span class="va">root</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/tidytree/man/rootnode.html">rootnode</a></span><span class="op">(</span><span class="va">tree</span><span class="op">)</span>  
<span class="fu"><a href="https://rdrr.io/pkg/ggtree/man/ggtree.html">ggtree</a></span><span class="op">(</span><span class="va">tree</span>, color<span class="op">=</span><span class="st">"black"</span>, size<span class="op">=</span><span class="fl">1.5</span>, linetype<span class="op">=</span><span class="fl">1</span>,  right<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span> <span class="op">+</span> 
    <span class="fu"><a href="https://rdrr.io/pkg/ggtree/man/geom_tiplab.html">geom_tiplab</a></span><span class="op">(</span>size<span class="op">=</span><span class="fl">4.5</span>, hjust <span class="op">=</span> <span class="op">-</span><span class="fl">0.060</span>, fontface<span class="op">=</span><span class="st">"bold"</span><span class="op">)</span> <span class="op">+</span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/lims.html">xlim</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">0.09</span><span class="op">)</span> <span class="op">+</span> 
    <span class="fu"><a href="https://rdrr.io/pkg/ggtree/man/geom_point2.html">geom_point2</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>subset<span class="op">=</span><span class="op">!</span><span class="va">isTip</span> <span class="op">&amp;</span> <span class="va">node</span> <span class="op">!=</span> <span class="va">root</span>, 
                    fill<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/cut.html">cut</a></span><span class="op">(</span><span class="va">support</span>, <span class="fu"><a href="https://rdrr.io/pkg/S4Vectors/man/Vector-class.html">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">700</span>, <span class="fl">900</span>, <span class="fl">1000</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>, 
                    shape<span class="op">=</span><span class="fl">21</span>, size<span class="op">=</span><span class="fl">4</span><span class="op">)</span> <span class="op">+</span> 
    <span class="fu"><a href="https://rdrr.io/pkg/ggtree/man/theme_tree.html">theme_tree</a></span><span class="op">(</span>legend.position<span class="op">=</span><span class="fu"><a href="https://rdrr.io/pkg/S4Vectors/man/Vector-class.html">c</a></span><span class="op">(</span><span class="fl">0.2</span>, <span class="fl">0.2</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> 
    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_manual.html">scale_fill_manual</a></span><span class="op">(</span>values<span class="op">=</span><span class="fu"><a href="https://rdrr.io/pkg/S4Vectors/man/Vector-class.html">c</a></span><span class="op">(</span><span class="st">"white"</span>, <span class="st">"grey"</span>, <span class="st">"black"</span><span class="op">)</span>, guide<span class="op">=</span><span class="st">'legend'</span>, 
                    name<span class="op">=</span><span class="st">'Bootstrap Percentage(BP)'</span>, 
                    breaks<span class="op">=</span><span class="fu"><a href="https://rdrr.io/pkg/S4Vectors/man/Vector-class.html">c</a></span><span class="op">(</span><span class="st">'(900,1e+03]'</span>, <span class="st">'(700,900]'</span>, <span class="st">'(0,700]'</span><span class="op">)</span>, 
                    labels<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/expression.html">expression</a></span><span class="op">(</span><span class="va">BP</span><span class="op">&gt;=</span><span class="fl">90</span>,<span class="fl">70</span> <span class="op">&lt;=</span> <span class="va">BP</span> <span class="op">*</span> <span class="st">" &lt; 90"</span>, <span class="va">BP</span> <span class="op">&lt;</span> <span class="fl">70</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<div class="figure">
<span style="display:block;" id="fig:bpinterval"></span>
<img src="treedata_files/figure-html/bpinterval-1.png" alt="Partitioning bootstrap values. Bootstrap values were divided into three categories and this information was used to color circle points." width="100%"><p class="caption">
FIGURE 13.2: <strong>Partitioning bootstrap values</strong>. Bootstrap values were divided into three categories and this information was used to color circle points.
</p>
</div>
</div>
<div id="phylo-grouping" class="section level2" number="13.3">
<h2>
<span class="header-section-number">13.3</span> Highlighting Different Groups<a class="anchor" aria-label="anchor" href="#phylo-grouping"><i class="fas fa-link"></i></a>
</h2>
<p>This example reproduces Figure 1 of <span class="citation">(<a href="references.html#ref-larsen_identification_2019" role="doc-biblioref">Larsen et al., 2019</a>)</span>. It used <code><a href="https://rdrr.io/pkg/tidytree/man/groupOTU.html">groupOTU()</a></code> to add grouping information of chicken CTLDcps. The branch line type and color are defined based on this grouping information. Two groups of CTLDcps are highlighted in different background colors using <code>geom_hilight</code> (red for Group II and green for Group V). The avian-specific expansion of Group V with the subgroups of A and B- are labeled using <code>geom_cladelab</code> (Figure <a href="chapter13.html#fig:treeLarsen">13.3</a>).</p>


<div class="sourceCode" id="cb260"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/YuLab-SMU/TDBook">TDbook</a></span><span class="op">)</span>
<span class="va">mytree</span> <span class="op">&lt;-</span> <span class="va">tree_treenwk_30.4.19</span>

<span class="co"># Define nodes for coloring later on</span>
<span class="va">tiplab</span> <span class="op">&lt;-</span> <span class="va">mytree</span><span class="op">$</span><span class="va">tip.label</span>
<span class="va">cls</span> <span class="op">&lt;-</span> <span class="va">tiplab</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/pkg/BiocGenerics/man/grep.html">grep</a></span><span class="op">(</span><span class="st">"^ch"</span>, <span class="va">tiplab</span><span class="op">)</span><span class="op">]</span> 
<span class="va">labeltree</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/tidytree/man/groupOTU.html">groupOTU</a></span><span class="op">(</span><span class="va">mytree</span>, <span class="va">cls</span><span class="op">)</span>

<span class="va">p</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/ggtree/man/ggtree.html">ggtree</a></span><span class="op">(</span><span class="va">labeltree</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>color<span class="op">=</span><span class="va">group</span>, linetype<span class="op">=</span><span class="va">group</span><span class="op">)</span>, layout<span class="op">=</span><span class="st">"circular"</span><span class="op">)</span> <span class="op">+</span>
    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_manual.html">scale_color_manual</a></span><span class="op">(</span>values <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/S4Vectors/man/Vector-class.html">c</a></span><span class="op">(</span><span class="st">"#efad29"</span>, <span class="st">"#63bbd4"</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
    <span class="fu"><a href="https://rdrr.io/pkg/ggtree/man/geom_nodepoint.html">geom_nodepoint</a></span><span class="op">(</span>color<span class="op">=</span><span class="st">"black"</span>, size<span class="op">=</span><span class="fl">0.1</span><span class="op">)</span> <span class="op">+</span>
    <span class="fu"><a href="https://rdrr.io/pkg/ggtree/man/geom_tiplab.html">geom_tiplab</a></span><span class="op">(</span>size<span class="op">=</span><span class="fl">2</span>, color<span class="op">=</span><span class="st">"black"</span><span class="op">)</span>

<span class="va">p2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/ggtree/man/flip.html">flip</a></span><span class="op">(</span><span class="va">p</span>, <span class="fl">136</span>, <span class="fl">110</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> 
    <span class="fu"><a href="https://rdrr.io/pkg/ggtree/man/flip.html">flip</a></span><span class="op">(</span><span class="fl">141</span>, <span class="fl">145</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> 
    <span class="fu"><a href="https://rdrr.io/pkg/ggtree/man/rotate.html">rotate</a></span><span class="op">(</span><span class="fl">141</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> 
    <span class="fu"><a href="https://rdrr.io/pkg/ggtree/man/rotate.html">rotate</a></span><span class="op">(</span><span class="fl">142</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> 
    <span class="fu"><a href="https://rdrr.io/pkg/ggtree/man/rotate.html">rotate</a></span><span class="op">(</span><span class="fl">160</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> 
    <span class="fu"><a href="https://rdrr.io/pkg/ggtree/man/rotate.html">rotate</a></span><span class="op">(</span><span class="fl">164</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> 
    <span class="fu"><a href="https://rdrr.io/pkg/ggtree/man/rotate.html">rotate</a></span><span class="op">(</span><span class="fl">131</span><span class="op">)</span>

<span class="co">### Group V and II coloring </span>
<span class="va">dat</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span>
           node <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/S4Vectors/man/Vector-class.html">c</a></span><span class="op">(</span><span class="fl">110</span>, <span class="fl">88</span>, <span class="fl">156</span>,<span class="fl">136</span><span class="op">)</span>,
           fill <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/S4Vectors/man/Vector-class.html">c</a></span><span class="op">(</span><span class="st">"#229f8a"</span>, <span class="st">"#229f8a"</span>, <span class="st">"#229f8a"</span>, <span class="st">"#f9311f"</span><span class="op">)</span>
       <span class="op">)</span>
<span class="va">p3</span> <span class="op">&lt;-</span> <span class="va">p2</span> <span class="op">+</span>
      <span class="fu"><a href="https://rdrr.io/pkg/ggtree/man/geom-hilight.html">geom_hilight</a></span><span class="op">(</span>
          data <span class="op">=</span> <span class="va">dat</span>,
          mapping <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>
              node <span class="op">=</span> <span class="va">node</span>,
              fill <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/AsIs.html">I</a></span><span class="op">(</span><span class="va">fill</span><span class="op">)</span>
          <span class="op">)</span>,
          alpha <span class="op">=</span> <span class="fl">0.2</span>,
          extendto <span class="op">=</span> <span class="fl">1.4</span>
      <span class="op">)</span>

<span class="co">### Putting on a label on the avian specific expansion </span>
<span class="va">p4</span> <span class="op">&lt;-</span> <span class="va">p3</span> <span class="op">+</span>
      <span class="fu"><a href="https://rdrr.io/pkg/ggtree/man/geom_cladelab.html">geom_cladelab</a></span><span class="op">(</span>
          node <span class="op">=</span> <span class="fl">113</span>,
          label <span class="op">=</span> <span class="st">"Avian-specific expansion"</span>,
          align <span class="op">=</span> <span class="cn">TRUE</span>,
          angle <span class="op">=</span> <span class="op">-</span><span class="fl">35</span>,
          offset.text <span class="op">=</span> <span class="fl">0.05</span>,
          hjust <span class="op">=</span> <span class="st">"center"</span>,
          fontsize <span class="op">=</span> <span class="fl">2</span>,
          offset <span class="op">=</span> <span class="fl">.2</span>,
          barsize <span class="op">=</span> <span class="fl">.2</span>
      <span class="op">)</span>
    
<span class="co">### Adding the bootstrap values with subset used to remove all bootstraps &lt; 50  </span>
<span class="va">p5</span> <span class="op">&lt;-</span> <span class="va">p4</span> <span class="op">+</span>
      <span class="fu"><a href="https://rdrr.io/pkg/ggtree/man/geom_nodelab.html">geom_nodelab</a></span><span class="op">(</span>
          mapping <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>
              x <span class="op">=</span> <span class="va">branch</span>,
              label <span class="op">=</span> <span class="va">label</span>,
              subset <span class="op">=</span> <span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html">is.na</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/numeric.html">as.numeric</a></span><span class="op">(</span><span class="va">label</span><span class="op">)</span><span class="op">)</span> <span class="op">&amp;</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html">as.numeric</a></span><span class="op">(</span><span class="va">label</span><span class="op">)</span> <span class="op">&gt;</span> <span class="fl">50</span>
          <span class="op">)</span>,
          size <span class="op">=</span> <span class="fl">2</span>,
          color <span class="op">=</span> <span class="st">"black"</span>,
          nudge_y <span class="op">=</span> <span class="fl">0.6</span>
      <span class="op">)</span>

<span class="co">### Putting labels on the subgroups </span>
<span class="va">p6</span> <span class="op">&lt;-</span> <span class="va">p5</span> <span class="op">+</span>
      <span class="fu"><a href="https://rdrr.io/pkg/ggtree/man/geom_cladelab.html">geom_cladelab</a></span><span class="op">(</span>
          data <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span>
              node <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/S4Vectors/man/Vector-class.html">c</a></span><span class="op">(</span><span class="fl">114</span>, <span class="fl">121</span><span class="op">)</span>,
              name <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/S4Vectors/man/Vector-class.html">c</a></span><span class="op">(</span><span class="st">"Subgroup A"</span>, <span class="st">"Subgroup B"</span><span class="op">)</span>
          <span class="op">)</span>,
          mapping <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>
              node <span class="op">=</span> <span class="va">node</span>,
              label <span class="op">=</span> <span class="va">name</span>
          <span class="op">)</span>,
          align <span class="op">=</span> <span class="cn">TRUE</span>,
          offset <span class="op">=</span> <span class="fl">.05</span>,
          offset.text <span class="op">=</span> <span class="fl">.03</span>,
          hjust <span class="op">=</span> <span class="st">"center"</span>,
          barsize <span class="op">=</span> <span class="fl">.2</span>,
          fontsize <span class="op">=</span> <span class="fl">2</span>,
          angle <span class="op">=</span> <span class="st">"auto"</span>,
          horizontal <span class="op">=</span> <span class="cn">FALSE</span>
      <span class="op">)</span> <span class="op">+</span>
      <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html">theme</a></span><span class="op">(</span>
          legend.position <span class="op">=</span> <span class="st">"none"</span>,
          plot.margin <span class="op">=</span> <span class="fu">grid</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/grid/unit.html">unit</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/S4Vectors/man/Vector-class.html">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">15</span>, <span class="op">-</span><span class="fl">15</span>, <span class="op">-</span><span class="fl">15</span>, <span class="op">-</span><span class="fl">15</span><span class="op">)</span>, <span class="st">"mm"</span><span class="op">)</span>
      <span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/pkg/MicrobiotaProcess/man/print.html">print</a></span><span class="op">(</span><span class="va">p6</span><span class="op">)</span></code></pre></div>
<div class="figure">
<span style="display:block;" id="fig:treeLarsen"></span>
<img src="treedata_files/figure-html/treeLarsen-1.png" alt="Phylogenetic tree of CTLDcps. Using different background colors, line types and colors, and clade labels to distinguish groups." width="100%"><p class="caption">
FIGURE 13.3: <strong>Phylogenetic tree of CTLDcps</strong>. Using different background colors, line types and colors, and clade labels to distinguish groups.
</p>
</div>
</div>
<div id="genome-locus" class="section level2" number="13.4">
<h2>
<span class="header-section-number">13.4</span> Phylogenetic Tree with Genome Locus Structure<a class="anchor" aria-label="anchor" href="#genome-locus"><i class="fas fa-link"></i></a>
</h2>
<p>The <code><a href="https://rdrr.io/pkg/ggtree/man/geom_motif.html">geom_motif()</a></code> is defined in <a href="http://bioconductor.org/packages/ggtree"><strong>ggtree</strong></a> and it is a wrapper layer of the <code><a href="https://wilkox.org/gggenes/reference/geom_gene_arrow.html">gggenes::geom_gene_arrow()</a></code>. The <code><a href="https://rdrr.io/pkg/ggtree/man/geom_motif.html">geom_motif()</a></code> can automatically adjust genomic alignment by selective gene (via the <code>on</code> parameter) and can label genes via the <code>label</code> parameter. In the following example, we use <code>example_genes</code> dataset provided by <a href="https://CRAN.R-project.org/package=gggenes"><strong>gggenes</strong></a>. As the dataset only provides genomic coordination of a set of genes, a phylogeny for the genomes needs to be constructed first. We calculate Jaccard similarity based on the ratio of overlapping genes among genomes and correspondingly determine genome distance. The BioNJ algorithm was applied to construct the tree. Then we can use <code><a href="https://rdrr.io/pkg/ggtree/man/facet-plot.html">geom_facet()</a></code> to visualize the tree with the genomic structures (Figure <a href="chapter13.html#fig:gggenes">13.4</a>).</p>


<div class="sourceCode" id="cb261"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://dplyr.tidyverse.org">dplyr</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://ggplot2.tidyverse.org">ggplot2</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://wilkox.org/gggenes/">gggenes</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://yulab-smu.top/treedata-book/">ggtree</a></span><span class="op">)</span>

<span class="va">get_genes</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">data</span>, <span class="va">genome</span><span class="op">)</span> <span class="op">{</span>
    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="va">data</span>, <span class="va">molecule</span> <span class="op">==</span> <span class="va">genome</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/pull.html">pull</a></span><span class="op">(</span><span class="va">gene</span><span class="op">)</span>
<span class="op">}</span>

<span class="va">g</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/BiocGenerics/man/unique.html">unique</a></span><span class="op">(</span><span class="va">example_genes</span><span class="op">[</span>,<span class="fl">1</span><span class="op">]</span><span class="op">)</span>
<span class="va">n</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="va">g</span><span class="op">)</span>
<span class="va">d</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html">matrix</a></span><span class="op">(</span>nrow <span class="op">=</span> <span class="va">n</span>, ncol <span class="op">=</span> <span class="va">n</span><span class="op">)</span>
<span class="fu"><a href="https://tibble.tidyverse.org/reference/rownames.html">rownames</a></span><span class="op">(</span><span class="va">d</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/BiocGenerics/man/row_colnames.html">colnames</a></span><span class="op">(</span><span class="va">d</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="va">g</span>
<span class="va">genes</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/BiocGenerics/man/lapply.html">lapply</a></span><span class="op">(</span><span class="va">g</span>, <span class="va">get_genes</span>, data <span class="op">=</span> <span class="va">example_genes</span><span class="op">)</span>

<span class="kw">for</span> <span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="va">n</span><span class="op">)</span> <span class="op">{</span>
    <span class="kw">for</span> <span class="op">(</span><span class="va">j</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="va">i</span><span class="op">)</span> <span class="op">{</span>
        <span class="va">jaccard_sim</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="fu"><a href="https://generics.r-lib.org/reference/setops.html">intersect</a></span><span class="op">(</span><span class="va">genes</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span>, <span class="va">genes</span><span class="op">[[</span><span class="va">j</span><span class="op">]</span><span class="op">]</span><span class="op">)</span><span class="op">)</span> <span class="op">/</span> 
                       <span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="fu"><a href="https://generics.r-lib.org/reference/setops.html">union</a></span><span class="op">(</span><span class="va">genes</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span>, <span class="va">genes</span><span class="op">[[</span><span class="va">j</span><span class="op">]</span><span class="op">]</span><span class="op">)</span><span class="op">)</span>
        <span class="va">d</span><span class="op">[</span><span class="va">j</span>, <span class="va">i</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">d</span><span class="op">[</span><span class="va">i</span>, <span class="va">j</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fl">1</span> <span class="op">-</span> <span class="va">jaccard_sim</span>
    <span class="op">}</span>
<span class="op">}</span>

<span class="va">tree</span> <span class="op">&lt;-</span> <span class="fu">ape</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/ape/man/bionj.html">bionj</a></span><span class="op">(</span><span class="va">d</span><span class="op">)</span> 

<span class="va">p</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/ggtree/man/ggtree.html">ggtree</a></span><span class="op">(</span><span class="va">tree</span>, branch.length<span class="op">=</span><span class="st">'none'</span><span class="op">)</span> <span class="op">+</span> 
    <span class="fu"><a href="https://rdrr.io/pkg/ggtree/man/geom_tiplab.html">geom_tiplab</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/pkg/ggtree/man/xlim_tree.html">xlim_tree</a></span><span class="op">(</span><span class="fl">5.5</span><span class="op">)</span> <span class="op">+</span> 
    <span class="fu"><a href="https://rdrr.io/pkg/ggtree/man/facet-plot.html">geom_facet</a></span><span class="op">(</span>mapping <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>xmin <span class="op">=</span> <span class="va">start</span>, xmax <span class="op">=</span> <span class="va">end</span>, fill <span class="op">=</span> <span class="va">gene</span><span class="op">)</span>,
               data <span class="op">=</span> <span class="va">example_genes</span>, geom <span class="op">=</span> <span class="va">geom_motif</span>, panel <span class="op">=</span> <span class="st">'Alignment'</span>,
               on <span class="op">=</span> <span class="st">'genE'</span>, label <span class="op">=</span> <span class="st">'gene'</span>, align <span class="op">=</span> <span class="st">'left'</span><span class="op">)</span> <span class="op">+</span>
    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_brewer.html">scale_fill_brewer</a></span><span class="op">(</span>palette <span class="op">=</span> <span class="st">"Set3"</span><span class="op">)</span> <span class="op">+</span> 
    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_continuous.html">scale_x_continuous</a></span><span class="op">(</span>expand<span class="op">=</span><span class="fu"><a href="https://rdrr.io/pkg/S4Vectors/man/Vector-class.html">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">0</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html">theme</a></span><span class="op">(</span>strip.text<span class="op">=</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_blank</a></span><span class="op">(</span><span class="op">)</span>,
        panel.spacing<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/grid/unit.html">unit</a></span><span class="op">(</span><span class="fl">0</span>, <span class="st">'cm'</span><span class="op">)</span><span class="op">)</span>

<span class="fu"><a href="https://rdrr.io/pkg/ggtree/man/facet_widths.html">facet_widths</a></span><span class="op">(</span><span class="va">p</span>, widths<span class="op">=</span><span class="fu"><a href="https://rdrr.io/pkg/S4Vectors/man/Vector-class.html">c</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">2</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<div class="figure">
<span style="display:block;" id="fig:gggenes"></span>
<img src="treedata_files/figure-html/gggenes-1.png" alt="Genomic features with a phylogenetic tree." width="100%"><p class="caption">
FIGURE 13.4: <strong>Genomic features with a phylogenetic tree.</strong>
</p>
</div>

</div>
</div>



<div class="chapter-nav">
<div class="prev"><a href="chapter12.html"><span class="header-section-number">12</span> ggtree Utilities</a></div>
<div class="next"><a href="faq.html"><span class="header-section-number">A</span> Frequently Asked Questions</a></div>
</div></main><div class="col-md-3 col-lg-2 d-none d-md-block sidebar sidebar-chapter">
    <nav id="toc" data-toggle="toc" aria-label="On this page"><h2>On this page</h2>
      <ul class="nav navbar-nav">
<li><a class="nav-link" href="#chapter13"><span class="header-section-number">13</span> Gallery of Reproducible Examples</a></li>
<li><a class="nav-link" href="#hpv58"><span class="header-section-number">13.1</span> Visualizing pairwise nucleotide sequence distance with a phylogenetic tree</a></li>
<li><a class="nav-link" href="#symbolic-bootstrap"><span class="header-section-number">13.2</span> Displaying Different Symbolic Points for Bootstrap Values.</a></li>
<li><a class="nav-link" href="#phylo-grouping"><span class="header-section-number">13.3</span> Highlighting Different Groups</a></li>
<li><a class="nav-link" href="#genome-locus"><span class="header-section-number">13.4</span> Phylogenetic Tree with Genome Locus Structure</a></li>
</ul>

      <div class="book-extra">
        <ul class="list-unstyled">
          
        </ul>
</div>
    </nav>
</div>
</div>
  

  

</div>
 <!-- .container -->

<footer class="bg-primary text-light mt-5"><div class="container"><div class="row">

  <div class="col-12 col-md-6 mt-3">
    <p>"<strong>Data Integration, Manipulation and Visualization of Phylogenetic Trees with R</strong>" was written by Guangchuang Yu. It was last built on 2022-04-20.</p>
  </div>

  <div class="col-12 col-md-6 mt-3">
    <p>This book was built by the <a class="text-light" href="https://bookdown.org">bookdown</a> R package.</p>
  </div>

</div></div>
</footer><!-- dynamically load mathjax for compatibility with self-contained --><script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script><script type="text/x-mathjax-config">const popovers = document.querySelectorAll('a.footnote-ref[data-toggle="popover"]');
for (let popover of popovers) {
  const div = document.createElement('div');
  div.setAttribute('style', 'position: absolute; top: 0, left:0; width:0, height:0, overflow: hidden; visibility: hidden;');
  div.innerHTML = popover.getAttribute('data-content');

  var has_math = div.querySelector("span.math");
  if (has_math) {
    document.body.appendChild(div);
    MathJax.Hub.Queue(["Typeset", MathJax.Hub, div]);
    MathJax.Hub.Queue(function() {
      popover.setAttribute('data-content', div.innerHTML);
      document.body.removeChild(div);
    })
  }
}
</script>
</body>
</html>
