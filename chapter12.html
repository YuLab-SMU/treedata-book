<!DOCTYPE html>
<html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Chapter 12 ggtree Utilities | Data Integration, Manipulation and Visualization of Phylogenetic Trees</title>
<meta name="author" content="Guangchuang Yu">
<meta name="description" content="12.1 Facet Utilities  12.1.1 facet_widths Adjusting relative widths of facet panels is a common requirement, especially for using geom_facet() to visualize a tree with associated data. However,...">
<meta name="generator" content="bookdown 0.27 with bs4_book()">
<meta property="og:title" content="Chapter 12 ggtree Utilities | Data Integration, Manipulation and Visualization of Phylogenetic Trees">
<meta property="og:type" content="book">
<meta property="og:image" content="/book-cover.png">
<meta property="og:description" content="12.1 Facet Utilities  12.1.1 facet_widths Adjusting relative widths of facet panels is a common requirement, especially for using geom_facet() to visualize a tree with associated data. However,...">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Chapter 12 ggtree Utilities | Data Integration, Manipulation and Visualization of Phylogenetic Trees">
<meta name="twitter:description" content="12.1 Facet Utilities  12.1.1 facet_widths Adjusting relative widths of facet panels is a common requirement, especially for using geom_facet() to visualize a tree with associated data. However,...">
<meta name="twitter:image" content="/book-cover.png">
<!-- JS --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://kit.fontawesome.com/6ecbd6c532.js" crossorigin="anonymous"></script><script src="libs/jquery/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="libs/bootstrap/bootstrap.min.css" rel="stylesheet">
<script src="libs/bootstrap/bootstrap.bundle.min.js"></script><script src="libs/bs3compat/transition.js"></script><script src="libs/bs3compat/tabs.js"></script><script src="libs/bs3compat/bs3compat.js"></script><link href="libs/bs4_book/bs4_book.css" rel="stylesheet">
<script src="libs/bs4_book/bs4_book.js"></script><script src="libs/kePrint/kePrint.js"></script><link href="libs/lightable/lightable.css" rel="stylesheet">
<script src="libs/htmlwidgets/htmlwidgets.js"></script><script src="libs/pathseg/pathseg.js"></script><script src="libs/comic/comic.min.js"></script><script src="libs/comicR-binding/comicR.js"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- CSS --><style type="text/css">
    
    div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
  </style>
<style type="text/css">
    /* Used with Pandoc 2.11+ new --citeproc when CSL is used */
    div.csl-bib-body { }
    div.csl-entry {
      clear: both;
        }
    .hanging div.csl-entry {
      margin-left:2em;
      text-indent:-2em;
    }
    div.csl-left-margin {
      min-width:2em;
      float:left;
    }
    div.csl-right-inline {
      margin-left:2em;
      padding-left:1em;
    }
    div.csl-indent {
      margin-left: 2em;
    }
  </style>
</head>
<body data-spy="scroll" data-target="#toc">

<div class="container-fluid">
<div class="row">
  <header class="col-sm-12 col-lg-3 sidebar sidebar-book"><a class="sr-only sr-only-focusable" href="#content">Skip to main content</a>

    <div class="d-flex align-items-start justify-content-between">
      <h1>
        <a href="index.html" title="">Data Integration, Manipulation and Visualization of Phylogenetic Trees</a>
      </h1>
      <button class="btn btn-outline-primary d-lg-none ml-2 mt-1" type="button" data-toggle="collapse" data-target="#main-nav" aria-expanded="true" aria-controls="main-nav"><i class="fas fa-bars"></i><span class="sr-only">Show table of contents</span></button>
    </div>

    <div id="main-nav" class="collapse-lg">
      <form role="search">
        <input id="search" class="form-control" type="search" placeholder="Search" aria-label="Search">
</form>

      <nav aria-label="Table of contents"><h2>Table of contents</h2>
        <ul class="book-toc list-unstyled">
<li><a class="" href="index.html">Preface</a></li>
<li><a class="" href="author.html">About the Author</a></li>
<li class="book-part">Part I: Tree data input, output, and manipulation</li>
<li><a class="" href="chapter1.html"><span class="header-section-number">1</span> Importing Tree with Data</a></li>
<li><a class="" href="chapter2.html"><span class="header-section-number">2</span> Manipulating Tree with Data</a></li>
<li><a class="" href="chapter3.html"><span class="header-section-number">3</span> Exporting tree with data</a></li>
<li class="book-part">Part II: Tree data visualization and annotation</li>
<li><a class="" href="chapter4.html"><span class="header-section-number">4</span> Phylogenetic Tree Visualization</a></li>
<li><a class="" href="chapter5.html"><span class="header-section-number">5</span> Phylogenetic Tree Annotation</a></li>
<li><a class="" href="chapter6.html"><span class="header-section-number">6</span> Visual Exploration of Phylogenetic Trees</a></li>
<li><a class="" href="chapter7.html"><span class="header-section-number">7</span> Plotting tree with data</a></li>
<li><a class="" href="chapter8.html"><span class="header-section-number">8</span> Annotating Tree with Silhouette Images and Sub-plots</a></li>
<li><a class="" href="chapter9.html"><span class="header-section-number">9</span> ggtree for Other Tree-like Objects</a></li>
<li class="book-part">Part III: ggtree extensions</li>
<li><a class="" href="chapter10.html"><span class="header-section-number">10</span> ggtreeExtra for Presenting Data on a Circular Layout</a></li>
<li><a class="" href="chapter11.html"><span class="header-section-number">11</span> Other ggtree Extensions</a></li>
<li class="book-part">Part IV: Miscellaneous topics</li>
<li><a class="active" href="chapter12.html"><span class="header-section-number">12</span> ggtree Utilities</a></li>
<li><a class="" href="chapter13.html"><span class="header-section-number">13</span> Gallery of Reproducible Examples</a></li>
<li class="book-part">Appendix</li>
<li><a class="" href="faq.html"><span class="header-section-number">A</span> Frequently Asked Questions</a></li>
<li><a class="" href="related-tools.html"><span class="header-section-number">B</span> Related Tools</a></li>
<li><a class="" href="figures-and-tables.html"><span class="header-section-number">C</span> Figures and Tables</a></li>
<li><a class="" href="publications-of-the-ggtree-package-suite.html"><span class="header-section-number">D</span> Publications of the ggtree Package Suite</a></li>
<li><a class="" href="references.html">References</a></li>
</ul>

        <div class="book-extra">
          
        </div>
      </nav>
</div>
  </header><main class="col-sm-12 col-md-9 col-lg-7" id="content"><div id="chapter12" class="section level1" number="12">
<h1>
<span class="header-section-number">12</span> ggtree Utilities<a class="anchor" aria-label="anchor" href="#chapter12"><i class="fas fa-link"></i></a>
</h1>
<div id="facet-utils" class="section level2" number="12.1">
<h2>
<span class="header-section-number">12.1</span> Facet Utilities<a class="anchor" aria-label="anchor" href="#facet-utils"><i class="fas fa-link"></i></a>
</h2>
<div id="facet_widths" class="section level3" number="12.1.1">
<h3>
<span class="header-section-number">12.1.1</span> facet_widths<a class="anchor" aria-label="anchor" href="#facet_widths"><i class="fas fa-link"></i></a>
</h3>
<p>Adjusting relative widths of facet panels is a common requirement, especially for using <code><a href="https://rdrr.io/pkg/ggtree/man/facet-plot.html">geom_facet()</a></code> to visualize a tree with associated data. However, this is not supported by the <a href="https://CRAN.R-project.org/package=ggplot2"><strong>ggplot2</strong></a> package. To address this issue, <a href="http://bioconductor.org/packages/ggtree"><strong>ggtree</strong></a> provides the <code><a href="https://rdrr.io/pkg/ggtree/man/facet_widths.html">facet_widths()</a></code> function and it works with both <code>ggtree</code> and <code>ggplot</code> objects.</p>
<div class="sourceCode" id="cb234"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://ggplot2.tidyverse.org">ggplot2</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://yulab-smu.top/treedata-book/">ggtree</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/hadley/reshape">reshape2</a></span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/Random.html">set.seed</a></span><span class="op">(</span><span class="fl">123</span><span class="op">)</span></span>
<span><span class="va">tree</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/ape/man/rtree.html">rtree</a></span><span class="op">(</span><span class="fl">30</span><span class="op">)</span></span>
<span></span>
<span><span class="va">p</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/ggtree/man/ggtree.html">ggtree</a></span><span class="op">(</span><span class="va">tree</span>, branch.length <span class="op">=</span> <span class="st">"none"</span><span class="op">)</span> <span class="op">+</span> </span>
<span>    <span class="fu"><a href="https://rdrr.io/pkg/ggtree/man/geom_tiplab.html">geom_tiplab</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html">theme</a></span><span class="op">(</span>legend.position<span class="op">=</span><span class="st">'none'</span><span class="op">)</span></span>
<span></span>
<span><span class="va">a</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Uniform.html">runif</a></span><span class="op">(</span><span class="fl">30</span>, <span class="fl">0</span>,<span class="fl">1</span><span class="op">)</span></span>
<span><span class="va">b</span> <span class="op">&lt;-</span> <span class="fl">1</span> <span class="op">-</span> <span class="va">a</span></span>
<span><span class="va">df</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span><span class="va">tree</span><span class="op">$</span><span class="va">tip.label</span>, <span class="va">a</span>, <span class="va">b</span><span class="op">)</span></span>
<span><span class="va">df</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/reshape2/man/melt.html">melt</a></span><span class="op">(</span><span class="va">df</span>, id <span class="op">=</span> <span class="st">"tree.tip.label"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">p2</span> <span class="op">&lt;-</span> <span class="va">p</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/pkg/ggtree/man/facet-plot.html">geom_facet</a></span><span class="op">(</span>panel <span class="op">=</span> <span class="st">'bar'</span>, data <span class="op">=</span> <span class="va">df</span>, geom <span class="op">=</span> <span class="va">geom_bar</span>, </span>
<span>                 mapping <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">value</span>, fill <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html">as.factor</a></span><span class="op">(</span><span class="va">variable</span><span class="op">)</span><span class="op">)</span>, </span>
<span>                 orientation <span class="op">=</span> <span class="st">'y'</span>, width <span class="op">=</span> <span class="fl">0.8</span>, stat<span class="op">=</span><span class="st">'identity'</span><span class="op">)</span> <span class="op">+</span> </span>
<span>        <span class="fu"><a href="https://rdrr.io/pkg/ggtree/man/xlim_tree.html">xlim_tree</a></span><span class="op">(</span><span class="fl">9</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/ggtree/man/facet_widths.html">facet_widths</a></span><span class="op">(</span><span class="va">p2</span>, widths <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">2</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p>It also supports using a name vector to set the widths of specific panels. The following code will display an identical figure to Figure <a href="chapter12.html#fig:facetWidth">12.1</a>A.</p>
<div class="sourceCode" id="cb235"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/pkg/ggtree/man/facet_widths.html">facet_widths</a></span><span class="op">(</span><span class="va">p2</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span>Tree <span class="op">=</span> <span class="fl">.5</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p>The <code><a href="https://rdrr.io/pkg/ggtree/man/facet_widths.html">facet_widths()</a></code> function also works with other <code>ggplot</code> objects as demonstrated in Figure <a href="chapter12.html#fig:facetWidth">12.1</a>B.</p>
<div class="sourceCode" id="cb236"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">p</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="va">iris</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span><span class="va">Sepal.Width</span>, <span class="va">Petal.Length</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html">geom_point</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/facet_grid.html">facet_grid</a></span><span class="op">(</span><span class="va">.</span><span class="op">~</span><span class="va">Species</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/ggtree/man/facet_widths.html">facet_widths</a></span><span class="op">(</span><span class="va">p</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span>setosa <span class="op">=</span> <span class="fl">.5</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>


<div class="figure">
<span style="display:block;" id="fig:facetWidth"></span>
<img src="treedata_files/figure-html/facetWidth-1.svg" alt="Adjust relative widths of ggplot facets. The facet_widths() function works with ggtree (A) as well as ggplot (B)." width="98%"><p class="caption">
FIGURE 12.1: <strong>Adjust relative widths of ggplot facets.</strong> The <code><a href="https://rdrr.io/pkg/ggtree/man/facet_widths.html">facet_widths()</a></code> function works with <code>ggtree</code> (A) as well as <code>ggplot</code> (B).
</p>
</div>
</div>
<div id="facet_labeller" class="section level3" number="12.1.2">
<h3>
<span class="header-section-number">12.1.2</span> facet_labeller<a class="anchor" aria-label="anchor" href="#facet_labeller"><i class="fas fa-link"></i></a>
</h3>
<p>The <code><a href="https://rdrr.io/pkg/ggtree/man/facet_labeller.html">facet_labeller()</a></code> function was designed to relabel selected panels (Figure <a href="chapter12.html#fig:facetLab">12.2</a>), and it currently only works with <code>ggtree</code> objects (<em>i.e.</em>, <code><a href="https://rdrr.io/pkg/ggtree/man/facet-plot.html">geom_facet()</a></code> outputs). A more versatile version that works with both <code>ggtree</code> and <code>ggplot</code> objects is implemented in the <a href="https://CRAN.R-project.org/package=ggfun"><strong>ggfun</strong></a> package (<em>i.e.</em>, the <code>facet_set()</code> function).</p>
<div class="sourceCode" id="cb237"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/pkg/ggtree/man/facet_labeller.html">facet_labeller</a></span><span class="op">(</span><span class="va">p2</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span>Tree <span class="op">=</span> <span class="st">"phylogeny"</span>, bar <span class="op">=</span> <span class="st">"HELLO"</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p>If you want to combine <code><a href="https://rdrr.io/pkg/ggtree/man/facet_widths.html">facet_widths()</a></code> with <code><a href="https://rdrr.io/pkg/ggtree/man/facet_labeller.html">facet_labeller()</a></code>, you need to call <code><a href="https://rdrr.io/pkg/ggtree/man/facet_labeller.html">facet_labeller()</a></code> to relabel the panels before using <code><a href="https://rdrr.io/pkg/ggtree/man/facet_widths.html">facet_widths()</a></code> to set the relative widths of each panel. Otherwise, it won’t work since the output of <code><a href="https://rdrr.io/pkg/ggtree/man/facet_widths.html">facet_widths()</a></code> is redrawn from <code>grid</code> object.</p>
<div class="sourceCode" id="cb238"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/pkg/ggtree/man/facet_labeller.html">facet_labeller</a></span><span class="op">(</span><span class="va">p2</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span>Tree <span class="op">=</span> <span class="st">"phylogeny"</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> <span class="fu"><a href="https://rdrr.io/pkg/ggtree/man/facet_widths.html">facet_widths</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span>Tree <span class="op">=</span> <span class="fl">.4</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>


<div class="figure">
<span style="display:block;" id="fig:facetLab"></span>
<img src="treedata_files/figure-html/facetLab-1.svg" alt="Rename facet labels. Rename multiple labels simultaneously (A) or only for a specific one (B) are all supported. facet_labeller() can combine with facet_widths() to rename facet label and then adjust relative widths (B)." width="98%"><p class="caption">
FIGURE 12.2: <strong>Rename facet labels.</strong> Rename multiple labels simultaneously (A) or only for a specific one (B) are all supported. <code><a href="https://rdrr.io/pkg/ggtree/man/facet_labeller.html">facet_labeller()</a></code> can combine with <code><a href="https://rdrr.io/pkg/ggtree/man/facet_widths.html">facet_widths()</a></code> to rename facet label and then adjust relative widths (B).
</p>
</div>
</div>
</div>
<div id="geom2" class="section level2" number="12.2">
<h2>
<span class="header-section-number">12.2</span> Geometric Layers<a class="anchor" aria-label="anchor" href="#geom2"><i class="fas fa-link"></i></a>
</h2>
<p>Subsetting is not supported in layers defined in <a href="https://CRAN.R-project.org/package=ggplot2"><strong>ggplot2</strong></a>, while it is quite useful in phylogenetic annotation since it allows us to annotate at specific node(s) (e.g., only label bootstrap values that are larger than 75).</p>
<p>In <a href="http://bioconductor.org/packages/ggtree"><strong>ggtree</strong></a>, we provide several modified versions of layers defined in <a href="https://CRAN.R-project.org/package=ggplot2"><strong>ggplot2</strong></a> to support the <code>subset</code> aesthetic mapping, including:</p>
<ul>
<li><code><a href="https://rdrr.io/pkg/ggtree/man/geom_segment2.html">geom_segment2()</a></code></li>
<li><code><a href="https://rdrr.io/pkg/ggtree/man/geom_point2.html">geom_point2()</a></code></li>
<li><code><a href="https://rdrr.io/pkg/ggtree/man/geom_text2.html">geom_text2()</a></code></li>
<li><code><a href="https://rdrr.io/pkg/ggtree/man/geom_label2.html">geom_label2()</a></code></li>
</ul>
<p>These layers works with both <a href="http://bioconductor.org/packages/ggtree"><strong>ggtree</strong></a> and <a href="https://CRAN.R-project.org/package=ggplot2"><strong>ggplot2</strong></a> (Figure <a href="chapter12.html#fig:layer2">12.3</a>).</p>


<div class="sourceCode" id="cb239"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://ggplot2.tidyverse.org">ggplot2</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://yulab-smu.top/treedata-book/">ggtree</a></span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/data.html">data</a></span><span class="op">(</span><span class="va">mpg</span><span class="op">)</span></span>
<span><span class="va">p</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">mpg</span>, mapping <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">displ</span>, y <span class="op">=</span> <span class="va">hwy</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>   <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html">geom_point</a></span><span class="op">(</span>mapping <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>color <span class="op">=</span> <span class="va">class</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> </span>
<span>   <span class="fu"><a href="https://rdrr.io/pkg/ggtree/man/geom_text2.html">geom_text2</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>label<span class="op">=</span><span class="va">manufacturer</span>, </span>
<span>                  subset <span class="op">=</span> <span class="va">hwy</span> <span class="op">&gt;</span> <span class="fl">40</span> <span class="op">|</span> <span class="va">displ</span> <span class="op">&gt;</span> <span class="fl">6.5</span><span class="op">)</span>, </span>
<span>                  nudge_y <span class="op">=</span> <span class="fl">1</span><span class="op">)</span> <span class="op">+</span></span>
<span>   <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/coord_cartesian.html">coord_cartesian</a></span><span class="op">(</span>clip <span class="op">=</span> <span class="st">"off"</span><span class="op">)</span> <span class="op">+</span></span>
<span>   <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html">theme_light</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>   <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html">theme</a></span><span class="op">(</span>legend.position <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">.85</span>, <span class="fl">.75</span><span class="op">)</span><span class="op">)</span>          </span>
<span></span>
<span><span class="va">p2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/ggtree/man/ggtree.html">ggtree</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/ape/man/rtree.html">rtree</a></span><span class="op">(</span><span class="fl">10</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> </span>
<span>    <span class="fu"><a href="https://rdrr.io/pkg/ggtree/man/geom_label2.html">geom_label2</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>subset <span class="op">=</span> <span class="va">node</span> <span class="op">&lt;</span><span class="fl">5</span>, label <span class="op">=</span> <span class="va">label</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/aplot/man/plot_list.html">plot_list</a></span><span class="op">(</span><span class="va">p</span>, <span class="va">p2</span>, ncol<span class="op">=</span><span class="fl">2</span>, tag_levels<span class="op">=</span><span class="st">'A'</span><span class="op">)</span></span></code></pre></div>
<div class="figure">
<span style="display:block;" id="fig:layer2"></span>
<img src="treedata_files/figure-html/layer2-1.svg" alt="Geometric layers that support subsetting. These layers work with ggplot2 (A) and ggtree (B)." width="100%"><p class="caption">
FIGURE 12.3: <strong>Geometric layers that support subsetting.</strong> These layers work with <code>ggplot2</code> (A) and <code>ggtree</code> (B).
</p>
</div>
</div>
<div id="layout-utilities" class="section level2" number="12.3">
<h2>
<span class="header-section-number">12.3</span> Layout Utilities<a class="anchor" aria-label="anchor" href="#layout-utilities"><i class="fas fa-link"></i></a>
</h2>
<p>In <a href="chapter4.html#tree-layouts">session 4.2</a>, we introduce several layouts supported by <a href="http://bioconductor.org/packages/ggtree"><strong>ggtree</strong></a>. The <a href="http://bioconductor.org/packages/ggtree"><strong>ggtree</strong></a> package also provides several layout functions that can transform from one to another. Note that not all layouts are supported (see Table <a href="chapter12.html#tab:layoutLayerTab">12.1</a> and Figure <a href="chapter12.html#fig:layoutLayer">12.4</a>).</p>
<div class="inline-table"><table class="table table-sm">
<caption>
<span id="tab:layoutLayerTab">TABLE 12.1: </span>Layout transformers.
</caption>
<thead><tr>
<th style="text-align:left;">
Layout
</th>
<th style="text-align:left;">
Description
</th>
</tr></thead>
<tbody>
<tr>
<td style="text-align:left;">
layout_circular
</td>
<td style="text-align:left;">
transform rectangular layout to circular layout
</td>
</tr>
<tr>
<td style="text-align:left;">
layout_dendrogram
</td>
<td style="text-align:left;">
transform rectangular layout to dendrogram layout
</td>
</tr>
<tr>
<td style="text-align:left;">
layout_fan
</td>
<td style="text-align:left;">
transform rectangular/circular layout to fan layout
</td>
</tr>
<tr>
<td style="text-align:left;">
layout_rectangular
</td>
<td style="text-align:left;">
transform circular/fan layout to rectangular layout
</td>
</tr>
<tr>
<td style="text-align:left;">
layout_inward_circular
</td>
<td style="text-align:left;">
transform rectangular/circular layout to inward_circular layout
</td>
</tr>
</tbody>
</table></div>
<div class="sourceCode" id="cb240"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/Random.html">set.seed</a></span><span class="op">(</span><span class="fl">2019</span><span class="op">)</span></span>
<span><span class="va">x</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/ape/man/rtree.html">rtree</a></span><span class="op">(</span><span class="fl">20</span><span class="op">)</span></span>
<span><span class="va">p</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/ggtree/man/ggtree.html">ggtree</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span></span>
<span><span class="va">p</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/pkg/ggtree/man/tree-layout.html">layout_dendrogram</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/ggtree/man/ggtree.html">ggtree</a></span><span class="op">(</span><span class="va">x</span>, layout <span class="op">=</span> <span class="st">"circular"</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/pkg/ggtree/man/tree-layout.html">layout_rectangular</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="va">p</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/pkg/ggtree/man/tree-layout.html">layout_circular</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="va">p</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/pkg/ggtree/man/tree-layout.html">layout_fan</a></span><span class="op">(</span>angle<span class="op">=</span><span class="fl">90</span><span class="op">)</span></span>
<span><span class="va">p</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/pkg/ggtree/man/tree-layout.html">layout_inward_circular</a></span><span class="op">(</span>xlim<span class="op">=</span><span class="fl">4</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/pkg/ggtree/man/geom_tiplab.html">geom_tiplab</a></span><span class="op">(</span>hjust<span class="op">=</span><span class="fl">1</span><span class="op">)</span></span></code></pre></div>


<div class="figure">
<span style="display:block;" id="fig:layoutLayer"></span>
<img src="treedata_files/figure-html/layoutLayer-1.svg" alt="Layout functions for transforming among different layouts. Default rectangular layout (A); transform rectangular to dendrogram layout (B); transform circular to rectangular layout (C); transform rectangular to circular layout (D); transform rectangular to fan layout (E); transform rectangular to inward circular layout (F)." width="100%"><p class="caption">
FIGURE 12.4: <strong>Layout functions for transforming among different layouts</strong>. Default rectangular layout (A); transform rectangular to dendrogram layout (B); transform circular to rectangular layout (C); transform rectangular to circular layout (D); transform rectangular to fan layout (E); transform rectangular to inward circular layout (F).
</p>
</div>
</div>
<div id="scale-utilities" class="section level2" number="12.4">
<h2>
<span class="header-section-number">12.4</span> Scale Utilities<a class="anchor" aria-label="anchor" href="#scale-utilities"><i class="fas fa-link"></i></a>
</h2>
<p>The <a href="http://bioconductor.org/packages/ggtree"><strong>ggtree</strong></a> package provides several scale functions to manipulate the <em>x</em>-axis, including the <code><a href="https://rdrr.io/pkg/ggtree/man/scale_x_range.html">scale_x_range()</a></code> documented in <a href="chapter5.html#uncertainty-of-evolutionary-inference">session 5.2.4</a>, <code><a href="https://rdrr.io/pkg/ggtree/man/xlim_tree.html">xlim_tree()</a></code>, <code><a href="https://rdrr.io/pkg/ggtree/man/xlim_expand.html">xlim_expand()</a></code>, <code><a href="https://rdrr.io/pkg/ggtree/man/ggexpand.html">ggexpand()</a></code>, <code><a href="https://rdrr.io/pkg/ggtree/man/ggexpand.html">hexpand()</a></code> and <code><a href="https://rdrr.io/pkg/ggtree/man/ggexpand.html">vexpand()</a></code>.</p>
<div id="xlim_expand" class="section level3" number="12.4.1">
<h3>
<span class="header-section-number">12.4.1</span> Expand x limit for a specific facet panel<a class="anchor" aria-label="anchor" href="#xlim_expand"><i class="fas fa-link"></i></a>
</h3>
<p>Sometimes we need to set <code>xlim</code> for a specific facet panel (<em>e.g.</em>, allocate more space for <a href="faq.html#faq-label-truncated">long tip labels</a> at <code>Tree</code> panel). However, the <code><a href="https://ggplot2.tidyverse.org/reference/lims.html">ggplot2::xlim()</a></code> function applies to all the panels. The <a href="http://bioconductor.org/packages/ggtree"><strong>ggtree</strong></a> provides <code><a href="https://rdrr.io/pkg/ggtree/man/xlim_expand.html">xlim_expand()</a></code> to adjust <code>xlim</code> for user-specific facet panel. It accepts two parameters, <code>xlim</code>, and <code>panel</code>, and can adjust all individual panels as demonstrated in Figure <a href="chapter12.html#fig:xlimExpand">12.5</a>A. If you only want to adjust <code>xlim</code> of the <code>Tree</code> panel, you can use <code><a href="https://rdrr.io/pkg/ggtree/man/xlim_tree.html">xlim_tree()</a></code> as a shortcut.</p>
<div class="sourceCode" id="cb241"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/Random.html">set.seed</a></span><span class="op">(</span><span class="fl">2019</span><span class="op">-</span><span class="fl">05</span><span class="op">-</span><span class="fl">02</span><span class="op">)</span></span>
<span><span class="va">x</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/ape/man/rtree.html">rtree</a></span><span class="op">(</span><span class="fl">30</span><span class="op">)</span></span>
<span><span class="va">p</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/ggtree/man/ggtree.html">ggtree</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/pkg/ggtree/man/geom_tiplab.html">geom_tiplab</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="va">d</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span>label <span class="op">=</span> <span class="va">x</span><span class="op">$</span><span class="va">tip.label</span>, </span>
<span>                value <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html">rnorm</a></span><span class="op">(</span><span class="fl">30</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">p2</span> <span class="op">&lt;-</span> <span class="va">p</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/pkg/ggtree/man/facet-plot.html">geom_facet</a></span><span class="op">(</span>panel <span class="op">=</span> <span class="st">"Dot"</span>, data <span class="op">=</span> <span class="va">d</span>, </span>
<span>            geom <span class="op">=</span> <span class="va">geom_point</span>, mapping <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">value</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">p2</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/pkg/ggtree/man/xlim_tree.html">xlim_tree</a></span><span class="op">(</span><span class="fl">6</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/pkg/ggtree/man/xlim_expand.html">xlim_expand</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">10</span>, <span class="fl">10</span><span class="op">)</span>, <span class="st">'Dot'</span><span class="op">)</span></span></code></pre></div>
<p>The <code><a href="https://rdrr.io/pkg/ggtree/man/xlim_expand.html">xlim_expand()</a></code> function also works with <code><a href="https://ggplot2.tidyverse.org/reference/facet_grid.html">ggplot2::facet_grid()</a></code>. As demonstrated in Figure <a href="chapter12.html#fig:xlimExpand">12.5</a>B, only the <code>xlim</code> of <em>virginica</em> panel was adjusted by <code><a href="https://rdrr.io/pkg/ggtree/man/xlim_expand.html">xlim_expand()</a></code>.</p>
<div class="sourceCode" id="cb242"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">g</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="va">iris</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span><span class="va">Sepal.Length</span>, <span class="va">Sepal.Width</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> </span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html">geom_point</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/facet_grid.html">facet_grid</a></span><span class="op">(</span><span class="va">.</span> <span class="op">~</span> <span class="va">Species</span>, scales <span class="op">=</span> <span class="st">"free_x"</span><span class="op">)</span> </span>
<span><span class="va">g</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/pkg/ggtree/man/xlim_expand.html">xlim_expand</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">15</span><span class="op">)</span>, <span class="st">'virginica'</span><span class="op">)</span></span></code></pre></div>


<div class="figure">
<span style="display:block;" id="fig:xlimExpand"></span>
<img src="treedata_files/figure-html/xlimExpand-1.svg" alt="Setting xlim for user-specific facet panels. Using xlim_tree() to set the Tree panel of the ggtree output (A) and xlim_expand() to set the Dot panel of the ggtree output (A) and the Virginica panel of the ggplot output (B)." width="100%"><p class="caption">
FIGURE 12.5: <strong>Setting xlim for user-specific facet panels.</strong> Using <code><a href="https://rdrr.io/pkg/ggtree/man/xlim_tree.html">xlim_tree()</a></code> to set the Tree panel of the <code>ggtree</code> output (A) and <code><a href="https://rdrr.io/pkg/ggtree/man/xlim_expand.html">xlim_expand()</a></code> to set the Dot panel of the <code>ggtree</code> output (A) and the Virginica panel of the <code>ggplot</code> output (B).
</p>
</div>
</div>
<div id="ggexpand" class="section level3" number="12.4.2">
<h3>
<span class="header-section-number">12.4.2</span> Expand plot limit by the ratio of plot range<a class="anchor" aria-label="anchor" href="#ggexpand"><i class="fas fa-link"></i></a>
</h3>
<p>The <a href="https://CRAN.R-project.org/package=ggplot2"><strong>ggplot2</strong></a> package cannot automatically adjust plot limits and it is very common that long text was truncated. Users need to adjust x (y) limits manually via the <code><a href="https://ggplot2.tidyverse.org/reference/lims.html">xlim()</a></code> (<code><a href="https://ggplot2.tidyverse.org/reference/lims.html">ylim()</a></code>) command (see also <a href="faq.html#faq-label-truncated">FAQ: Tip label truncated</a>).</p>
<p>The <code><a href="https://ggplot2.tidyverse.org/reference/lims.html">xlim()</a></code> (<code><a href="https://ggplot2.tidyverse.org/reference/lims.html">ylim()</a></code>) is a good solution to this issue. However, we can make it more simple, by expanding the plot panel by a ratio of the axis range without knowing what the exact value is.</p>
<p>We provide <code><a href="https://rdrr.io/pkg/ggtree/man/ggexpand.html">hexpand()</a></code> function to expand x limit by specifying a fraction of the x range and it works for both directions (<code>direction=1</code> for right-hand side and <code>direction=-1</code> for left-hand side) (Figure <a href="chapter12.html#fig:hexpand">12.6</a>). Another version of <code><a href="https://rdrr.io/pkg/ggtree/man/ggexpand.html">vexpand()</a></code> works with similar behavior for <em>y</em>-axis and the <code><a href="https://rdrr.io/pkg/ggtree/man/ggexpand.html">ggexpand()</a></code> function works for both <em>x</em>- and <em>y</em>-axis (Figure <a href="chapter11.html#fig:phylonetworx">11.2</a>).</p>


<div class="sourceCode" id="cb243"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">x</span><span class="op">$</span><span class="va">tip.label</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span><span class="st">'to make the label longer_'</span>, <span class="va">x</span><span class="op">$</span><span class="va">tip.label</span><span class="op">)</span></span>
<span><span class="va">p1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/ggtree/man/ggtree.html">ggtree</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/pkg/ggtree/man/geom_tiplab.html">geom_tiplab</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/pkg/ggtree/man/ggexpand.html">hexpand</a></span><span class="op">(</span><span class="fl">.4</span><span class="op">)</span></span>
<span><span class="va">p2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="va">iris</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span><span class="va">Sepal.Width</span>, <span class="va">Petal.Width</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> </span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html">geom_point</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span> </span>
<span>    <span class="fu"><a href="https://rdrr.io/pkg/ggtree/man/ggexpand.html">hexpand</a></span><span class="op">(</span><span class="fl">.2</span>, direction <span class="op">=</span> <span class="op">-</span><span class="fl">1</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/pkg/ggtree/man/ggexpand.html">vexpand</a></span><span class="op">(</span><span class="fl">.2</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/aplot/man/plot_list.html">plot_list</a></span><span class="op">(</span><span class="va">p1</span>, <span class="va">p2</span>, tag_levels<span class="op">=</span><span class="st">"A"</span>, widths<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">.6</span>, <span class="fl">.4</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<div class="figure">
<span style="display:block;" id="fig:hexpand"></span>
<img src="treedata_files/figure-html/hexpand-1.png" alt="Expanding plot limits by a fraction of the x or y range. Expand x limit at right-hand side by default (A), and expand x limit for left-hand side when direction = -1 and expand y limit at the upper side (B)." width="100%"><p class="caption">
FIGURE 12.6: <strong>Expanding plot limits by a fraction of the x or y range.</strong> Expand x limit at right-hand side by default (A), and expand x limit for left-hand side when direction = -1 and expand y limit at the upper side (B).
</p>
</div>
</div>
</div>
<div id="tree-data-utilities" class="section level2" number="12.5">
<h2>
<span class="header-section-number">12.5</span> Tree data utilities<a class="anchor" aria-label="anchor" href="#tree-data-utilities"><i class="fas fa-link"></i></a>
</h2>
<div id="td_filter" class="section level3" number="12.5.1">
<h3>
<span class="header-section-number">12.5.1</span> Filter tree data<a class="anchor" aria-label="anchor" href="#td_filter"><i class="fas fa-link"></i></a>
</h3>
<p>The <a href="http://bioconductor.org/packages/ggtree"><strong>ggtree</strong></a> package defined <a href="chapter12.html#geom2">several geom layers</a> that support subsetting tree data. However, many other geom layers that didn’t provide this feature, are defined in <a href="https://CRAN.R-project.org/package=ggplot2"><strong>ggplot2</strong></a> and its extensions. To allow filtering tree data with these layers, <a href="http://bioconductor.org/packages/ggtree"><strong>ggtree</strong></a> provides an accompanying function, <code><a href="https://rdrr.io/pkg/ggtree/man/td_filter.html">td_filter()</a></code> that returns a function that works similar to <code><a href="https://dplyr.tidyverse.org/reference/filter.html">dplyr::filter()</a></code> and can be passed to the <code>data</code> parameter in geom layers to filter <code>ggtree</code> plot data as demonstrated in Figure <a href="chapter12.html#fig:tdFilter">12.7</a>.</p>


<div class="sourceCode" id="cb244"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://yulab-smu.top/treedata-book/">tidytree</a></span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/Random.html">set.seed</a></span><span class="op">(</span><span class="fl">1997</span><span class="op">)</span></span>
<span><span class="va">tree</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/ape/man/rtree.html">rtree</a></span><span class="op">(</span><span class="fl">50</span><span class="op">)</span></span>
<span><span class="va">p</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/ggtree/man/ggtree.html">ggtree</a></span><span class="op">(</span><span class="va">tree</span><span class="op">)</span> </span>
<span><span class="va">selected_nodes</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/tidytree/man/offspring.html">offspring</a></span><span class="op">(</span><span class="va">p</span>, <span class="fl">67</span><span class="op">)</span><span class="op">$</span><span class="va">node</span></span>
<span><span class="va">p</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_text.html">geom_text</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>label<span class="op">=</span><span class="va">label</span><span class="op">)</span>, </span>
<span>            data<span class="op">=</span><span class="fu"><a href="https://rdrr.io/pkg/ggtree/man/td_filter.html">td_filter</a></span><span class="op">(</span><span class="va">isTip</span> <span class="op">&amp;</span> </span>
<span>                        <span class="va">node</span> <span class="op"><a href="https://rdrr.io/r/base/match.html">%in%</a></span> <span class="va">selected_nodes</span><span class="op">)</span>, </span>
<span>            hjust<span class="op">=</span><span class="fl">0</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/pkg/ggtree/man/geom_nodepoint.html">geom_nodepoint</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>subset <span class="op">=</span> <span class="va">node</span> <span class="op">==</span><span class="fl">67</span><span class="op">)</span>, </span>
<span>                    size<span class="op">=</span><span class="fl">5</span>, color<span class="op">=</span><span class="st">'blue'</span><span class="op">)</span></span></code></pre></div>
<div class="figure">
<span style="display:block;" id="fig:tdFilter"></span>
<img src="treedata_files/figure-html/tdFilter-1.svg" alt="Filtering ggtree plot data in geom layers. Only selected tips (offspring of the node indicated by the blue circle point) were labeled." width="98%"><p class="caption">
FIGURE 12.7: <strong>Filtering ggtree plot data in geom layers.</strong> Only selected tips (offspring of the node indicated by the blue circle point) were labeled.
</p>
</div>
</div>
<div id="td_unnest" class="section level3" number="12.5.2">
<h3>
<span class="header-section-number">12.5.2</span> Flatten list-column tree data<a class="anchor" aria-label="anchor" href="#td_unnest"><i class="fas fa-link"></i></a>
</h3>
<p>The <code>ggtree</code> plot data is a tidy data frame where each row represents a unique node. If multiple values are associated with a node, the data can be stored as nested data (i.e., in a list-column).</p>
<div class="sourceCode" id="cb245"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/Random.html">set.seed</a></span><span class="op">(</span><span class="fl">1997</span><span class="op">)</span></span>
<span><span class="va">tr</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/ape/man/rtree.html">rtree</a></span><span class="op">(</span><span class="fl">5</span><span class="op">)</span></span>
<span><span class="va">d</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span>id<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span><span class="op">(</span><span class="va">tr</span><span class="op">$</span><span class="va">tip.label</span>,<span class="fl">2</span><span class="op">)</span>, </span>
<span>                value<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/MathFun.html">abs</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/Normal.html">rnorm</a></span><span class="op">(</span><span class="fl">10</span>, <span class="fl">6</span>, <span class="fl">2</span><span class="op">)</span><span class="op">)</span>, </span>
<span>                group<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span><span class="op">(</span><span class="st">"A"</span>, <span class="fl">5</span><span class="op">)</span>,<span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span><span class="op">(</span><span class="st">"B"</span>,<span class="fl">5</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">require</a></span><span class="op">(</span><span class="va"><a href="https://tidyr.tidyverse.org">tidyr</a></span><span class="op">)</span></span>
<span><span class="va">d2</span>  <span class="op">&lt;-</span> <span class="fu"><a href="https://tidyr.tidyverse.org/reference/nest.html">nest</a></span><span class="op">(</span><span class="va">d</span>, value <span class="op">=</span><span class="va">value</span>, group<span class="op">=</span><span class="va">group</span><span class="op">)</span></span>
<span><span class="co">## d2 is a nested data</span></span>
<span><span class="va">d2</span></span></code></pre></div>
<pre><code>## # A tibble: 5 × 3
##   id    value            group           
##   &lt;chr&gt; &lt;list&gt;           &lt;list&gt;          
## 1 t2    &lt;tibble [2 × 1]&gt; &lt;tibble [2 × 1]&gt;
## 2 t1    &lt;tibble [2 × 1]&gt; &lt;tibble [2 × 1]&gt;
## 3 t5    &lt;tibble [2 × 1]&gt; &lt;tibble [2 × 1]&gt;
## 4 t4    &lt;tibble [2 × 1]&gt; &lt;tibble [2 × 1]&gt;
## 5 t3    &lt;tibble [2 × 1]&gt; &lt;tibble [2 × 1]&gt;</code></pre>
<p>Nested data is supported by the operator, <code>%&lt;+%</code>, and can be mapped to the tree structure. If a geom layer can’t directly support visualizing nested data, we need to flatten the data before applying the geom layer to display it. The <a href="http://bioconductor.org/packages/ggtree"><strong>ggtree</strong></a> package provides a function, <code><a href="https://rdrr.io/pkg/ggtree/man/td_unnest.html">td_unnest()</a></code>, which returns a function that works similar to <code><a href="https://tidyr.tidyverse.org/reference/nest.html">tidyr::unnest()</a></code> and can be used to flatten <code>ggtree</code> plot data as demonstrated in Figure <a href="chapter12.html#fig:tdUnnest">12.8</a>A.</p>
<p>All tree data utilities provide a <code>.f</code> parameter to pass a function to pre-operate the data. This creates the possibility to combine different tree data utilities as demonstrated in Figure <a href="chapter12.html#fig:tdUnnest">12.8</a>B.</p>


<div class="sourceCode" id="cb247"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">p</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/ggtree/man/ggtree.html">ggtree</a></span><span class="op">(</span><span class="va">tr</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/pkg/ggtree/man/attacher.html">%&lt;+%</a></span> <span class="va">d2</span></span>
<span><span class="va">p2</span> <span class="op">&lt;-</span> <span class="va">p</span> <span class="op">+</span> </span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html">geom_point</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span><span class="va">x</span>, <span class="va">y</span>, size<span class="op">=</span> <span class="va">value</span>, colour<span class="op">=</span><span class="va">group</span><span class="op">)</span>, </span>
<span>            data <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/ggtree/man/td_unnest.html">td_unnest</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="va">value</span>, <span class="va">group</span><span class="op">)</span><span class="op">)</span>, alpha<span class="op">=</span><span class="fl">.4</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_size.html">scale_size</a></span><span class="op">(</span>range<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">3</span>,<span class="fl">10</span><span class="op">)</span>, limits<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">3</span>, <span class="fl">10</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">p3</span> <span class="op">&lt;-</span> <span class="va">p</span> <span class="op">+</span> </span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html">geom_point</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span><span class="va">x</span>, <span class="va">y</span>, size<span class="op">=</span> <span class="va">value</span>, colour<span class="op">=</span><span class="va">group</span><span class="op">)</span>, </span>
<span>            data <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/ggtree/man/td_unnest.html">td_unnest</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="va">value</span>, <span class="va">group</span><span class="op">)</span>, </span>
<span>                        .f <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/ggtree/man/td_filter.html">td_filter</a></span><span class="op">(</span><span class="va">isTip</span> <span class="op">&amp;</span> <span class="va">node</span><span class="op">==</span><span class="fl">4</span><span class="op">)</span><span class="op">)</span>, </span>
<span>            alpha<span class="op">=</span><span class="fl">.4</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_size.html">scale_size</a></span><span class="op">(</span>range<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">3</span>,<span class="fl">10</span><span class="op">)</span>, limits<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">3</span>, <span class="fl">10</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/aplot/man/plot_list.html">plot_list</a></span><span class="op">(</span><span class="va">p2</span>, <span class="va">p3</span>, tag_levels <span class="op">=</span> <span class="st">'A'</span><span class="op">)</span></span></code></pre></div>
<div class="figure">
<span style="display:block;" id="fig:tdUnnest"></span>
<img src="treedata_files/figure-html/tdUnnest-1.svg" alt="Flattening ggtree plot data. List-columns can be flattened by td_unnest() and two circle points were displayed on each tip simultaneously (A). Different tree data utilities can be combined to work together, e.g., filter data by td_filter(), and then flatten it by td_unnest()) (B)." width="100%"><p class="caption">
FIGURE 12.8: <strong>Flattening ggtree plot data.</strong> List-columns can be flattened by <code><a href="https://rdrr.io/pkg/ggtree/man/td_unnest.html">td_unnest()</a></code> and two circle points were displayed on each tip simultaneously (A). Different tree data utilities can be combined to work together, e.g., filter data by <code><a href="https://rdrr.io/pkg/ggtree/man/td_filter.html">td_filter()</a></code>, and then flatten it by <code><a href="https://rdrr.io/pkg/ggtree/man/td_unnest.html">td_unnest()</a></code>) (B).
</p>
</div>
</div>
</div>
<div id="tree-utilities" class="section level2" number="12.6">
<h2>
<span class="header-section-number">12.6</span> Tree Utilities<a class="anchor" aria-label="anchor" href="#tree-utilities"><i class="fas fa-link"></i></a>
</h2>
<div id="tiporder" class="section level3" number="12.6.1">
<h3>
<span class="header-section-number">12.6.1</span> Extract tip order<a class="anchor" aria-label="anchor" href="#tiporder"><i class="fas fa-link"></i></a>
</h3>
<p>To create <a href="chapter7.html#composite_plot">composite plots</a>, users need to re-order their data manually before creating tree-associated graphs. The order of their data should be consistent with the tip order presented in the <code><a href="https://rdrr.io/pkg/ggtree/man/ggtree.html">ggtree()</a></code> plot. For this purpose, we provide the <code><a href="https://rdrr.io/pkg/ggtree/man/get_taxa_name.html">get_taxa_name()</a></code> function to extract an ordered vector of tips based on the tree structure plotted by <code><a href="https://rdrr.io/pkg/ggtree/man/ggtree.html">ggtree()</a></code>.</p>


<div class="sourceCode" id="cb248"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/Random.html">set.seed</a></span><span class="op">(</span><span class="fl">123</span><span class="op">)</span></span>
<span><span class="va">tree</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/ape/man/rtree.html">rtree</a></span><span class="op">(</span><span class="fl">10</span><span class="op">)</span></span>
<span><span class="va">p</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/ggtree/man/ggtree.html">ggtree</a></span><span class="op">(</span><span class="va">tree</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/pkg/ggtree/man/geom_tiplab.html">geom_tiplab</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span> </span>
<span>    <span class="fu"><a href="https://rdrr.io/pkg/ggtree/man/geom-hilight.html">geom_hilight</a></span><span class="op">(</span>node <span class="op">=</span> <span class="fl">12</span>, extendto <span class="op">=</span> <span class="fl">2.5</span><span class="op">)</span></span>
<span></span>
<span><span class="va">x</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste</a></span><span class="op">(</span><span class="st">"Taxa order:"</span>, </span>
<span>        <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/ggtree/man/get_taxa_name.html">get_taxa_name</a></span><span class="op">(</span><span class="va">p</span><span class="op">)</span>, collapse<span class="op">=</span><span class="st">', '</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">p</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span><span class="op">(</span>title<span class="op">=</span><span class="va">x</span><span class="op">)</span></span></code></pre></div>
<div class="figure">
<span style="display:block;" id="fig:tiporder"></span>
<img src="treedata_files/figure-html/tiporder-1.svg" alt="An example tree for demonstrating get_taxa_name() function." width="98%"><p class="caption">
FIGURE 12.9: <strong>An example tree for demonstrating <code><a href="https://rdrr.io/pkg/ggtree/man/get_taxa_name.html">get_taxa_name()</a></code> function.</strong>
</p>
</div>
<p>The <code><a href="https://rdrr.io/pkg/ggtree/man/get_taxa_name.html">get_taxa_name()</a></code> function will return a vector of ordered tip labels according to the tree structure displayed in Figure <a href="chapter12.html#fig:tiporder">12.9</a>.</p>
<div class="sourceCode" id="cb249"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/pkg/ggtree/man/get_taxa_name.html">get_taxa_name</a></span><span class="op">(</span><span class="va">p</span><span class="op">)</span></span></code></pre></div>
<pre><code>##  [1] "t9"  "t8"  "t3"  "t2"  "t7"  "t10" "t1"  "t5" 
##  [9] "t6"  "t4"</code></pre>
<p>If users specify a node, the <code><a href="https://rdrr.io/pkg/ggtree/man/get_taxa_name.html">get_taxa_name()</a></code> will extract the tip order of the selected clade (i.e., highlighted region in Figure <a href="chapter12.html#fig:tiporder">12.9</a>).</p>
<div class="sourceCode" id="cb251"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/pkg/ggtree/man/get_taxa_name.html">get_taxa_name</a></span><span class="op">(</span><span class="va">p</span>, node <span class="op">=</span> <span class="fl">12</span><span class="op">)</span></span></code></pre></div>
<pre><code>## [1] "t5" "t6" "t4"</code></pre>
</div>
<div id="padding-taxa-labels" class="section level3" number="12.6.2">
<h3>
<span class="header-section-number">12.6.2</span> Padding taxa labels<a class="anchor" aria-label="anchor" href="#padding-taxa-labels"><i class="fas fa-link"></i></a>
</h3>
<p>The <code><a href="https://rdrr.io/pkg/ggtree/man/label_pad.html">label_pad()</a></code> function adds padding characters (default is <code>·</code>) to taxa labels.</p>
<div class="sourceCode" id="cb253"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/Random.html">set.seed</a></span><span class="op">(</span><span class="fl">2015</span><span class="op">-</span><span class="fl">12</span><span class="op">-</span><span class="fl">21</span><span class="op">)</span></span>
<span><span class="va">tree</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/ape/man/rtree.html">rtree</a></span><span class="op">(</span><span class="fl">5</span><span class="op">)</span></span>
<span><span class="va">tree</span><span class="op">$</span><span class="va">tip.label</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="st">"long string for test"</span></span>
<span></span>
<span><span class="va">d</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span>label <span class="op">=</span> <span class="va">tree</span><span class="op">$</span><span class="va">tip.label</span>, </span>
<span>                newlabel <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/ggtree/man/label_pad.html">label_pad</a></span><span class="op">(</span><span class="va">tree</span><span class="op">$</span><span class="va">tip.label</span><span class="op">)</span>,</span>
<span>                newlabel2 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/ggtree/man/label_pad.html">label_pad</a></span><span class="op">(</span><span class="va">tree</span><span class="op">$</span><span class="va">tip.label</span>, pad <span class="op">=</span> <span class="st">" "</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/phylobase/man/print-methods.html">print</a></span><span class="op">(</span><span class="va">d</span><span class="op">)</span></span></code></pre></div>
<pre><code>##                  label             newlabel
## 1                   t1 ··················t1
## 2 long string for test long string for test
## 3                   t2 ··················t2
## 4                   t4 ··················t4
## 5                   t3 ··················t3
##              newlabel2
## 1                   t1
## 2 long string for test
## 3                   t2
## 4                   t4
## 5                   t3</code></pre>
<p>This feature is useful if we want to align tip labels to the end as demonstrated in Figure <a href="chapter12.html#fig:labelpad">12.10</a>. Note that in this case, monospace font should be used to ensure the lengths of the labels displayed in the plot are the same.</p>


<div class="sourceCode" id="cb255"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">p</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/ggtree/man/ggtree.html">ggtree</a></span><span class="op">(</span><span class="va">tree</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/pkg/ggtree/man/attacher.html">%&lt;+%</a></span> <span class="va">d</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/lims.html">xlim</a></span><span class="op">(</span><span class="cn">NA</span>, <span class="fl">5</span><span class="op">)</span></span>
<span><span class="va">p1</span> <span class="op">&lt;-</span> <span class="va">p</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/pkg/ggtree/man/geom_tiplab.html">geom_tiplab</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>label<span class="op">=</span><span class="va">newlabel</span><span class="op">)</span>, </span>
<span>                    align<span class="op">=</span><span class="cn">TRUE</span>, family<span class="op">=</span><span class="st">'mono'</span>,</span>
<span>                    linetype <span class="op">=</span> <span class="st">"dotted"</span>, linesize <span class="op">=</span> <span class="fl">.7</span><span class="op">)</span> </span>
<span><span class="va">p2</span> <span class="op">&lt;-</span> <span class="va">p</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/pkg/ggtree/man/geom_tiplab.html">geom_tiplab</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>label<span class="op">=</span><span class="va">newlabel2</span><span class="op">)</span>, </span>
<span>                    align<span class="op">=</span><span class="cn">TRUE</span>, family<span class="op">=</span><span class="st">'mono'</span>,</span>
<span>                    linetype <span class="op">=</span> <span class="cn">NULL</span>, offset<span class="op">=</span><span class="op">-</span><span class="fl">.5</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/lims.html">xlim</a></span><span class="op">(</span><span class="cn">NA</span>, <span class="fl">5</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/aplot/man/plot_list.html">plot_list</a></span><span class="op">(</span><span class="va">p1</span>, <span class="va">p2</span>, ncol<span class="op">=</span><span class="fl">2</span>, tag_levels <span class="op">=</span> <span class="st">"A"</span><span class="op">)</span>                            </span></code></pre></div>
<div class="figure">
<span style="display:block;" id="fig:labelpad"></span>
<img src="treedata_files/figure-html/labelpad-1.svg" alt="Align tip label to the end. With a dotted line (A) and without a dotted line (B)." width="100%"><p class="caption">
FIGURE 12.10: <strong>Align tip label to the end.</strong> With a dotted line (A) and without a dotted line (B).
</p>
</div>
</div>
</div>
<div id="identify" class="section level2" number="12.7">
<h2>
<span class="header-section-number">12.7</span> Interactive ggtree Annotation<a class="anchor" aria-label="anchor" href="#identify"><i class="fas fa-link"></i></a>
</h2>
<p>The <a href="http://bioconductor.org/packages/ggtree"><strong>ggtree</strong></a> package supports interactive tree annotation or manipulation by implementing an <code><a href="https://rdrr.io/r/graphics/identify.html">identify()</a></code> method. Users can click on a node to highlight a clade, to label or rotate it, <em>etc</em>. Users can also use the <a href="https://CRAN.R-project.org/package=plotly"><strong>plotly</strong></a> package to convert a <code>ggtree</code> object to a <code>plotly</code> object to quickly create
an <a href="related-tools.html#plotly">interactive phylogenetic tree</a>.</p>


<div class="figure">
<span style="display:block;" id="fig:ggtreeidentify"></span>
<img src="img/ggtree-identify.gif" alt="Interactive phylogenetic tree using identify() method. Highlighting, labelling and rotating clades are all supported." width="100%"><p class="caption">
FIGURE 12.11: <strong>Interactive phylogenetic tree using identify() method.</strong> Highlighting, labelling and rotating clades are all supported.
</p>
</div>
<p>Video of using <code><a href="https://rdrr.io/r/graphics/identify.html">identify()</a></code> to interactively manipulate a phylogenetic tree can be found on Youtube <svg viewbox="0 0 576 512" style="height:1em;position:relative;display:inline-block;top:.1em;fill:red;" xmlns="http://www.w3.org/2000/svg"><path d="M549.655 124.083c-6.281-23.65-24.787-42.276-48.284-48.597C458.781 64 288 64 288 64S117.22 64 74.629 75.486c-23.497 6.322-42.003 24.947-48.284 48.597-11.412 42.867-11.412 132.305-11.412 132.305s0 89.438 11.412 132.305c6.281 23.65 24.787 41.5 48.284 47.821C117.22 448 288 448 288 448s170.78 0 213.371-11.486c23.497-6.321 42.003-24.171 48.284-47.821 11.412-42.867 11.412-132.305 11.412-132.305s0-89.438-11.412-132.305zm-317.51 213.508V175.185l142.739 81.205-142.739 81.201z"></path></svg> and Youku:</p>
<ul>
<li>Highlighting clades: <a href="https://youtu.be/KcF8Ec38mzI">Youtube <svg viewbox="0 0 576 512" style="height:1em;position:relative;display:inline-block;top:.1em;fill:red;" xmlns="http://www.w3.org/2000/svg"><path d="M549.655 124.083c-6.281-23.65-24.787-42.276-48.284-48.597C458.781 64 288 64 288 64S117.22 64 74.629 75.486c-23.497 6.322-42.003 24.947-48.284 48.597-11.412 42.867-11.412 132.305-11.412 132.305s0 89.438 11.412 132.305c6.281 23.65 24.787 41.5 48.284 47.821C117.22 448 288 448 288 448s170.78 0 213.371-11.486c23.497-6.321 42.003-24.171 48.284-47.821 11.412-42.867 11.412-132.305 11.412-132.305s0-89.438-11.412-132.305zm-317.51 213.508V175.185l142.739 81.205-142.739 81.201z"></path></svg></a> and <a href="http://v.youku.com/v_show/id_XMTYyMzgyODYyOA">Youku</a>.</li>
<li>Labelling clades: <a href="https://youtu.be/SmcceRD_jxg">Youtube <svg viewbox="0 0 576 512" style="height:1em;position:relative;display:inline-block;top:.1em;fill:red;" xmlns="http://www.w3.org/2000/svg"><path d="M549.655 124.083c-6.281-23.65-24.787-42.276-48.284-48.597C458.781 64 288 64 288 64S117.22 64 74.629 75.486c-23.497 6.322-42.003 24.947-48.284 48.597-11.412 42.867-11.412 132.305-11.412 132.305s0 89.438 11.412 132.305c6.281 23.65 24.787 41.5 48.284 47.821C117.22 448 288 448 288 448s170.78 0 213.371-11.486c23.497-6.321 42.003-24.171 48.284-47.821 11.412-42.867 11.412-132.305 11.412-132.305s0-89.438-11.412-132.305zm-317.51 213.508V175.185l142.739 81.205-142.739 81.201z"></path></svg></a> and <a href="http://v.youku.com/v_show/id_XMTYyNDIzODA0NA">Youku</a>.</li>
<li>Rotating clades: <a href="https://youtu.be/lKNn4QlPO0E">Youtube <svg viewbox="0 0 576 512" style="height:1em;position:relative;display:inline-block;top:.1em;fill:red;" xmlns="http://www.w3.org/2000/svg"><path d="M549.655 124.083c-6.281-23.65-24.787-42.276-48.284-48.597C458.781 64 288 64 288 64S117.22 64 74.629 75.486c-23.497 6.322-42.003 24.947-48.284 48.597-11.412 42.867-11.412 132.305-11.412 132.305s0 89.438 11.412 132.305c6.281 23.65 24.787 41.5 48.284 47.821C117.22 448 288 448 288 448s170.78 0 213.371-11.486c23.497-6.321 42.003-24.171 48.284-47.821 11.412-42.867 11.412-132.305 11.412-132.305s0-89.438-11.412-132.305zm-317.51 213.508V175.185l142.739 81.205-142.739 81.201z"></path></svg></a> and <a href="http://v.youku.com/v_show/id_XMTYyMzgyODg2OA">Youku</a>.</li>
</ul>
<div style="page-break-after: always;"></div>
</div>
</div>
  <div class="chapter-nav">
<div class="prev"><a href="chapter11.html"><span class="header-section-number">11</span> Other ggtree Extensions</a></div>
<div class="next"><a href="chapter13.html"><span class="header-section-number">13</span> Gallery of Reproducible Examples</a></div>
</div></main><div class="col-md-3 col-lg-2 d-none d-md-block sidebar sidebar-chapter">
    <nav id="toc" data-toggle="toc" aria-label="On this page"><h2>On this page</h2>
      <ul class="nav navbar-nav">
<li><a class="nav-link" href="#chapter12"><span class="header-section-number">12</span> ggtree Utilities</a></li>
<li>
<a class="nav-link" href="#facet-utils"><span class="header-section-number">12.1</span> Facet Utilities</a><ul class="nav navbar-nav">
<li><a class="nav-link" href="#facet_widths"><span class="header-section-number">12.1.1</span> facet_widths</a></li>
<li><a class="nav-link" href="#facet_labeller"><span class="header-section-number">12.1.2</span> facet_labeller</a></li>
</ul>
</li>
<li><a class="nav-link" href="#geom2"><span class="header-section-number">12.2</span> Geometric Layers</a></li>
<li><a class="nav-link" href="#layout-utilities"><span class="header-section-number">12.3</span> Layout Utilities</a></li>
<li>
<a class="nav-link" href="#scale-utilities"><span class="header-section-number">12.4</span> Scale Utilities</a><ul class="nav navbar-nav">
<li><a class="nav-link" href="#xlim_expand"><span class="header-section-number">12.4.1</span> Expand x limit for a specific facet panel</a></li>
<li><a class="nav-link" href="#ggexpand"><span class="header-section-number">12.4.2</span> Expand plot limit by the ratio of plot range</a></li>
</ul>
</li>
<li>
<a class="nav-link" href="#tree-data-utilities"><span class="header-section-number">12.5</span> Tree data utilities</a><ul class="nav navbar-nav">
<li><a class="nav-link" href="#td_filter"><span class="header-section-number">12.5.1</span> Filter tree data</a></li>
<li><a class="nav-link" href="#td_unnest"><span class="header-section-number">12.5.2</span> Flatten list-column tree data</a></li>
</ul>
</li>
<li>
<a class="nav-link" href="#tree-utilities"><span class="header-section-number">12.6</span> Tree Utilities</a><ul class="nav navbar-nav">
<li><a class="nav-link" href="#tiporder"><span class="header-section-number">12.6.1</span> Extract tip order</a></li>
<li><a class="nav-link" href="#padding-taxa-labels"><span class="header-section-number">12.6.2</span> Padding taxa labels</a></li>
</ul>
</li>
<li><a class="nav-link" href="#identify"><span class="header-section-number">12.7</span> Interactive ggtree Annotation</a></li>
</ul>

      <div class="book-extra">
        <ul class="list-unstyled">
          
        </ul>
</div>
    </nav>
</div>

</div>
</div> <!-- .container -->

<footer class="bg-primary text-light mt-5"><div class="container"><div class="row">

  <div class="col-12 col-md-6 mt-3">
    <p>"<strong>Data Integration, Manipulation and Visualization of Phylogenetic Trees</strong>" was written by Guangchuang Yu. It was last built on 2022-07-13.</p>
  </div>

  <div class="col-12 col-md-6 mt-3">
    <p>This book was built by the <a class="text-light" href="https://bookdown.org">bookdown</a> R package.</p>
  </div>

</div></div>
</footer><!-- dynamically load mathjax for compatibility with self-contained --><script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script><script type="text/x-mathjax-config">const popovers = document.querySelectorAll('a.footnote-ref[data-toggle="popover"]');
for (let popover of popovers) {
  const div = document.createElement('div');
  div.setAttribute('style', 'position: absolute; top: 0, left:0; width:0, height:0, overflow: hidden; visibility: hidden;');
  div.innerHTML = popover.getAttribute('data-content');

  var has_math = div.querySelector("span.math");
  if (has_math) {
    document.body.appendChild(div);
    MathJax.Hub.Queue(["Typeset", MathJax.Hub, div]);
    MathJax.Hub.Queue(function() {
      popover.setAttribute('data-content', div.innerHTML);
      document.body.removeChild(div);
    })
  }
}
</script>
</body>
</html>
