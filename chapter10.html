<!DOCTYPE html>
<html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Chapter 10 ggtreeExtra for Presenting Data on a Circular Layout | Data Integration, Manipulation and Visualization of Phylogenetic Trees</title>
<meta name="author" content="Guangchuang Yu">
<meta name="description" content="10.1 Introduction The ggtree package (Yu et al., 2017) provides programmable visualization and annotation of phylogenetic trees and other tree-like structures. It supports visualizing tree data in...">
<meta name="generator" content="bookdown 0.26 with bs4_book()">
<meta property="og:title" content="Chapter 10 ggtreeExtra for Presenting Data on a Circular Layout | Data Integration, Manipulation and Visualization of Phylogenetic Trees">
<meta property="og:type" content="book">
<meta property="og:image" content="/book-cover.png">
<meta property="og:description" content="10.1 Introduction The ggtree package (Yu et al., 2017) provides programmable visualization and annotation of phylogenetic trees and other tree-like structures. It supports visualizing tree data in...">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Chapter 10 ggtreeExtra for Presenting Data on a Circular Layout | Data Integration, Manipulation and Visualization of Phylogenetic Trees">
<meta name="twitter:description" content="10.1 Introduction The ggtree package (Yu et al., 2017) provides programmable visualization and annotation of phylogenetic trees and other tree-like structures. It supports visualizing tree data in...">
<meta name="twitter:image" content="/book-cover.png">
<!-- JS --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://kit.fontawesome.com/6ecbd6c532.js" crossorigin="anonymous"></script><script src="libs/jquery/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="libs/bootstrap/bootstrap.min.css" rel="stylesheet">
<script src="libs/bootstrap/bootstrap.bundle.min.js"></script><script src="libs/bs3compat/transition.js"></script><script src="libs/bs3compat/tabs.js"></script><script src="libs/bs3compat/bs3compat.js"></script><link href="libs/bs4_book/bs4_book.css" rel="stylesheet">
<script src="libs/bs4_book/bs4_book.js"></script><script src="libs/kePrint/kePrint.js"></script><link href="libs/lightable/lightable.css" rel="stylesheet">
<script src="libs/htmlwidgets/htmlwidgets.js"></script><script src="libs/pathseg/pathseg.js"></script><script src="libs/comic/comic.min.js"></script><script src="libs/comicR-binding/comicR.js"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- CSS --><style type="text/css">
    
    div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
  </style>
<style type="text/css">
    /* Used with Pandoc 2.11+ new --citeproc when CSL is used */
    div.csl-bib-body { }
    div.csl-entry {
      clear: both;
        }
    .hanging div.csl-entry {
      margin-left:2em;
      text-indent:-2em;
    }
    div.csl-left-margin {
      min-width:2em;
      float:left;
    }
    div.csl-right-inline {
      margin-left:2em;
      padding-left:1em;
    }
    div.csl-indent {
      margin-left: 2em;
    }
  </style>
</head>
<body data-spy="scroll" data-target="#toc">

<div class="container-fluid">
<div class="row">
  <header class="col-sm-12 col-lg-3 sidebar sidebar-book"><a class="sr-only sr-only-focusable" href="#content">Skip to main content</a>

    <div class="d-flex align-items-start justify-content-between">
      <h1>
        <a href="index.html" title="">Data Integration, Manipulation and Visualization of Phylogenetic Trees</a>
      </h1>
      <button class="btn btn-outline-primary d-lg-none ml-2 mt-1" type="button" data-toggle="collapse" data-target="#main-nav" aria-expanded="true" aria-controls="main-nav"><i class="fas fa-bars"></i><span class="sr-only">Show table of contents</span></button>
    </div>

    <div id="main-nav" class="collapse-lg">
      <form role="search">
        <input id="search" class="form-control" type="search" placeholder="Search" aria-label="Search">
</form>

      <nav aria-label="Table of contents"><h2>Table of contents</h2>
        <ul class="book-toc list-unstyled">
<li><a class="" href="index.html">Preface</a></li>
<li><a class="" href="author.html">About the Author</a></li>
<li class="book-part">Part I: Tree data input, output, and manipulation</li>
<li><a class="" href="chapter1.html"><span class="header-section-number">1</span> Importing Tree with Data</a></li>
<li><a class="" href="chapter2.html"><span class="header-section-number">2</span> Manipulating Tree with Data</a></li>
<li><a class="" href="chapter3.html"><span class="header-section-number">3</span> Exporting tree with data</a></li>
<li class="book-part">Part II: Tree data visualization and annotation</li>
<li><a class="" href="chapter4.html"><span class="header-section-number">4</span> Phylogenetic Tree Visualization</a></li>
<li><a class="" href="chapter5.html"><span class="header-section-number">5</span> Phylogenetic Tree Annotation</a></li>
<li><a class="" href="chapter6.html"><span class="header-section-number">6</span> Visual Exploration of Phylogenetic Trees</a></li>
<li><a class="" href="chapter7.html"><span class="header-section-number">7</span> Plotting tree with data</a></li>
<li><a class="" href="chapter8.html"><span class="header-section-number">8</span> Annotating Tree with Silhouette Images and Sub-plots</a></li>
<li><a class="" href="chapter9.html"><span class="header-section-number">9</span> ggtree for Other Tree-like Objects</a></li>
<li class="book-part">Part III: ggtree extensions</li>
<li><a class="active" href="chapter10.html"><span class="header-section-number">10</span> ggtreeExtra for Presenting Data on a Circular Layout</a></li>
<li><a class="" href="chapter11.html"><span class="header-section-number">11</span> Other ggtree Extensions</a></li>
<li class="book-part">Part IV: Miscellaneous topics</li>
<li><a class="" href="chapter12.html"><span class="header-section-number">12</span> ggtree Utilities</a></li>
<li><a class="" href="chapter13.html"><span class="header-section-number">13</span> Gallery of Reproducible Examples</a></li>
<li class="book-part">Appendix</li>
<li><a class="" href="faq.html"><span class="header-section-number">A</span> Frequently Asked Questions</a></li>
<li><a class="" href="related-tools.html"><span class="header-section-number">B</span> Related Tools</a></li>
<li><a class="" href="figures-and-tables.html"><span class="header-section-number">C</span> Figures and Tables</a></li>
<li><a class="" href="publications-of-the-ggtree-package-suite.html"><span class="header-section-number">D</span> Publications of the ggtree Package Suite</a></li>
<li><a class="" href="references.html">References</a></li>
</ul>

        <div class="book-extra">
          
        </div>
      </nav>
</div>
  </header><main class="col-sm-12 col-md-9 col-lg-7" id="content"><div id="chapter10" class="section level1" number="10">
<h1>
<span class="header-section-number">10</span> ggtreeExtra for Presenting Data on a Circular Layout<a class="anchor" aria-label="anchor" href="#chapter10"><i class="fas fa-link"></i></a>
</h1>
<div id="introduction-2" class="section level2" number="10.1">
<h2>
<span class="header-section-number">10.1</span> Introduction<a class="anchor" aria-label="anchor" href="#introduction-2"><i class="fas fa-link"></i></a>
</h2>
<p>The <a href="http://bioconductor.org/packages/ggtree"><strong>ggtree</strong></a> package <span class="citation">(<a href="references.html#ref-yu_ggtree:_2017" role="doc-biblioref">Yu et al., 2017</a>)</span> provides programmable visualization and annotation of <a href="chapter5.html#chapter5">phylogenetic trees</a> and <a href="chapter9.html#chapter9">other tree-like structures</a>. It supports visualizing tree data in multiple layers or with the tree side-by-side (see also <a href="chapter7.html#chapter7">Chapter 7</a> and <span class="citation">(<a href="references.html#ref-yu_two_2018" role="doc-biblioref">Yu et al., 2018</a>)</span>). Although <a href="http://bioconductor.org/packages/ggtree"><strong>ggtree</strong></a> supports <a href="chapter4.html#tree-layouts">many layouts</a>, the <code><a href="https://rdrr.io/pkg/ggtree/man/facet-plot.html">geom_facet()</a></code> layer only works with <code>rectangular</code>, <code>roundrect</code>, <code>ellipse</code>, and <code>slanted</code> layouts to present tree data on different panels. There is no direct support in <a href="http://bioconductor.org/packages/ggtree"><strong>ggtree</strong></a> to present data on the outer rings of a tree in <code>circular</code>, <code>fan</code>, and <code>radial</code> layouts. To solve this issue, we developed the <a href="http://bioconductor.org/packages/ggtreeExtra"><strong>ggtreeExtra</strong></a> package, which allows users to align associated graph layers in outer rings of circular layout tree. In addition, it also works with a <code>rectangular</code> tree layout (Figure <a href="chapter10.html#fig:HMPplot2">10.3</a>).</p>
</div>
<div id="geom-fruit1" class="section level2" number="10.2">
<h2>
<span class="header-section-number">10.2</span> Aligning Graphs to the Tree Based on a Tree Structure<a class="anchor" aria-label="anchor" href="#geom-fruit1"><i class="fas fa-link"></i></a>
</h2>
<p>The <a href="http://bioconductor.org/packages/ggtreeExtra"><strong>ggtreeExtra</strong></a> package provides a layer function, <code><a href="https://rdrr.io/pkg/ggtreeExtra/man/geom_fruit.html">geom_fruit()</a></code>, to align graphs with the tree side-by-side. Similar to the <code><a href="https://rdrr.io/pkg/ggtree/man/facet-plot.html">geom_facet()</a></code> layout described in <a href="chapter7.html#chapter7">Chapter 7</a>, <code><a href="https://rdrr.io/pkg/ggtreeExtra/man/geom_fruit.html">geom_fruit()</a></code> internally re-orders the input data based on the tree structure and visualizes the data using a specified geometric layer function with user-provided aesthetic mapping and non-variable setting. The graph will be displayed on the outer ring of the tree.</p>
<p>The <code><a href="https://rdrr.io/pkg/ggtreeExtra/man/geom_fruit.html">geom_fruit()</a></code> is designed to work with most <code>geom</code> layers defined in <a href="https://CRAN.R-project.org/package=ggplot2"><strong>ggplot2</strong></a> and its extensions. The position of the graph (<em>i.e.</em>, on the outer ring) is controlled by the <code>position</code> parameter, which accepts a <code>Position</code> object. The default value of the <code>position</code> parameter is ‘auto’ and the <code><a href="https://rdrr.io/pkg/ggtreeExtra/man/geom_fruit.html">geom_fruit()</a></code> layer will guess and determine (hopefully) a suitable position for the specified geometric layer. That means using <code><a href="https://rdrr.io/pkg/ggtreeExtra/man/position_stackx.html">position_stackx()</a></code> for <code><a href="https://ggplot2.tidyverse.org/reference/geom_bar.html">geom_bar()</a></code>, <code><a href="https://rdrr.io/pkg/ggtreeExtra/man/position_dodgex.html">position_dodgex()</a></code> for <code><a href="https://ggplot2.tidyverse.org/reference/geom_violin.html">geom_violin()</a></code> and <code><a href="https://ggplot2.tidyverse.org/reference/geom_boxplot.html">geom_boxplot()</a></code>, and <code><a href="https://rdrr.io/pkg/ggtreeExtra/man/position_identityx.html">position_identityx()</a></code> for others (<em>e.g.</em>, <code><a href="https://ggplot2.tidyverse.org/reference/geom_point.html">geom_point()</a></code>, <code><a href="https://ggplot2.tidyverse.org/reference/geom_tile.html">geom_tile()</a></code>, <em>etc.</em>). A geometric layer that has a <code>position</code> parameter should be compatible with <code><a href="https://rdrr.io/pkg/ggtreeExtra/man/geom_fruit.html">geom_fruit()</a></code>, as it allows using position functions defined in the <a href="http://bioconductor.org/packages/ggtreeExtra"><strong>ggtreeExtra</strong></a> package to adjust output layer positions. Besides, the <code><a href="https://rdrr.io/pkg/ggtreeExtra/man/geom_fruit.html">geom_fruit()</a></code> layer allows setting <code>axis</code> and background grid lines for the current layer using the <code>axis.params</code> and <code>grid.params</code> parameters, respectively.</p>
<p>The following example uses microbiome data provided in the <a href="http://bioconductor.org/packages/phyloseq"><strong>phyloseq</strong></a> package and a boxplot is employed to visualize species abundance data. The <code><a href="https://rdrr.io/pkg/ggtreeExtra/man/geom_fruit.html">geom_fruit()</a></code> layer automatically rearranges the abundance data according to the circular tree structure and visualizes the data using the specific <code>geom</code> function (<em>i.e.</em>, <code><a href="https://ggplot2.tidyverse.org/reference/geom_boxplot.html">geom_boxplot()</a></code>). Visualizing this dataset using <code><a href="https://wilkelab.org/ggridges/reference/geom_density_ridges.html">geom_density_ridges()</a></code> with <code><a href="https://rdrr.io/pkg/ggtree/man/facet-plot.html">geom_facet()</a></code> can be found in figure 1 of <span class="citation">(<a href="references.html#ref-yu_two_2018" role="doc-biblioref">Yu et al., 2018</a>)</span>.</p>


<div class="sourceCode" id="cb225"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/YuLab-SMU/ggtreeExtra/">ggtreeExtra</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://yulab-smu.top/treedata-book/">ggtree</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="http://dx.plos.org/10.1371/journal.pone.0061217">phyloseq</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://dplyr.tidyverse.org">dplyr</a></span><span class="op">)</span>

<span class="fu"><a href="https://rdrr.io/r/utils/data.html">data</a></span><span class="op">(</span><span class="st">"GlobalPatterns"</span><span class="op">)</span>
<span class="va">GP</span> <span class="op">&lt;-</span> <span class="va">GlobalPatterns</span>
<span class="va">GP</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/phyloseq/man/prune_taxa-methods.html">prune_taxa</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/phyloseq/man/taxa_sums.html">taxa_sums</a></span><span class="op">(</span><span class="va">GP</span><span class="op">)</span> <span class="op">&gt;</span> <span class="fl">600</span>, <span class="va">GP</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/pkg/phyloseq/man/sample_data-methods.html">sample_data</a></span><span class="op">(</span><span class="va">GP</span><span class="op">)</span><span class="op">$</span><span class="va">human</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/phyloseq/man/get_variable.html">get_variable</a></span><span class="op">(</span><span class="va">GP</span>, <span class="st">"SampleType"</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/r/base/match.html">%in%</a></span>
                              <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"Feces"</span>, <span class="st">"Skin"</span><span class="op">)</span>
<span class="va">mergedGP</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/phyloseq/man/merge_samples-methods.html">merge_samples</a></span><span class="op">(</span><span class="va">GP</span>, <span class="st">"SampleType"</span><span class="op">)</span>
<span class="va">mergedGP</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/phyloseq/man/rarefy_even_depth.html">rarefy_even_depth</a></span><span class="op">(</span><span class="va">mergedGP</span>,rngseed<span class="op">=</span><span class="fl">394582</span><span class="op">)</span>
<span class="va">mergedGP</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/phyloseq/man/tax_glom.html">tax_glom</a></span><span class="op">(</span><span class="va">mergedGP</span>,<span class="st">"Order"</span><span class="op">)</span>

<span class="va">melt_simple</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/phyloseq/man/psmelt.html">psmelt</a></span><span class="op">(</span><span class="va">mergedGP</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span>
               <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="va">Abundance</span> <span class="op">&lt;</span> <span class="fl">120</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span>
               <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="va">OTU</span>, val<span class="op">=</span><span class="va">Abundance</span><span class="op">)</span>

<span class="va">p</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/ggtree/man/ggtree.html">ggtree</a></span><span class="op">(</span><span class="va">mergedGP</span>, layout<span class="op">=</span><span class="st">"fan"</span>, open.angle<span class="op">=</span><span class="fl">10</span><span class="op">)</span> <span class="op">+</span> 
     <span class="fu"><a href="https://rdrr.io/pkg/ggtree/man/geom_tippoint.html">geom_tippoint</a></span><span class="op">(</span>mapping<span class="op">=</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>color<span class="op">=</span><span class="va">Phylum</span><span class="op">)</span>, 
                   size<span class="op">=</span><span class="fl">1.5</span>,
                   show.legend<span class="op">=</span><span class="cn">FALSE</span><span class="op">)</span>
<span class="va">p</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/ggtree/man/rotate_tree.html">rotate_tree</a></span><span class="op">(</span><span class="va">p</span>, <span class="op">-</span><span class="fl">90</span><span class="op">)</span>

<span class="va">p</span> <span class="op">&lt;-</span> <span class="va">p</span> <span class="op">+</span>
     <span class="fu"><a href="https://rdrr.io/pkg/ggtreeExtra/man/geom_fruit.html">geom_fruit</a></span><span class="op">(</span>
         data<span class="op">=</span><span class="va">melt_simple</span>,
         geom<span class="op">=</span><span class="va">geom_boxplot</span>,
         mapping <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>
                     y<span class="op">=</span><span class="va">OTU</span>,
                     x<span class="op">=</span><span class="va">val</span>,
                     group<span class="op">=</span><span class="va">label</span>,
                     fill<span class="op">=</span><span class="va">Phylum</span>,
                   <span class="op">)</span>,
         size<span class="op">=</span><span class="fl">.2</span>,
         outlier.size<span class="op">=</span><span class="fl">0.5</span>,
         outlier.stroke<span class="op">=</span><span class="fl">0.08</span>,
         outlier.shape<span class="op">=</span><span class="fl">21</span>,
         axis.params<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>
                         axis       <span class="op">=</span> <span class="st">"x"</span>,
                         text.size  <span class="op">=</span> <span class="fl">1.8</span>,
                         hjust      <span class="op">=</span> <span class="fl">1</span>,
                         vjust      <span class="op">=</span> <span class="fl">0.5</span>,
                         nbreak     <span class="op">=</span> <span class="fl">3</span>,
                     <span class="op">)</span>,
         grid.params<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span><span class="op">)</span>
     <span class="op">)</span> 
     
<span class="va">p</span> <span class="op">&lt;-</span> <span class="va">p</span> <span class="op">+</span>
     <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_colour_discrete.html">scale_fill_discrete</a></span><span class="op">(</span>
         name<span class="op">=</span><span class="st">"Phyla"</span>,
         guide<span class="op">=</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/guide_legend.html">guide_legend</a></span><span class="op">(</span>keywidth<span class="op">=</span><span class="fl">0.8</span>, keyheight<span class="op">=</span><span class="fl">0.8</span>, ncol<span class="op">=</span><span class="fl">1</span><span class="op">)</span>
     <span class="op">)</span> <span class="op">+</span>
     <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html">theme</a></span><span class="op">(</span>
         legend.title<span class="op">=</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_text</a></span><span class="op">(</span>size<span class="op">=</span><span class="fl">9</span><span class="op">)</span>, 
         legend.text<span class="op">=</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_text</a></span><span class="op">(</span>size<span class="op">=</span><span class="fl">7</span><span class="op">)</span> 
     <span class="op">)</span>
<span class="va">p</span></code></pre></div>
<div class="figure">
<span style="display:block;" id="fig:psbox"></span>
<img src="treedata_files/figure-html/psbox-1.png" alt="Phylogenetic tree with OTU abundance distribution. Species abundance distribution was aligned to the tree and visualized as boxplots. The Phylum information was used to color symbolic points on the tree and also species abundance distributions." width="100%"><p class="caption">
FIGURE 10.1: <strong>Phylogenetic tree with OTU abundance distribution</strong>. Species abundance distribution was aligned to the tree and visualized as boxplots. The Phylum information was used to color symbolic points on the tree and also species abundance distributions.
</p>
</div>
</div>
<div id="geom-fruit2" class="section level2" number="10.3">
<h2>
<span class="header-section-number">10.3</span> Aligning Multiple Graphs to the Tree for Multi-dimensional Data<a class="anchor" aria-label="anchor" href="#geom-fruit2"><i class="fas fa-link"></i></a>
</h2>
<p>We are able to add multiple <code><a href="https://rdrr.io/pkg/ggtreeExtra/man/geom_fruit.html">geom_fruit()</a></code> layers to a tree and the circular layout is indeed more compact and efficient for multi-dimensional data. This example reproduces figure 2 of <span class="citation">(<a href="references.html#ref-morgan2013HMP" role="doc-biblioref">Morgan et al., 2013</a>)</span>. The data is provided by GraPhlAn <span class="citation">(<a href="references.html#ref-GraPhlAn" role="doc-biblioref">Asnicar et al., 2015</a>)</span>, which contained the relative abundance of the microbiome at different body sites. This example demonstrates the ability to add multiple layers (heat map and bar plot) to present different types of data (Figure <a href="chapter10.html#fig:HMPplot">10.2</a>).</p>


<div class="sourceCode" id="cb226"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/YuLab-SMU/ggtreeExtra/">ggtreeExtra</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://yulab-smu.top/treedata-book/">ggtree</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/YuLab-SMU/treeio">treeio</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://yulab-smu.top/treedata-book/">tidytree</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/xiangpin/ggstar/">ggstar</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://ggplot2.tidyverse.org">ggplot2</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va">ggnewscale</span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/YuLab-SMU/TDBook">TDbook</a></span><span class="op">)</span>

<span class="co"># load data from TDbook, including tree_hmptree, </span>
<span class="co"># df_tippoint (the abundance and types of microbes),</span>
<span class="co"># df_ring_heatmap (the abundance of microbes at different body sites),</span>
<span class="co"># and df_barplot_attr (the abundance of microbes of greatest prevalence)</span>
<span class="va">tree</span> <span class="op">&lt;-</span> <span class="va">tree_hmptree</span>
<span class="va">dat1</span> <span class="op">&lt;-</span> <span class="va">df_tippoint</span>
<span class="va">dat2</span> <span class="op">&lt;-</span> <span class="va">df_ring_heatmap</span>
<span class="va">dat3</span> <span class="op">&lt;-</span> <span class="va">df_barplot_attr</span>

<span class="co"># adjust the order</span>
<span class="va">dat2</span><span class="op">$</span><span class="va">Sites</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html">factor</a></span><span class="op">(</span><span class="va">dat2</span><span class="op">$</span><span class="va">Sites</span>, 
                    levels<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"Stool (prevalence)"</span>, <span class="st">"Cheek (prevalence)"</span>,
                             <span class="st">"Plaque (prevalence)"</span>,<span class="st">"Tongue (prevalence)"</span>,
                             <span class="st">"Nose (prevalence)"</span>, <span class="st">"Vagina (prevalence)"</span>,
                             <span class="st">"Skin (prevalence)"</span><span class="op">)</span><span class="op">)</span>
<span class="va">dat3</span><span class="op">$</span><span class="va">Sites</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html">factor</a></span><span class="op">(</span><span class="va">dat3</span><span class="op">$</span><span class="va">Sites</span>, 
                    levels<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"Stool (prevalence)"</span>, <span class="st">"Cheek (prevalence)"</span>,
                             <span class="st">"Plaque (prevalence)"</span>, <span class="st">"Tongue (prevalence)"</span>,
                             <span class="st">"Nose (prevalence)"</span>, <span class="st">"Vagina (prevalence)"</span>,
                             <span class="st">"Skin (prevalence)"</span><span class="op">)</span><span class="op">)</span>
<span class="co"># extract the clade label information. Because some nodes of tree are</span>
<span class="co"># annotated to genera, which can be displayed with high light using ggtree.</span>
<span class="va">nodeids</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/tidytree/man/nodeid.html">nodeid</a></span><span class="op">(</span><span class="va">tree</span>, <span class="va">tree</span><span class="op">$</span><span class="va">node.label</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/nchar.html">nchar</a></span><span class="op">(</span><span class="va">tree</span><span class="op">$</span><span class="va">node.label</span><span class="op">)</span><span class="op">&gt;</span><span class="fl">4</span><span class="op">]</span><span class="op">)</span>
<span class="va">nodedf</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span>node<span class="op">=</span><span class="va">nodeids</span><span class="op">)</span>
<span class="va">nodelab</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/grep.html">gsub</a></span><span class="op">(</span><span class="st">"[\\.0-9]"</span>, <span class="st">""</span>, <span class="va">tree</span><span class="op">$</span><span class="va">node.label</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/nchar.html">nchar</a></span><span class="op">(</span><span class="va">tree</span><span class="op">$</span><span class="va">node.label</span><span class="op">)</span><span class="op">&gt;</span><span class="fl">4</span><span class="op">]</span><span class="op">)</span>
<span class="co"># The layers of clade and hightlight</span>
<span class="va">poslist</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1.6</span>, <span class="fl">1.4</span>, <span class="fl">1.6</span>, <span class="fl">0.8</span>, <span class="fl">0.1</span>, <span class="fl">0.25</span>, <span class="fl">1.6</span>, <span class="fl">1.6</span>, <span class="fl">1.2</span>, <span class="fl">0.4</span>,
             <span class="fl">1.2</span>, <span class="fl">1.8</span>, <span class="fl">0.3</span>, <span class="fl">0.8</span>, <span class="fl">0.4</span>, <span class="fl">0.3</span>, <span class="fl">0.4</span>, <span class="fl">0.4</span>, <span class="fl">0.4</span>, <span class="fl">0.6</span>,
             <span class="fl">0.3</span>, <span class="fl">0.4</span>, <span class="fl">0.3</span><span class="op">)</span>
<span class="va">labdf</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span>node<span class="op">=</span><span class="va">nodeids</span>, label<span class="op">=</span><span class="va">nodelab</span>, pos<span class="op">=</span><span class="va">poslist</span><span class="op">)</span>

<span class="co"># The circular layout tree.</span>
<span class="va">p</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/ggtree/man/ggtree.html">ggtree</a></span><span class="op">(</span><span class="va">tree</span>, layout<span class="op">=</span><span class="st">"fan"</span>, size<span class="op">=</span><span class="fl">0.15</span>, open.angle<span class="op">=</span><span class="fl">5</span><span class="op">)</span> <span class="op">+</span>
     <span class="fu"><a href="https://rdrr.io/pkg/ggtree/man/geom-hilight.html">geom_hilight</a></span><span class="op">(</span>data<span class="op">=</span><span class="va">nodedf</span>, mapping<span class="op">=</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>node<span class="op">=</span><span class="va">node</span><span class="op">)</span>,
                  extendto<span class="op">=</span><span class="fl">6.8</span>, alpha<span class="op">=</span><span class="fl">0.3</span>, fill<span class="op">=</span><span class="st">"grey"</span>, color<span class="op">=</span><span class="st">"grey50"</span>,
                  size<span class="op">=</span><span class="fl">0.05</span><span class="op">)</span> <span class="op">+</span>
     <span class="fu"><a href="https://rdrr.io/pkg/ggtree/man/geom_cladelab.html">geom_cladelab</a></span><span class="op">(</span>data<span class="op">=</span><span class="va">labdf</span>, 
                   mapping<span class="op">=</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>node<span class="op">=</span><span class="va">node</span>, 
                               label<span class="op">=</span><span class="va">label</span>,
                               offset.text<span class="op">=</span><span class="va">pos</span><span class="op">)</span>,
                   hjust<span class="op">=</span><span class="fl">0.5</span>,
                   angle<span class="op">=</span><span class="st">"auto"</span>,
                   barsize<span class="op">=</span><span class="cn">NA</span>,
                   horizontal<span class="op">=</span><span class="cn">FALSE</span>, 
                   fontsize<span class="op">=</span><span class="fl">1.4</span>,
                   fontface<span class="op">=</span><span class="st">"italic"</span>
                   <span class="op">)</span>

<span class="va">p</span> <span class="op">&lt;-</span> <span class="va">p</span> <span class="op"><a href="https://rdrr.io/pkg/ggtree/man/attacher.html">%&lt;+%</a></span> <span class="va">dat1</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/pkg/ggstar/man/geom_star.html">geom_star</a></span><span class="op">(</span>
                        mapping<span class="op">=</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>fill<span class="op">=</span><span class="va">Phylum</span>, starshape<span class="op">=</span><span class="va">Type</span>, size<span class="op">=</span><span class="va">Size</span><span class="op">)</span>,
                        position<span class="op">=</span><span class="st">"identity"</span>,starstroke<span class="op">=</span><span class="fl">0.1</span><span class="op">)</span> <span class="op">+</span>
        <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_manual.html">scale_fill_manual</a></span><span class="op">(</span>values<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"#FFC125"</span>,<span class="st">"#87CEFA"</span>,<span class="st">"#7B68EE"</span>,<span class="st">"#808080"</span>,
                                <span class="st">"#800080"</span>, <span class="st">"#9ACD32"</span>,<span class="st">"#D15FEE"</span>,<span class="st">"#FFC0CB"</span>,
                                <span class="st">"#EE6A50"</span>,<span class="st">"#8DEEEE"</span>, <span class="st">"#006400"</span>,<span class="st">"#800000"</span>,
                                <span class="st">"#B0171F"</span>,<span class="st">"#191970"</span><span class="op">)</span>,
                           guide<span class="op">=</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/guide_legend.html">guide_legend</a></span><span class="op">(</span>keywidth <span class="op">=</span> <span class="fl">0.5</span>, 
                                        keyheight <span class="op">=</span> <span class="fl">0.5</span>, order<span class="op">=</span><span class="fl">1</span>,
                                        override.aes<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>starshape<span class="op">=</span><span class="fl">15</span><span class="op">)</span><span class="op">)</span>,
                           na.translate<span class="op">=</span><span class="cn">FALSE</span><span class="op">)</span><span class="op">+</span>
        <span class="fu"><a href="https://rdrr.io/pkg/ggstar/man/scale_manual.html">scale_starshape_manual</a></span><span class="op">(</span>values<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">15</span>, <span class="fl">1</span><span class="op">)</span>,
                           guide<span class="op">=</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/guide_legend.html">guide_legend</a></span><span class="op">(</span>keywidth <span class="op">=</span> <span class="fl">0.5</span>, 
                                        keyheight <span class="op">=</span> <span class="fl">0.5</span>, order<span class="op">=</span><span class="fl">2</span><span class="op">)</span>,
                           na.translate<span class="op">=</span><span class="cn">FALSE</span><span class="op">)</span><span class="op">+</span>
        <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_size.html">scale_size_continuous</a></span><span class="op">(</span>range <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">2.5</span><span class="op">)</span>,
                           guide <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/guide_legend.html">guide_legend</a></span><span class="op">(</span>keywidth <span class="op">=</span> <span class="fl">0.5</span>, 
                                        keyheight <span class="op">=</span> <span class="fl">0.5</span>, order<span class="op">=</span><span class="fl">3</span>,
                                        override.aes<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>starshape<span class="op">=</span><span class="fl">15</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>
                                                    
<span class="va">p</span> <span class="op">&lt;-</span> <span class="va">p</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/pkg/ggnewscale/man/new_scale.html">new_scale_fill</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span>
         <span class="fu"><a href="https://rdrr.io/pkg/ggtreeExtra/man/geom_fruit.html">geom_fruit</a></span><span class="op">(</span>data<span class="op">=</span><span class="va">dat2</span>, geom<span class="op">=</span><span class="va">geom_tile</span>,
                  mapping<span class="op">=</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>y<span class="op">=</span><span class="va">ID</span>, x<span class="op">=</span><span class="va">Sites</span>, alpha<span class="op">=</span><span class="va">Abundance</span>, fill<span class="op">=</span><span class="va">Sites</span><span class="op">)</span>,
                  color <span class="op">=</span> <span class="st">"grey50"</span>, offset <span class="op">=</span> <span class="fl">0.04</span>,size <span class="op">=</span> <span class="fl">0.02</span><span class="op">)</span><span class="op">+</span>
         <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_alpha.html">scale_alpha_continuous</a></span><span class="op">(</span>range<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">1</span><span class="op">)</span>,
                             guide<span class="op">=</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/guide_legend.html">guide_legend</a></span><span class="op">(</span>keywidth <span class="op">=</span> <span class="fl">0.3</span>, 
                                             keyheight <span class="op">=</span> <span class="fl">0.3</span>, order<span class="op">=</span><span class="fl">5</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
         <span class="fu"><a href="https://rdrr.io/pkg/ggtreeExtra/man/geom_fruit.html">geom_fruit</a></span><span class="op">(</span>data<span class="op">=</span><span class="va">dat3</span>, geom<span class="op">=</span><span class="va">geom_bar</span>,
                    mapping<span class="op">=</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>y<span class="op">=</span><span class="va">ID</span>, x<span class="op">=</span><span class="va">HigherAbundance</span>, fill<span class="op">=</span><span class="va">Sites</span><span class="op">)</span>,
                    pwidth<span class="op">=</span><span class="fl">0.38</span>, 
                    orientation<span class="op">=</span><span class="st">"y"</span>, 
                    stat<span class="op">=</span><span class="st">"identity"</span>,
         <span class="op">)</span> <span class="op">+</span>
         <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_manual.html">scale_fill_manual</a></span><span class="op">(</span>values<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"#0000FF"</span>,<span class="st">"#FFA500"</span>,<span class="st">"#FF0000"</span>,
                                <span class="st">"#800000"</span>, <span class="st">"#006400"</span>,<span class="st">"#800080"</span>,<span class="st">"#696969"</span><span class="op">)</span>,
                           guide<span class="op">=</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/guide_legend.html">guide_legend</a></span><span class="op">(</span>keywidth <span class="op">=</span> <span class="fl">0.3</span>, 
                                        keyheight <span class="op">=</span> <span class="fl">0.3</span>, order<span class="op">=</span><span class="fl">4</span><span class="op">)</span><span class="op">)</span><span class="op">+</span>
         <span class="fu"><a href="https://rdrr.io/pkg/ggtree/man/geom_treescale.html">geom_treescale</a></span><span class="op">(</span>fontsize<span class="op">=</span><span class="fl">2</span>, linesize<span class="op">=</span><span class="fl">0.3</span>, x<span class="op">=</span><span class="fl">4.9</span>, y<span class="op">=</span><span class="fl">0.1</span><span class="op">)</span> <span class="op">+</span>
         <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html">theme</a></span><span class="op">(</span>legend.position<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0.93</span>, <span class="fl">0.5</span><span class="op">)</span>,
               legend.background<span class="op">=</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_rect</a></span><span class="op">(</span>fill<span class="op">=</span><span class="cn">NA</span><span class="op">)</span>,
               legend.title<span class="op">=</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_text</a></span><span class="op">(</span>size<span class="op">=</span><span class="fl">6.5</span><span class="op">)</span>,
               legend.text<span class="op">=</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_text</a></span><span class="op">(</span>size<span class="op">=</span><span class="fl">4.5</span><span class="op">)</span>,
               legend.spacing.y <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/grid/unit.html">unit</a></span><span class="op">(</span><span class="fl">0.02</span>, <span class="st">"cm"</span><span class="op">)</span>,
             <span class="op">)</span>
<span class="va">p</span></code></pre></div>
<div class="figure">
<span style="display:block;" id="fig:HMPplot"></span>
<img src="treedata_files/figure-html/HMPplot-1.png" alt="Presenting microbiome data (abundance and location) on a phylogenetic tree. The tree was annotated with symbolic points, highlighted clades, and clade labels. Two geom_fruit() layers were used to visualize location and abundance information." width="100%"><p class="caption">
FIGURE 10.2: <strong>Presenting microbiome data (abundance and location) on a phylogenetic tree.</strong> The tree was annotated with symbolic points, highlighted clades, and clade labels. Two <code><a href="https://rdrr.io/pkg/ggtreeExtra/man/geom_fruit.html">geom_fruit()</a></code> layers were used to visualize location and abundance information.
</p>
</div>
<p>The shape of the tip points indicates the types of microbes (commensal microbes or potential pathogens). The transparency of the heatmap indicates the abundance of the microbes, and the colors of the heatmap indicate different sites of the human body. The bar plot indicates the relative abundance of the most prevalent species at the body sites. The node labels contain taxonomy information in this example, and the information was used to highlight and label corresponding clades using <code><a href="https://rdrr.io/pkg/ggtree/man/geom-hilight.html">geom_hilight()</a></code> and <code><a href="https://rdrr.io/pkg/ggtree/man/geom_cladelab.html">geom_cladelab()</a></code>, respectively.</p>
<p>The <code><a href="https://rdrr.io/pkg/ggtreeExtra/man/geom_fruit.html">geom_fruit()</a></code> layer supports rectangular layout. Users can either add a <code><a href="https://rdrr.io/pkg/ggtreeExtra/man/geom_fruit.html">geom_fruit()</a></code> layer to a rectangular tree (e.g., <code>ggtree(tree_object) + geom_fruit(...)</code>) or use <code><a href="https://rdrr.io/pkg/ggtree/man/tree-layout.html">layout_rectangular()</a></code> to transform a circular layout tree to a rectangular layout tree as demonstrated in Figure <a href="chapter10.html#fig:HMPplot2">10.3</a>.</p>


<div class="sourceCode" id="cb227"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">p</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/pkg/ggtree/man/tree-layout.html">layout_rectangular</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span> 
    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html">theme</a></span><span class="op">(</span>legend.position<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">.05</span>, <span class="fl">.7</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<div class="figure">
<span style="display:block;" id="fig:HMPplot2"></span>
<img src="treedata_files/figure-html/HMPplot2-1.png" alt="Illustration of using geom_fruit() in rectangular tree layout. The figure was produced by transforming Figure 10.2 using the rectangular layout. Transforming a rectangular layout tree to a circular layout tree is also supported." width="100%"><p class="caption">
FIGURE 10.3: <strong>Illustration of using <code><a href="https://rdrr.io/pkg/ggtreeExtra/man/geom_fruit.html">geom_fruit()</a></code> in rectangular tree layout.</strong> The figure was produced by transforming Figure <a href="chapter10.html#fig:HMPplot">10.2</a> using the rectangular layout. Transforming a rectangular layout tree to a circular layout tree is also supported.
</p>
</div>
</div>
<div id="examples-for-population-genetics" class="section level2" number="10.4">
<h2>
<span class="header-section-number">10.4</span> Examples for Population Genetics<a class="anchor" aria-label="anchor" href="#examples-for-population-genetics"><i class="fas fa-link"></i></a>
</h2>
<p>The <a href="http://bioconductor.org/packages/ggtree"><strong>ggtree</strong></a> <span class="citation">(<a href="references.html#ref-yu_ggtree:_2017" role="doc-biblioref">Yu et al., 2017</a>)</span> and <a href="http://bioconductor.org/packages/ggtreeExtra"><strong>ggtreeExtra</strong></a> packages are designed as general tools and can be applied to many research fields, such as infectious disease epidemiology, metagenome, population genetics, evolutionary biology, and ecology. We have introduced examples for metagenome research (Figure <a href="chapter10.html#fig:psbox">10.1</a> and Figure <a href="chapter10.html#fig:HMPplot">10.2</a>). In this session, we present examples for population genetics by reproducing figure 4 of <span class="citation">(<a href="references.html#ref-Chowe:_2020" role="doc-biblioref">Chow et al., 2020</a>)</span> and figure 1 of <span class="citation">(<a href="references.html#ref-RN46:_2015" role="doc-biblioref">Wong et al., 2015</a>)</span>.</p>




<div class="sourceCode" id="cb228"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://yulab-smu.top/treedata-book/">ggtree</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/YuLab-SMU/ggtreeExtra/">ggtreeExtra</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://ggplot2.tidyverse.org">ggplot2</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va">ggnewscale</span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/hadley/reshape">reshape2</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://dplyr.tidyverse.org">dplyr</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://yulab-smu.top/treedata-book/">tidytree</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/xiangpin/ggstar/">ggstar</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/YuLab-SMU/TDBook">TDbook</a></span><span class="op">)</span>

<span class="co"># load tr and dat from the TDbook package </span>
<span class="va">dat</span> <span class="op">&lt;-</span> <span class="va">df_Candidaauris_data</span>
<span class="va">tr</span> <span class="op">&lt;-</span> <span class="va">tree_Candidaauris</span>

<span class="va">countries</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"Canada"</span>, <span class="st">"United States"</span>,
               <span class="st">"Colombia"</span>, <span class="st">"Panama"</span>,
               <span class="st">"Venezuela"</span>, <span class="st">"France"</span>,
               <span class="st">"Germany"</span>, <span class="st">"Spain"</span>,
               <span class="st">"UK"</span>, <span class="st">"India"</span>,
               <span class="st">"Israel"</span>, <span class="st">"Pakistan"</span>,
               <span class="st">"Saudi Arabia"</span>, <span class="st">"United Arab Emirates"</span>,
               <span class="st">"Kenya"</span>, <span class="st">"South Africa"</span>,
               <span class="st">"Japan"</span>, <span class="st">"South Korea"</span>,
               <span class="st">"Australia"</span><span class="op">)</span>
<span class="co"># For the tip points</span>
<span class="va">dat1</span> <span class="op">&lt;-</span> <span class="va">dat</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"ID"</span>, <span class="st">"COUNTRY"</span>, <span class="st">"COUNTRY__colour"</span><span class="op">)</span><span class="op">)</span>
<span class="va">dat1</span><span class="op">$</span><span class="va">COUNTRY</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html">factor</a></span><span class="op">(</span><span class="va">dat1</span><span class="op">$</span><span class="va">COUNTRY</span>, levels<span class="op">=</span><span class="va">countries</span><span class="op">)</span>
<span class="va">COUNTRYcolors</span> <span class="op">&lt;-</span> <span class="va">dat1</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/match.html">match</a></span><span class="op">(</span><span class="va">countries</span>,<span class="va">dat</span><span class="op">$</span><span class="va">COUNTRY</span><span class="op">)</span>,<span class="st">"COUNTRY__colour"</span><span class="op">]</span>

<span class="co"># For the heatmap layer</span>
<span class="va">dat2</span> <span class="op">&lt;-</span> <span class="va">dat</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"ID"</span>, <span class="st">"FCZ"</span>, <span class="st">"AMB"</span>, <span class="st">"MCF"</span><span class="op">)</span><span class="op">)</span>
<span class="va">dat2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/reshape2/man/melt.html">melt</a></span><span class="op">(</span><span class="va">dat2</span>,id<span class="op">=</span><span class="st">"ID"</span>, variable.name<span class="op">=</span><span class="st">"Antifungal"</span>, value.name<span class="op">=</span><span class="st">"type"</span><span class="op">)</span>
<span class="va">dat2</span><span class="op">$</span><span class="va">type</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste</a></span><span class="op">(</span><span class="va">dat2</span><span class="op">$</span><span class="va">Antifungal</span>, <span class="va">dat2</span><span class="op">$</span><span class="va">type</span><span class="op">)</span>
<span class="va">dat2</span><span class="op">$</span><span class="va">type</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/grep.html">grepl</a></span><span class="op">(</span><span class="st">"Not_"</span>, <span class="va">dat2</span><span class="op">$</span><span class="va">type</span><span class="op">)</span><span class="op">]</span> <span class="op">=</span> <span class="st">"Susceptible"</span>
<span class="va">dat2</span><span class="op">$</span><span class="va">Antifungal</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html">factor</a></span><span class="op">(</span><span class="va">dat2</span><span class="op">$</span><span class="va">Antifungal</span>, levels<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"FCZ"</span>, <span class="st">"AMB"</span>, <span class="st">"MCF"</span><span class="op">)</span><span class="op">)</span>
<span class="va">dat2</span><span class="op">$</span><span class="va">type</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html">factor</a></span><span class="op">(</span><span class="va">dat2</span><span class="op">$</span><span class="va">type</span>,
                    levels<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"FCZ Resistant"</span>,
                            <span class="st">"AMB Resistant"</span>,
                            <span class="st">"MCF Resistant"</span>,
                            <span class="st">"Susceptible"</span><span class="op">)</span><span class="op">)</span>

<span class="co"># For the points layer</span>
<span class="va">dat3</span> <span class="op">&lt;-</span> <span class="va">dat</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"ID"</span>, <span class="st">"ERG11"</span>, <span class="st">"FKS1"</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span>
        <span class="fu"><a href="https://rdrr.io/pkg/reshape2/man/melt.html">melt</a></span><span class="op">(</span>id<span class="op">=</span><span class="st">"ID"</span>, variable.name<span class="op">=</span><span class="st">"point"</span>, value.name<span class="op">=</span><span class="st">"mutation"</span><span class="op">)</span>
<span class="va">dat3</span><span class="op">$</span><span class="va">mutation</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste</a></span><span class="op">(</span><span class="va">dat3</span><span class="op">$</span><span class="va">point</span>, <span class="va">dat3</span><span class="op">$</span><span class="va">mutation</span><span class="op">)</span>
<span class="va">dat3</span><span class="op">$</span><span class="va">mutation</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/grep.html">grepl</a></span><span class="op">(</span><span class="st">"WT"</span>, <span class="va">dat3</span><span class="op">$</span><span class="va">mutation</span><span class="op">)</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="cn">NA</span>
<span class="va">dat3</span><span class="op">$</span><span class="va">mutation</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html">factor</a></span><span class="op">(</span><span class="va">dat3</span><span class="op">$</span><span class="va">mutation</span>, 
                        levels<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"ERG11 Y132F"</span>, <span class="st">"ERG11 K143R"</span>,
                                 <span class="st">"ERG11 F126L"</span>, <span class="st">"FKS1 S639Y/P/F"</span><span class="op">)</span><span class="op">)</span>

<span class="co"># For the clade group</span>
<span class="va">dat4</span> <span class="op">&lt;-</span> <span class="va">dat</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"ID"</span>, <span class="st">"CLADE"</span><span class="op">)</span><span class="op">)</span>
<span class="va">dat4</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/aggregate.html">aggregate</a></span><span class="op">(</span><span class="va">.</span><span class="op">~</span><span class="va">CLADE</span>, <span class="va">dat4</span>, FUN<span class="op">=</span><span class="va">paste</span>, collapse<span class="op">=</span><span class="st">","</span><span class="op">)</span>
<span class="va">clades</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html">lapply</a></span><span class="op">(</span><span class="va">dat4</span><span class="op">$</span><span class="va">ID</span>, <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span><span class="op">{</span><span class="fu"><a href="https://rdrr.io/r/base/unlist.html">unlist</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/strsplit.html">strsplit</a></span><span class="op">(</span><span class="va">x</span>,split<span class="op">=</span><span class="st">","</span><span class="op">)</span><span class="op">)</span><span class="op">}</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/pkg/phylobase/man/print-methods.html">names</a></span><span class="op">(</span><span class="va">clades</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="va">dat4</span><span class="op">$</span><span class="va">CLADE</span>

<span class="va">tr</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/tidytree/man/groupOTU.html">groupOTU</a></span><span class="op">(</span><span class="va">tr</span>, <span class="va">clades</span>, <span class="st">"Clade"</span><span class="op">)</span>
<span class="va">Clade</span> <span class="op">&lt;-</span> <span class="cn">NULL</span>
<span class="va">p</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/ggtree/man/ggtree.html">ggtree</a></span><span class="op">(</span>tr<span class="op">=</span><span class="va">tr</span>, layout<span class="op">=</span><span class="st">"fan"</span>, open.angle<span class="op">=</span><span class="fl">15</span>, size<span class="op">=</span><span class="fl">0.2</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>colour<span class="op">=</span><span class="va">Clade</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
     <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_manual.html">scale_colour_manual</a></span><span class="op">(</span>
         values<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"black"</span>,<span class="st">"#69B920"</span>,<span class="st">"#9C2E88"</span>,<span class="st">"#F74B00"</span>,<span class="st">"#60C3DB"</span><span class="op">)</span>,
         labels<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">""</span>,<span class="st">"I"</span>, <span class="st">"II"</span>, <span class="st">"III"</span>, <span class="st">"IV"</span><span class="op">)</span>,
         guide<span class="op">=</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/guide_legend.html">guide_legend</a></span><span class="op">(</span>keywidth<span class="op">=</span><span class="fl">0.5</span>,
                            keyheight<span class="op">=</span><span class="fl">0.5</span>,
                            order<span class="op">=</span><span class="fl">1</span>,
                            override.aes<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>linetype<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"0"</span><span class="op">=</span><span class="cn">NA</span>,
                                                         <span class="st">"Clade1"</span><span class="op">=</span><span class="fl">1</span>,
                                                         <span class="st">"Clade2"</span><span class="op">=</span><span class="fl">1</span>,
                                                         <span class="st">"Clade3"</span><span class="op">=</span><span class="fl">1</span>,
                                                         <span class="st">"Clade4"</span><span class="op">=</span><span class="fl">1</span>
                                                        <span class="op">)</span>
                                             <span class="op">)</span>
                           <span class="op">)</span>
     <span class="op">)</span> <span class="op">+</span> 
     <span class="fu"><a href="https://rdrr.io/pkg/ggnewscale/man/new_scale.html">new_scale_colour</a></span><span class="op">(</span><span class="op">)</span>

<span class="va">p1</span> <span class="op">&lt;-</span> <span class="va">p</span> <span class="op"><a href="https://rdrr.io/pkg/ggtree/man/attacher.html">%&lt;+%</a></span> <span class="va">dat1</span> <span class="op">+</span>
     <span class="fu"><a href="https://rdrr.io/pkg/ggtree/man/geom_tippoint.html">geom_tippoint</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>colour<span class="op">=</span><span class="va">COUNTRY</span><span class="op">)</span>,
                   alpha<span class="op">=</span><span class="fl">0</span><span class="op">)</span> <span class="op">+</span>
     <span class="fu"><a href="https://rdrr.io/pkg/ggtree/man/geom_tiplab.html">geom_tiplab</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>colour<span class="op">=</span><span class="va">COUNTRY</span><span class="op">)</span>,
                   align<span class="op">=</span><span class="cn">TRUE</span>,
                   linetype<span class="op">=</span><span class="fl">3</span>,
                   size<span class="op">=</span><span class="fl">1</span>,
                   linesize<span class="op">=</span><span class="fl">0.2</span>,
                   show.legend<span class="op">=</span><span class="cn">FALSE</span>
                   <span class="op">)</span> <span class="op">+</span>
     <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_manual.html">scale_colour_manual</a></span><span class="op">(</span>
         name<span class="op">=</span><span class="st">"Country labels"</span>,
         values<span class="op">=</span><span class="va">COUNTRYcolors</span>,
         guide<span class="op">=</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/guide_legend.html">guide_legend</a></span><span class="op">(</span>keywidth<span class="op">=</span><span class="fl">0.5</span>,
                            keyheight<span class="op">=</span><span class="fl">0.5</span>,
                            order<span class="op">=</span><span class="fl">2</span>,
                            override.aes<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>size<span class="op">=</span><span class="fl">2</span>,alpha<span class="op">=</span><span class="fl">1</span><span class="op">)</span><span class="op">)</span>
     <span class="op">)</span>

<span class="va">p2</span> <span class="op">&lt;-</span> <span class="va">p1</span> <span class="op">+</span>
      <span class="fu"><a href="https://rdrr.io/pkg/ggtreeExtra/man/geom_fruit.html">geom_fruit</a></span><span class="op">(</span>
          data<span class="op">=</span><span class="va">dat2</span>,
          geom<span class="op">=</span><span class="va">geom_tile</span>,
          mapping<span class="op">=</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x<span class="op">=</span><span class="va">Antifungal</span>, y<span class="op">=</span><span class="va">ID</span>, fill<span class="op">=</span><span class="va">type</span><span class="op">)</span>,
          width<span class="op">=</span><span class="fl">0.1</span>,
          color<span class="op">=</span><span class="st">"white"</span>,
          pwidth<span class="op">=</span><span class="fl">0.1</span>,
          offset<span class="op">=</span><span class="fl">0.15</span>
      <span class="op">)</span> <span class="op">+</span>
      <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_manual.html">scale_fill_manual</a></span><span class="op">(</span>
           name<span class="op">=</span><span class="st">"Antifungal susceptibility"</span>,
           values<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"#595959"</span>, <span class="st">"#B30000"</span>, <span class="st">"#020099"</span>, <span class="st">"#E6E6E6"</span><span class="op">)</span>,
           na.translate<span class="op">=</span><span class="cn">FALSE</span>,
           guide<span class="op">=</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/guide_legend.html">guide_legend</a></span><span class="op">(</span>keywidth<span class="op">=</span><span class="fl">0.5</span>,
                              keyheight<span class="op">=</span><span class="fl">0.5</span>,
                              order<span class="op">=</span><span class="fl">3</span>
                             <span class="op">)</span>
      <span class="op">)</span> <span class="op">+</span>
      <span class="fu"><a href="https://rdrr.io/pkg/ggnewscale/man/new_scale.html">new_scale_fill</a></span><span class="op">(</span><span class="op">)</span>

<span class="va">p3</span> <span class="op">&lt;-</span> <span class="va">p2</span> <span class="op">+</span>
      <span class="fu"><a href="https://rdrr.io/pkg/ggtreeExtra/man/geom_fruit.html">geom_fruit</a></span><span class="op">(</span>
          data<span class="op">=</span><span class="va">dat3</span>,
          geom<span class="op">=</span><span class="va">geom_star</span>,
          mapping<span class="op">=</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x<span class="op">=</span><span class="va">mutation</span>, y<span class="op">=</span><span class="va">ID</span>, fill<span class="op">=</span><span class="va">mutation</span>, starshape<span class="op">=</span><span class="va">point</span><span class="op">)</span>,
          size<span class="op">=</span><span class="fl">1</span>,
          starstroke<span class="op">=</span><span class="fl">0</span>,
          pwidth<span class="op">=</span><span class="fl">0.1</span>,
          inherit.aes <span class="op">=</span> <span class="cn">FALSE</span>,
          grid.params<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>
                          linetype<span class="op">=</span><span class="fl">3</span>,
                          size<span class="op">=</span><span class="fl">0.2</span>
                      <span class="op">)</span>

      <span class="op">)</span> <span class="op">+</span>
      <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_manual.html">scale_fill_manual</a></span><span class="op">(</span>
          name<span class="op">=</span><span class="st">"Point mutations"</span>,
          values<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"#329901"</span>, <span class="st">"#0600FF"</span>, <span class="st">"#FF0100"</span>, <span class="st">"#9900CC"</span><span class="op">)</span>,
          guide<span class="op">=</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/guide_legend.html">guide_legend</a></span><span class="op">(</span>keywidth<span class="op">=</span><span class="fl">0.5</span>, keyheight<span class="op">=</span><span class="fl">0.5</span>, order<span class="op">=</span><span class="fl">4</span>,
                             override.aes<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>
                                    starshape<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"ERG11 Y132F"</span><span class="op">=</span><span class="fl">15</span>,
                                                <span class="st">"ERG11 K143R"</span><span class="op">=</span><span class="fl">15</span>,
                                                <span class="st">"ERG11 F126L"</span><span class="op">=</span><span class="fl">15</span>,
                                                <span class="st">"FKS1 S639Y/P/F"</span><span class="op">=</span><span class="fl">1</span><span class="op">)</span>,
                                    size<span class="op">=</span><span class="fl">2</span><span class="op">)</span>
                            <span class="op">)</span>,
          na.translate<span class="op">=</span><span class="cn">FALSE</span>,
      <span class="op">)</span> <span class="op">+</span>
      <span class="fu"><a href="https://rdrr.io/pkg/ggstar/man/scale_manual.html">scale_starshape_manual</a></span><span class="op">(</span>
          values<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">15</span>, <span class="fl">1</span><span class="op">)</span>,
          guide<span class="op">=</span><span class="st">"none"</span>
      <span class="op">)</span> <span class="op">+</span>
      <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html">theme</a></span><span class="op">(</span>
          legend.background<span class="op">=</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_rect</a></span><span class="op">(</span>fill<span class="op">=</span><span class="cn">NA</span><span class="op">)</span>,
          legend.title<span class="op">=</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_text</a></span><span class="op">(</span>size<span class="op">=</span><span class="fl">7</span><span class="op">)</span>, 
          legend.text<span class="op">=</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_text</a></span><span class="op">(</span>size<span class="op">=</span><span class="fl">5.5</span><span class="op">)</span>,
          legend.spacing.y <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/grid/unit.html">unit</a></span><span class="op">(</span><span class="fl">0.02</span>, <span class="st">"cm"</span><span class="op">)</span>
      <span class="op">)</span>
<span class="va">p3</span></code></pre></div>
<div class="figure">
<span style="display:block;" id="fig:Caurisplot"></span>
<img src="treedata_files/figure-html/Caurisplot-1.png" alt="Antifungal susceptibility and point mutations in drug targets in Candida Auris ." width="100%"><p class="caption">
FIGURE 10.4: <strong>Antifungal susceptibility and point mutations in drug targets in <em>Candida Auris</em> </strong>.
</p>
</div>
<p>In this example, Figure <a href="chapter10.html#fig:Caurisplot">10.4</a> shows the phylogenetic tree annotated with different colors to display different clades. The external heatmaps present the susceptibility to fluconazole (FCZ), amphotericin B (AMB), and micafungin (MCF). The external points display the point mutations in lanosterol 14-alpha-demethylase ERG11 (Y132F, K143R, and F126L) and beta-1,3-D-glucan synthase FKS1 (S639Y/P/F) associated with resistance <span class="citation">(<a href="references.html#ref-Chowe:_2020" role="doc-biblioref">Chow et al., 2020</a>)</span>.</p>
<div class="sourceCode" id="cb229"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/YuLab-SMU/ggtreeExtra/">ggtreeExtra</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://yulab-smu.top/treedata-book/">ggtree</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://ggplot2.tidyverse.org">ggplot2</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va">ggnewscale</span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/YuLab-SMU/treeio">treeio</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://yulab-smu.top/treedata-book/">tidytree</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://dplyr.tidyverse.org">dplyr</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/xiangpin/ggstar/">ggstar</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/YuLab-SMU/TDBook">TDbook</a></span><span class="op">)</span>

<span class="co"># load tree_NJIDqgsS and df_NJIDqgsS from TDbook</span>
<span class="va">tr</span> <span class="op">&lt;-</span> <span class="va">tree_NJIDqgsS</span>
<span class="va">metada</span> <span class="op">&lt;-</span> <span class="va">df_NJIDqgsS</span>
<span class="va">metadata</span> <span class="op">&lt;-</span> <span class="va">metada</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span>
            <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"id"</span>, <span class="st">"country"</span>, <span class="st">"country__colour"</span>, 
                    <span class="st">"year"</span>, <span class="st">"year__colour"</span>, <span class="st">"haplotype"</span><span class="op">)</span><span class="op">)</span>
<span class="va">metadata</span><span class="op">$</span><span class="va">haplotype</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/nchar.html">nchar</a></span><span class="op">(</span><span class="va">metadata</span><span class="op">$</span><span class="va">haplotype</span><span class="op">)</span> <span class="op">==</span> <span class="fl">0</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="cn">NA</span>

<span class="va">countrycolors</span> <span class="op">&lt;-</span> <span class="va">metada</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span>
                 <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"country"</span>, <span class="st">"country__colour"</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span>
                 <span class="fu"><a href="https://dplyr.tidyverse.org/reference/distinct.html">distinct</a></span><span class="op">(</span><span class="op">)</span>

<span class="va">yearcolors</span> <span class="op">&lt;-</span> <span class="va">metada</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span>
              <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"year"</span>, <span class="st">"year__colour"</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span>
              <span class="fu"><a href="https://dplyr.tidyverse.org/reference/distinct.html">distinct</a></span><span class="op">(</span><span class="op">)</span>
<span class="va">yearcolors</span> <span class="op">&lt;-</span> <span class="va">yearcolors</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/order.html">order</a></span><span class="op">(</span><span class="va">yearcolors</span><span class="op">$</span><span class="va">year</span>, decreasing<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span>,<span class="op">]</span>

<span class="va">metadata</span><span class="op">$</span><span class="va">country</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html">factor</a></span><span class="op">(</span><span class="va">metadata</span><span class="op">$</span><span class="va">country</span>, levels<span class="op">=</span><span class="va">countrycolors</span><span class="op">$</span><span class="va">country</span><span class="op">)</span>
<span class="va">metadata</span><span class="op">$</span><span class="va">year</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html">factor</a></span><span class="op">(</span><span class="va">metadata</span><span class="op">$</span><span class="va">year</span>, levels<span class="op">=</span><span class="va">yearcolors</span><span class="op">$</span><span class="va">year</span><span class="op">)</span>

<span class="va">p</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/ggtree/man/ggtree.html">ggtree</a></span><span class="op">(</span><span class="va">tr</span>, layout<span class="op">=</span><span class="st">"fan"</span>, open.angle<span class="op">=</span><span class="fl">15</span>, size<span class="op">=</span><span class="fl">0.1</span><span class="op">)</span>

<span class="va">p</span> <span class="op">&lt;-</span> <span class="va">p</span> <span class="op"><a href="https://rdrr.io/pkg/ggtree/man/attacher.html">%&lt;+%</a></span> <span class="va">metadata</span>

<span class="va">p1</span> <span class="op">&lt;-</span><span class="va">p</span> <span class="op">+</span>
     <span class="fu"><a href="https://rdrr.io/pkg/ggtree/man/geom_tippoint.html">geom_tippoint</a></span><span class="op">(</span>
         mapping<span class="op">=</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>colour<span class="op">=</span><span class="va">country</span><span class="op">)</span>,
         size<span class="op">=</span><span class="fl">1.5</span>,
         stroke<span class="op">=</span><span class="fl">0</span>,
         alpha<span class="op">=</span><span class="fl">0.4</span>
     <span class="op">)</span> <span class="op">+</span>
     <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_manual.html">scale_colour_manual</a></span><span class="op">(</span>
         name<span class="op">=</span><span class="st">"Country"</span>,
         values<span class="op">=</span><span class="va">countrycolors</span><span class="op">$</span><span class="va">country__colour</span>,
         guide<span class="op">=</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/guide_legend.html">guide_legend</a></span><span class="op">(</span>keywidth<span class="op">=</span><span class="fl">0.3</span>,
                            keyheight<span class="op">=</span><span class="fl">0.3</span>,
                            ncol<span class="op">=</span><span class="fl">2</span>,
                            override.aes<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>size<span class="op">=</span><span class="fl">2</span>,alpha<span class="op">=</span><span class="fl">1</span><span class="op">)</span>,
                            order<span class="op">=</span><span class="fl">1</span><span class="op">)</span>
     <span class="op">)</span> <span class="op">+</span>
     <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html">theme</a></span><span class="op">(</span>
         legend.title<span class="op">=</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_text</a></span><span class="op">(</span>size<span class="op">=</span><span class="fl">5</span><span class="op">)</span>,
         legend.text<span class="op">=</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_text</a></span><span class="op">(</span>size<span class="op">=</span><span class="fl">4</span><span class="op">)</span>,
         legend.spacing.y <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/grid/unit.html">unit</a></span><span class="op">(</span><span class="fl">0.02</span>, <span class="st">"cm"</span><span class="op">)</span>
     <span class="op">)</span>

<span class="va">p2</span> <span class="op">&lt;-</span><span class="va">p1</span> <span class="op">+</span>
     <span class="fu"><a href="https://rdrr.io/pkg/ggtreeExtra/man/geom_fruit.html">geom_fruit</a></span><span class="op">(</span>
         geom<span class="op">=</span><span class="va">geom_star</span>,
         mapping<span class="op">=</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>fill<span class="op">=</span><span class="va">haplotype</span><span class="op">)</span>,
         starshape<span class="op">=</span><span class="fl">26</span>,
         color<span class="op">=</span><span class="cn">NA</span>,
         size<span class="op">=</span><span class="fl">2</span>,
         starstroke<span class="op">=</span><span class="fl">0</span>,
         offset<span class="op">=</span><span class="fl">0</span>,
     <span class="op">)</span> <span class="op">+</span>
     <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_manual.html">scale_fill_manual</a></span><span class="op">(</span>
         name<span class="op">=</span><span class="st">"Haplotype"</span>,
         values<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"red"</span><span class="op">)</span>,
         guide<span class="op">=</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/guide_legend.html">guide_legend</a></span><span class="op">(</span>
                   keywidth<span class="op">=</span><span class="fl">0.3</span>,
                   keyheight<span class="op">=</span><span class="fl">0.3</span>,
                   order<span class="op">=</span><span class="fl">3</span>
               <span class="op">)</span>,
         na.translate<span class="op">=</span><span class="cn">FALSE</span>
     <span class="op">)</span>

<span class="va">p3</span> <span class="op">&lt;-</span><span class="va">p2</span> <span class="op">+</span>
     <span class="fu"><a href="https://rdrr.io/pkg/ggnewscale/man/new_scale.html">new_scale_fill</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span>
     <span class="fu"><a href="https://rdrr.io/pkg/ggtreeExtra/man/geom_fruit.html">geom_fruit</a></span><span class="op">(</span>
         geom<span class="op">=</span><span class="va">geom_tile</span>,
         mapping<span class="op">=</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>fill<span class="op">=</span><span class="va">year</span><span class="op">)</span>,
         width<span class="op">=</span><span class="fl">0.002</span>,
         offset<span class="op">=</span><span class="fl">0.1</span>
     <span class="op">)</span> <span class="op">+</span>
     <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_manual.html">scale_fill_manual</a></span><span class="op">(</span>
         name<span class="op">=</span><span class="st">"Year"</span>,
         values<span class="op">=</span><span class="va">yearcolors</span><span class="op">$</span><span class="va">year__colour</span>,
         guide<span class="op">=</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/guide_legend.html">guide_legend</a></span><span class="op">(</span>keywidth<span class="op">=</span><span class="fl">0.3</span>, keyheight<span class="op">=</span><span class="fl">0.3</span>, ncol<span class="op">=</span><span class="fl">2</span>, order<span class="op">=</span><span class="fl">2</span><span class="op">)</span>
     <span class="op">)</span> <span class="op">+</span>
     <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html">theme</a></span><span class="op">(</span>
           legend.title<span class="op">=</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_text</a></span><span class="op">(</span>size<span class="op">=</span><span class="fl">6</span><span class="op">)</span>, 
           legend.text<span class="op">=</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_text</a></span><span class="op">(</span>size<span class="op">=</span><span class="fl">4.5</span><span class="op">)</span>,
           legend.spacing.y <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/grid/unit.html">unit</a></span><span class="op">(</span><span class="fl">0.02</span>, <span class="st">"cm"</span><span class="op">)</span>
           <span class="op">)</span>
<span class="va">p3</span></code></pre></div>
<div class="figure">
<span style="display:block;" id="fig:Styphiplot"></span>
<img src="treedata_files/figure-html/Styphiplot-1.png" alt="Population structure of the 1,832 S. Typhi isolates." width="100%"><p class="caption">
FIGURE 10.5: <strong>Population structure of the 1,832 <em>S. Typhi</em> isolates</strong>.
</p>
</div>
<p>Figure <a href="chapter10.html#fig:Styphiplot">10.5</a> is a rooted maximum-likelihood tree of <em>S. Typhi</em> inferred from 22,145 SNPs <span class="citation">(<a href="references.html#ref-RN46:_2015" role="doc-biblioref">Wong et al., 2015</a>)</span>, the colors of the tip points represent the geographical origin of the isolates, and the red symbolic points indicate the haplotype of H58 lineage. The color of the external heatmap indicates the years of isolation <span class="citation">(<a href="references.html#ref-RN46:_2015" role="doc-biblioref">Wong et al., 2015</a>)</span>.</p>
</div>
<div id="summary10" class="section level2" number="10.5">
<h2>
<span class="header-section-number">10.5</span> Summary<a class="anchor" aria-label="anchor" href="#summary10"><i class="fas fa-link"></i></a>
</h2>
<!--

[**ggtreeExtra**](http://bioconductor.org/packages/ggtreeExtra) provides function, `geom_fruit` to align graphs to the tree. But the associated graphs will align in different position. So we also developed `geom_fruit_list` to add multiple layers in the same position. 




such as `geom_star` in [**ggstar**](https://CRAN.R-project.org/package=ggstar), which provides the regular polygon layer for easily discernible shapes based on the grammar of [**ggplot2**](https://CRAN.R-project.org/package=ggplot2). 

-->
<p>Compared to <code><a href="https://rdrr.io/pkg/ggtree/man/facet-plot.html">geom_facet()</a></code>, <code><a href="https://rdrr.io/pkg/ggtreeExtra/man/geom_fruit.html">geom_fruit()</a></code> layer provided in <a href="http://bioconductor.org/packages/ggtreeExtra"><strong>ggtreeExtra</strong></a> is a better implementation of Method 2 proposed by <span class="citation">(<a href="references.html#ref-yu_two_2018" role="doc-biblioref">Yu et al., 2018</a>)</span>. The <code><a href="https://rdrr.io/pkg/ggtree/man/facet-plot.html">geom_facet()</a></code> and <code><a href="https://rdrr.io/pkg/ggtreeExtra/man/geom_fruit.html">geom_fruit()</a></code> have the same design philosophy and have a similar user interface. They rely on other geometric layers to visualize the tree-associated data. These dependent layers are provided by <a href="https://CRAN.R-project.org/package=ggplot2"><strong>ggplot2</strong></a> and its extension packages, including <a href="http://bioconductor.org/packages/ggtree"><strong>ggtree</strong></a>. As more and more layers are implemented by the <a href="https://CRAN.R-project.org/package=ggplot2"><strong>ggplot2</strong></a> community, the types of data and graphics that <code><a href="https://rdrr.io/pkg/ggtree/man/facet-plot.html">geom_facet()</a></code> and <code><a href="https://rdrr.io/pkg/ggtreeExtra/man/geom_fruit.html">geom_fruit()</a></code> can present will also increase.</p>

<div style="page-break-after: always;"></div>
</div>
</div>
  <div class="chapter-nav">
<div class="prev"><a href="chapter9.html"><span class="header-section-number">9</span> ggtree for Other Tree-like Objects</a></div>
<div class="next"><a href="chapter11.html"><span class="header-section-number">11</span> Other ggtree Extensions</a></div>
</div></main><div class="col-md-3 col-lg-2 d-none d-md-block sidebar sidebar-chapter">
    <nav id="toc" data-toggle="toc" aria-label="On this page"><h2>On this page</h2>
      <ul class="nav navbar-nav">
<li><a class="nav-link" href="#chapter10"><span class="header-section-number">10</span> ggtreeExtra for Presenting Data on a Circular Layout</a></li>
<li><a class="nav-link" href="#introduction-2"><span class="header-section-number">10.1</span> Introduction</a></li>
<li><a class="nav-link" href="#geom-fruit1"><span class="header-section-number">10.2</span> Aligning Graphs to the Tree Based on a Tree Structure</a></li>
<li><a class="nav-link" href="#geom-fruit2"><span class="header-section-number">10.3</span> Aligning Multiple Graphs to the Tree for Multi-dimensional Data</a></li>
<li><a class="nav-link" href="#examples-for-population-genetics"><span class="header-section-number">10.4</span> Examples for Population Genetics</a></li>
<li><a class="nav-link" href="#summary10"><span class="header-section-number">10.5</span> Summary</a></li>
</ul>

      <div class="book-extra">
        <ul class="list-unstyled">
          
        </ul>
</div>
    </nav>
</div>

</div>
</div> <!-- .container -->

<footer class="bg-primary text-light mt-5"><div class="container"><div class="row">

  <div class="col-12 col-md-6 mt-3">
    <p>"<strong>Data Integration, Manipulation and Visualization of Phylogenetic Trees</strong>" was written by Guangchuang Yu. It was last built on 2022-04-22.</p>
  </div>

  <div class="col-12 col-md-6 mt-3">
    <p>This book was built by the <a class="text-light" href="https://bookdown.org">bookdown</a> R package.</p>
  </div>

</div></div>
</footer><!-- dynamically load mathjax for compatibility with self-contained --><script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script><script type="text/x-mathjax-config">const popovers = document.querySelectorAll('a.footnote-ref[data-toggle="popover"]');
for (let popover of popovers) {
  const div = document.createElement('div');
  div.setAttribute('style', 'position: absolute; top: 0, left:0; width:0, height:0, overflow: hidden; visibility: hidden;');
  div.innerHTML = popover.getAttribute('data-content');

  var has_math = div.querySelector("span.math");
  if (has_math) {
    document.body.appendChild(div);
    MathJax.Hub.Queue(["Typeset", MathJax.Hub, div]);
    MathJax.Hub.Queue(function() {
      popover.setAttribute('data-content', div.innerHTML);
      document.body.removeChild(div);
    })
  }
}
</script>
</body>
</html>
