<!DOCTYPE html>
<html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>A Frequently asked questions | Data Integration, Manipulation and Visualization of Phylogenetic Trees</title>
<meta name="author" content="Guangchuang Yu">
<meta name="description" content="The ggtree mailing-list17 is a great place to get help, once you have created a reproducible example that illustrates your problem.  A.1 Installation The ggtree is released within the Bioconductor...">
<meta name="generator" content="bookdown 0.24 with bs4_book()">
<meta property="og:title" content="A Frequently asked questions | Data Integration, Manipulation and Visualization of Phylogenetic Trees">
<meta property="og:type" content="book">
<meta property="og:image" content="/book-cover.png">
<meta property="og:description" content="The ggtree mailing-list17 is a great place to get help, once you have created a reproducible example that illustrates your problem.  A.1 Installation The ggtree is released within the Bioconductor...">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="A Frequently asked questions | Data Integration, Manipulation and Visualization of Phylogenetic Trees">
<meta name="twitter:description" content="The ggtree mailing-list17 is a great place to get help, once you have created a reproducible example that illustrates your problem.  A.1 Installation The ggtree is released within the Bioconductor...">
<meta name="twitter:image" content="/book-cover.png">
<!-- JS --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://kit.fontawesome.com/6ecbd6c532.js" crossorigin="anonymous"></script><script src="libs/header-attrs/header-attrs.js"></script><script src="libs/jquery/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="libs/bootstrap/bootstrap.min.css" rel="stylesheet">
<script src="libs/bootstrap/bootstrap.bundle.min.js"></script><script src="libs/bs3compat/transition.js"></script><script src="libs/bs3compat/tabs.js"></script><script src="libs/bs3compat/bs3compat.js"></script><link href="libs/bs4_book/bs4_book.css" rel="stylesheet">
<script src="libs/bs4_book/bs4_book.js"></script><script src="libs/kePrint/kePrint.js"></script><link href="libs/lightable/lightable.css" rel="stylesheet">
<script src="libs/htmlwidgets/htmlwidgets.js"></script><script src="libs/pathseg/pathseg.js"></script><script src="libs/comic/comic.min.js"></script><script src="libs/comicR-binding/comicR.js"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- CSS -->
</head>
<body data-spy="scroll" data-target="#toc">

<div class="container-fluid">
<div class="row">
  <header class="col-sm-12 col-lg-3 sidebar sidebar-book"><a class="sr-only sr-only-focusable" href="#content">Skip to main content</a>

    <div class="d-flex align-items-start justify-content-between">
      <h1>
        <a href="index.html" title="">Data Integration, Manipulation and Visualization of Phylogenetic Trees</a>
      </h1>
      <button class="btn btn-outline-primary d-lg-none ml-2 mt-1" type="button" data-toggle="collapse" data-target="#main-nav" aria-expanded="true" aria-controls="main-nav"><i class="fas fa-bars"></i><span class="sr-only">Show table of contents</span></button>
    </div>

    <div id="main-nav" class="collapse-lg">
      <form role="search">
        <input id="search" class="form-control" type="search" placeholder="Search" aria-label="Search">
</form>

      <nav aria-label="Table of contents"><h2>Table of contents</h2>
        <ul class="book-toc list-unstyled">
<li><a class="" href="index.html">Preface</a></li>
<li><a class="" href="author.html">About the Author</a></li>
<li class="book-part">Part I: Tree data input, output, and manipulation</li>
<li><a class="" href="chapter1.html"><span class="header-section-number">1</span> Importing Tree with Data</a></li>
<li><a class="" href="chapter2.html"><span class="header-section-number">2</span> Manipulating Tree with Data</a></li>
<li><a class="" href="chapter3.html"><span class="header-section-number">3</span> Exporting tree with data</a></li>
<li class="book-part">Part II: Tree data visualization and annotation</li>
<li><a class="" href="chapter4.html"><span class="header-section-number">4</span> Phylogenetic Tree Visualization</a></li>
<li><a class="" href="chapter5.html"><span class="header-section-number">5</span> Phylogenetic Tree Annotation</a></li>
<li><a class="" href="chapter6.html"><span class="header-section-number">6</span> Visual Exploration of Phylogenetic Tree</a></li>
<li><a class="" href="chapter7.html"><span class="header-section-number">7</span> Plotting tree with data</a></li>
<li><a class="" href="chapter8.html"><span class="header-section-number">8</span> Annotating Tree with Silhouette Images and Sub-plots</a></li>
<li><a class="" href="chapter9.html"><span class="header-section-number">9</span> ggtree for other tree-like objects</a></li>
<li class="book-part">Part III: ggtree extensions</li>
<li><a class="" href="chapter10.html"><span class="header-section-number">10</span> ggtreeExtra for presenting data on a circular layout</a></li>
<li><a class="" href="chapter11.html"><span class="header-section-number">11</span> Other ggtree extensions</a></li>
<li class="book-part">Part IV: Miscellaneous topics</li>
<li><a class="" href="chapter12.html"><span class="header-section-number">12</span> ggtree utilities</a></li>
<li><a class="" href="chapter13.html"><span class="header-section-number">13</span> Gallery of reproducible examples</a></li>
<li class="book-part">Appendix</li>
<li><a class="active" href="faq.html"><span class="header-section-number">A</span> Frequently asked questions</a></li>
<li><a class="" href="related-tools.html"><span class="header-section-number">B</span> Related tools</a></li>
<li><a class="" href="figures-and-tables.html"><span class="header-section-number">C</span> Figures and Tables</a></li>
<li><a class="" href="publications-of-the-ggtree-package-suite.html"><span class="header-section-number">D</span> Publications of the ggtree package suite</a></li>
<li><a class="" href="references.html">References</a></li>
</ul>

        <div class="book-extra">
          
        </div>
      </nav>
</div>
  </header><main class="col-sm-12 col-md-9 col-lg-7" id="content"><div id="faq" class="section level1" number="14">
<h1>
<span class="header-section-number">A</span> Frequently asked questions<a class="anchor" aria-label="anchor" href="#faq"><i class="fas fa-link"></i></a>
</h1>
<p>The <a href="https://groups.google.com/forum/?#!forum/bioc-ggtree">ggtree mailing-list</a><a class="footnote-ref" tabindex="0" data-toggle="popover" data-content='&lt;p&gt;&lt;a href="https://groups.google.com/forum/?#!forum/bioc-ggtree" class="uri"&gt;https://groups.google.com/forum/?#!forum/bioc-ggtree&lt;/a&gt;&lt;/p&gt;'><sup>17</sup></a> is a great place to get help, once you have created a reproducible example that illustrates your problem.</p>
<div id="installation" class="section level2" number="14.1">
<h2>
<span class="header-section-number">A.1</span> Installation<a class="anchor" aria-label="anchor" href="#installation"><i class="fas fa-link"></i></a>
</h2>
<p>The <a href="http://bioconductor.org/packages/ggtree"><strong>ggtree</strong></a> is released within the Bioconductor project, you need to use <a href="https://CRAN.R-project.org/package=BiocManager"><strong>BiocManager</strong></a> to install it.</p>
<div class="sourceCode" id="cb260"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">## you need to install BiocManager before using it</span>
<span class="co">## install.packages("BiocManager")</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va">BiocManager</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/pkg/BiocManager/man/install.html">install</a></span><span class="op">(</span><span class="st">"ggtree"</span><span class="op">)</span></code></pre></div>
<p>Bioconductor release is adhered to a specific R version. Please make sure you are using the latest version of R if you want to install the latest release of Bioconductor packages, including <a href="http://bioconductor.org/packages/ggtree"><strong>ggtree</strong></a>. Beware that bugs will only be fixed in the current release and develop branches. If you find a bug, please follow the guide<a class="footnote-ref" tabindex="0" data-toggle="popover" data-content='&lt;p&gt;&lt;a href="https://guangchuangyu.github.io/2016/07/how-to-bug-author/" class="uri"&gt;https://guangchuangyu.github.io/2016/07/how-to-bug-author/&lt;/a&gt;&lt;/p&gt;'><sup>18</sup></a> to report it.</p>
<p>To make it easy to install and load multiple core packages in a single step, we created a meta package, <a href="https://github.com/YuLab-SMU/treedataverse"><strong>treedataverse</strong></a>. Users can install the package via the following command:</p>
<div class="sourceCode" id="cb261"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">BiocManager</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/BiocManager/man/install.html">install</a></span><span class="op">(</span><span class="st">"YuLab-SMU/treedataverse"</span><span class="op">)</span></code></pre></div>
<p>Once it was installed, loading the package will load the core <a href="https://github.com/YuLab-SMU/treedataverse"><strong>treedataverse</strong></a> packages, including <a href="https://CRAN.R-project.org/package=tidytree"><strong>tidytree</strong></a>, <a href="http://bioconductor.org/packages/treeio"><strong>treeio</strong></a>, <a href="http://bioconductor.org/packages/ggtree"><strong>ggtree</strong></a>, and <a href="http://bioconductor.org/packages/ggtreeExtra"><strong>ggtreeExtra</strong></a>.</p>
</div>
<div id="faq-r" class="section level2" number="14.2">
<h2>
<span class="header-section-number">A.2</span> Basic R related<a class="anchor" aria-label="anchor" href="#faq-r"><i class="fas fa-link"></i></a>
</h2>
<div id="faq-local-file" class="section level3" number="14.2.1">
<h3>
<span class="header-section-number">A.2.1</span> Use your local file<a class="anchor" aria-label="anchor" href="#faq-local-file"><i class="fas fa-link"></i></a>
</h3>
<p>If you are new to <code>R</code> and want to use <a href="http://bioconductor.org/packages/ggtree"><strong>ggtree</strong></a> for tree visualization, please do
learn some basic <code>R</code> and <a href="https://CRAN.R-project.org/package=ggplot2"><strong>ggplot2</strong></a>.</p>
<p>A very common issue is that users copy-paste commands without looking at
the function’s behavior. The <code><a href="https://rdrr.io/r/base/system.file.html">system.file()</a></code> function was used in some of our examples to find files packed in the packages.</p>
<pre><code>system.file                package:base                R Documentation

Find Names of R System Files

Description:

     Finds the full file names of files in packages etc.

Usage:

     system.file(..., package = "base", lib.loc = NULL,
                 mustWork = FALSE)</code></pre>
<p>For users who want to use their files, please just use relative or absolute file path (<em>e.g.</em> <code>file = "your/folder/filename"</code>).</p>
</div>
</div>
<div id="faq-aes-mapping" class="section level2" number="14.3">
<h2>
<span class="header-section-number">A.3</span> Aesthetic mapping<a class="anchor" aria-label="anchor" href="#faq-aes-mapping"><i class="fas fa-link"></i></a>
</h2>
<div id="faq-inherit-aes" class="section level3" number="14.3.1">
<h3>
<span class="header-section-number">A.3.1</span> Inherit aesthetic mapping<a class="anchor" aria-label="anchor" href="#faq-inherit-aes"><i class="fas fa-link"></i></a>
</h3>
<div class="sourceCode" id="cb263"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/pkg/ggtree/man/ggtree.html">ggtree</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/ape/man/rtree.html">rtree</a></span><span class="op">(</span><span class="fl">30</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html">geom_point</a></span><span class="op">(</span><span class="op">)</span></code></pre></div>
<p>For example, we can add symbolic points to nodes with <code><a href="https://ggplot2.tidyverse.org/reference/geom_point.html">geom_point()</a></code> directly.
The magic here is we don’t need to map the <code>x</code> and <code>y</code> position of the points by providing <code>aes(x, y)</code> to <code><a href="https://ggplot2.tidyverse.org/reference/geom_point.html">geom_point()</a></code> since it was already mapped by the <code><a href="https://rdrr.io/pkg/ggtree/man/ggtree.html">ggtree()</a></code> function and it serves as a global mapping for all layers.</p>
<p>But what if we provide a dataset in a layer and the dataset doesn’t contain columns of <code>x</code> and/or <code>y</code>,
the layer function also try to map <code>x</code> and <code>y</code> and also others if you map them in the <code><a href="https://rdrr.io/pkg/ggtree/man/ggtree.html">ggtree()</a></code> function.
As these variables are not available in your dataset, you will get the following error:</p>
<pre><code>Error in eval(expr, envir, enclos) : object 'x' not found</code></pre>
<p>This can be fixed by using the parameter <code>inherit.aes=FALSE</code> which will disable inheriting mapping from the <code><a href="https://rdrr.io/pkg/ggtree/man/ggtree.html">ggtree()</a></code> function.</p>
</div>
<div id="faq-dollar-aes" class="section level3" number="14.3.2">
<h3>
<span class="header-section-number">A.3.2</span> Never use <code>$</code> in aesthetic mapping<a class="anchor" aria-label="anchor" href="#faq-dollar-aes"><i class="fas fa-link"></i></a>
</h3>
<p>Never do this<a class="footnote-ref" tabindex="0" data-toggle="popover" data-content='&lt;p&gt;&lt;a href="https://groups.google.com/d/msg/bioc-ggtree/hViM6vRZF94/MsZT8qRgBwAJ" class="uri"&gt;https://groups.google.com/d/msg/bioc-ggtree/hViM6vRZF94/MsZT8qRgBwAJ&lt;/a&gt;
and &lt;a href="https://github.com/GuangchuangYu/ggtree/issues/106" class="uri"&gt;https://github.com/GuangchuangYu/ggtree/issues/106&lt;/a&gt;&lt;/p&gt;'><sup>19</sup></a> and please refer to the explanation in the <a href="https://github.com/hadley/ggplot2-book/blob/master/layers.Rmd#L185">ggplot2 book 2ed</a> <span class="citation">(<a href="references.html#ref-wickham_ggplot2_2016" role="doc-biblioref">Wickham 2016</a>)</span>:</p>
<blockquote>
<p>Never refer to a variable with <code>$</code> (e.g., <code>diamonds$carat</code>) in <code><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes()</a></code>. This breaks containment so that the plot no longer contains everything it needs and causes problems if ggplot2 changes the order of the rows, as it does when facetting.</p>
</blockquote>
</div>
</div>
<div id="faq-text" class="section level2" number="14.4">
<h2>
<span class="header-section-number">A.4</span> Text &amp; Label<a class="anchor" aria-label="anchor" href="#faq-text"><i class="fas fa-link"></i></a>
</h2>
<div id="faq-label-truncated" class="section level3" number="14.4.1">
<h3>
<span class="header-section-number">A.4.1</span> Tip label truncated<a class="anchor" aria-label="anchor" href="#faq-label-truncated"><i class="fas fa-link"></i></a>
</h3>
<p>The reason for this issue is that <a href="https://CRAN.R-project.org/package=ggplot2"><strong>ggplot2</strong></a> can’t auto-adjust <code>xlim</code> based on added text<a class="footnote-ref" tabindex="0" data-toggle="popover" data-content='&lt;p&gt;&lt;a href="https://twitter.com/hadleywickham/status/600280284869697538" class="uri"&gt;https://twitter.com/hadleywickham/status/600280284869697538&lt;/a&gt;&lt;/p&gt;'><sup>20</sup></a>.</p>
<div class="sourceCode" id="cb265"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://yulab-smu.top/treedata-book/">ggtree</a></span><span class="op">)</span>
<span class="co">## example tree from https://support.bioconductor.org/p/72398/</span>
<span class="va">tree</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/ape/man/read.tree.html">read.tree</a></span><span class="op">(</span>text<span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/BiocGenerics/man/paste.html">paste</a></span><span class="op">(</span><span class="st">"(Organism1.006G249400.1:0.03977,"</span>, 
    <span class="st">"(Organism2.022118m:0.01337,(Organism3.J34265.1:0.00284,"</span>,
    <span class="st">"Organism4.G02633.1:0.00468)0.51:0.0104):0.02469);"</span><span class="op">)</span><span class="op">)</span>
<span class="va">p</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/ggtree/man/ggtree.html">ggtree</a></span><span class="op">(</span><span class="va">tree</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/pkg/ggtree/man/geom_tiplab.html">geom_tiplab</a></span><span class="op">(</span><span class="op">)</span>  </code></pre></div>
<p>In this example, the tip labels displayed in Figure <a href="faq.html#fig:truncatedTip">A.1</a>A are truncated. This is because the units are in two different spaces (data and pixel). Users can use <code>xlim</code> to allocate more spaces for tip labels (Figure <a href="faq.html#fig:truncatedTip">A.1</a>B).</p>
<div class="sourceCode" id="cb266"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">p</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/lims.html">xlim</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">0.08</span><span class="op">)</span></code></pre></div>
<p>Another solution is to set <code>clip = "off"</code> to allow drawing outside of the plot panel. We may also need to set <code>plot.margin</code> to allocate more spaces for margin (Figure <a href="faq.html#fig:truncatedTip">A.1</a>C).</p>
<div class="sourceCode" id="cb267"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">p</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/coord_cartesian.html">coord_cartesian</a></span><span class="op">(</span>clip <span class="op">=</span> <span class="st">'off'</span><span class="op">)</span> <span class="op">+</span> 
  <span class="fu"><a href="https://rdrr.io/pkg/ggtree/man/theme_tree2.html">theme_tree2</a></span><span class="op">(</span>plot.margin<span class="op">=</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">margin</a></span><span class="op">(</span><span class="fl">6</span>, <span class="fl">120</span>, <span class="fl">6</span>, <span class="fl">6</span><span class="op">)</span><span class="op">)</span></code></pre></div>


<div class="figure">
<span style="display:block;" id="fig:truncatedTip"></span>
<img src="treedata_files/figure-html/truncatedTip-1.svg" alt="Allocating more spaces for truncated tip labels. Long tip labels may be truncated (A). One solution is to allocate more spaces for plot panel (B) and another solution is to allow plotting labels outside the plot panel (C)." width="100%"><p class="caption">
FIGURE A.1: <strong>Allocating more spaces for truncated tip labels.</strong> Long tip labels may be truncated (A). One solution is to allocate more spaces for plot panel (B) and another solution is to allow plotting labels outside the plot panel (C).
</p>
</div>
<p>The third solution is using <code><a href="https://rdrr.io/pkg/ggtree/man/ggexpand.html">hexpand()</a></code> as demonstrated in <a href="chapter12.html#ggexpand">session 12.4</a>.</p>
<p>For rectangular/dendrogram layout trees, users can display tip labels as y-axis labels. In this case, no matter how long the labels are, they will not be truncated (see Figure <a href="chapter4.html#fig:tiplab">4.8</a>C).</p>
</div>
<div id="faq-modify-label" class="section level3" number="14.4.2">
<h3>
<span class="header-section-number">A.4.2</span> Modify (tip) labels<a class="anchor" aria-label="anchor" href="#faq-modify-label"><i class="fas fa-link"></i></a>
</h3>
<p>If you want to modify tip labels of the tree, you can use <code><a href="https://docs.ropensci.org/treeio/reference/rename_taxa.html">treeio::rename_taxa()</a></code> to rename a <code>phylo</code> or <code>treedata</code> object.</p>
<div class="sourceCode" id="cb268"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">tree</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/ape/man/read.tree.html">read.tree</a></span><span class="op">(</span>text <span class="op">=</span> <span class="st">"((A, B), (C, D));"</span><span class="op">)</span>
<span class="va">d</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span>label <span class="op">=</span> <span class="va">LETTERS</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">4</span><span class="op">]</span>, 
                label2 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/S4Vectors/man/Vector-class.html">c</a></span><span class="op">(</span><span class="st">"sunflower"</span>, <span class="st">"tree"</span>, <span class="st">"snail"</span>, <span class="st">"mushroom"</span><span class="op">)</span><span class="op">)</span>

<span class="co">## rename_taxa use 1st column as key and 2nd column as value by default                </span>
<span class="co">## rename_taxa(tree, d)</span>
<span class="fu"><a href="https://docs.ropensci.org/treeio/reference/rename_taxa.html">rename_taxa</a></span><span class="op">(</span><span class="va">tree</span>, <span class="va">d</span>, <span class="va">label</span>, <span class="va">label2</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> <span class="va">write.tree</span></code></pre></div>
<pre><code>## [1] "((sunflower,tree),(snail,mushroom));"</code></pre>
<p>If the input tree object is a <code>treedata</code> instance, you can use <code><a href="https://docs.ropensci.org/treeio/reference/write.beast.html">write.beast()</a></code> to export the tree with associated data to a BEAST compatible NEXUS file (see <a href="chapter3.html#chapter3">Chapter 3</a>).</p>
<p>Renaming phylogeny tip labels seems not to be a good idea, since it may introduce problems when mapping the original sequence alignment to the tree. Personally, I recommend storing the new labels as a tip annotation in <code>treedata</code> object.</p>
<div class="sourceCode" id="cb270"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">tree2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html">full_join</a></span><span class="op">(</span><span class="va">tree</span>, <span class="va">d</span>, by <span class="op">=</span> <span class="st">"label"</span><span class="op">)</span>
<span class="va">tree2</span></code></pre></div>
<pre><code>## 'treedata' S4 object'.
## 
## ...@ phylo:
## 
## Phylogenetic tree with 4 tips and 3 internal nodes.
## 
## Tip labels:
##   A, B, C, D
## 
## Rooted; no branch lengths.
## 
## with the following features available:
##   'label2'.</code></pre>
<p>If you just want to show different or additional information when plotting the tree, you don’t need to modify tip labels. This could be easily done via the <code>%&lt;+%</code> operator to attach the modified version of the labels and then use the <code><a href="https://rdrr.io/pkg/ggtree/man/geom_tiplab.html">geom_tiplab()</a></code> layer to display
the modified version (Figure <a href="faq.html#fig:renameTip">A.2</a>).</p>


<div class="sourceCode" id="cb272"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">p</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/ggtree/man/ggtree.html">ggtree</a></span><span class="op">(</span><span class="va">tree</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/lims.html">xlim</a></span><span class="op">(</span><span class="cn">NA</span>, <span class="fl">3</span><span class="op">)</span>
<span class="va">p1</span> <span class="op">&lt;-</span> <span class="va">p</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/pkg/ggtree/man/geom_tiplab.html">geom_tiplab</a></span><span class="op">(</span><span class="op">)</span>

<span class="co">## the following command will produce an identical figure of p2</span>
<span class="co">## ggtree(tree2) + geom_tiplab(aes(label = label2))</span>
<span class="va">p2</span> <span class="op">&lt;-</span> <span class="va">p</span> <span class="op"><a href="https://rdrr.io/pkg/ggtree/man/attacher.html">%&lt;+%</a></span> <span class="va">d</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/pkg/ggtree/man/geom_tiplab.html">geom_tiplab</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>label<span class="op">=</span><span class="va">label2</span><span class="op">)</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/pkg/aplot/man/plot_list.html">plot_list</a></span><span class="op">(</span><span class="va">p1</span>, <span class="va">p2</span>, ncol<span class="op">=</span><span class="fl">2</span>, tag_levels <span class="op">=</span> <span class="st">"A"</span><span class="op">)</span></code></pre></div>
<div class="figure">
<span style="display:block;" id="fig:renameTip"></span>
<img src="treedata_files/figure-html/renameTip-1.svg" alt="Alternative tip labels. Original tip labels (A) and modified version (B)." width="100%"><p class="caption">
FIGURE A.2: <strong>Alternative tip labels.</strong> Original tip labels (A) and modified version (B).
</p>
</div>
</div>
<div id="faq-formatting-label" class="section level3" number="14.4.3">
<h3>
<span class="header-section-number">A.4.3</span> Formatting (tip) labels<a class="anchor" aria-label="anchor" href="#faq-formatting-label"><i class="fas fa-link"></i></a>
</h3>
<p>If you want to format labels, you need to set <code>parse=TRUE</code> in the <code><a href="https://ggplot2.tidyverse.org/reference/geom_text.html">geom_text()</a></code>/<code><a href="https://rdrr.io/pkg/ggtree/man/geom_tiplab.html">geom_tiplab()</a></code>/<code><a href="https://rdrr.io/pkg/ggtree/man/geom_nodelab.html">geom_nodelab()</a></code> and the <code>label</code> should be a string that can be parsed into expression and displayed as described in <code><a href="https://rdrr.io/r/grDevices/plotmath.html">?plotmath</a></code>. Users can use the <a href="https://CRAN.R-project.org/package=latex2exp"><strong>latex2exp</strong></a> package to convert LaTeX math formulas to R’s plotmath expressions, or use the <a href="https://CRAN.R-project.org/package=ggtext"><strong>ggtext</strong></a> package to render Markdown or HTML.</p>
<p>For example, the tip labels contain several parts (<em>e.g.</em> genus, species, and geo), we can differentiate these pieces of information with different formats (Figure <a href="faq.html#fig:formatTip">A.3</a>A).</p>
<div class="sourceCode" id="cb273"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">tree</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/ape/man/read.tree.html">read.tree</a></span><span class="op">(</span>text <span class="op">=</span> <span class="st">"((a,(b,c)),d);"</span><span class="op">)</span>
<span class="va">genus</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/S4Vectors/man/Vector-class.html">c</a></span><span class="op">(</span><span class="st">"Gorilla"</span>, <span class="st">"Pan"</span>, <span class="st">"Homo"</span>, <span class="st">"Pongo"</span><span class="op">)</span>
<span class="va">species</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/S4Vectors/man/Vector-class.html">c</a></span><span class="op">(</span><span class="st">"gorilla"</span>, <span class="st">"spp."</span>, <span class="st">"sapiens"</span>, <span class="st">"pygmaeus"</span><span class="op">)</span>
<span class="va">geo</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/S4Vectors/man/Vector-class.html">c</a></span><span class="op">(</span><span class="st">"Africa"</span>, <span class="st">"Africa"</span>, <span class="st">"World"</span>, <span class="st">"Asia"</span><span class="op">)</span>
<span class="va">d</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span>label <span class="op">=</span> <span class="va">tree</span><span class="op">$</span><span class="va">tip.label</span>, genus <span class="op">=</span> <span class="va">genus</span>,
                species <span class="op">=</span> <span class="va">species</span>, geo <span class="op">=</span> <span class="va">geo</span><span class="op">)</span>

<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/tidyverse/glue">glue</a></span><span class="op">)</span>
<span class="va">d2</span> <span class="op">&lt;-</span> <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span><span class="va">d</span>, 
  lab <span class="op">=</span> <span class="fu"><a href="https://glue.tidyverse.org/reference/glue.html">glue</a></span><span class="op">(</span><span class="st">"italic({genus})~bolditalic({species})~({geo})"</span><span class="op">)</span>,
  color <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/S4Vectors/man/Vector-class.html">c</a></span><span class="op">(</span><span class="st">"#E495A5"</span>, <span class="st">"#ABB065"</span>, <span class="st">"#39BEB1"</span>, <span class="st">"#ACA4E2"</span><span class="op">)</span>,
  name <span class="op">=</span> <span class="fu"><a href="https://glue.tidyverse.org/reference/glue.html">glue</a></span><span class="op">(</span><span class="st">"&lt;i style='color:{color}'&gt;{genus} **{species}**&lt;/i&gt; ({geo})"</span><span class="op">)</span>
<span class="op">)</span> 

<span class="va">p1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/ggtree/man/ggtree.html">ggtree</a></span><span class="op">(</span><span class="va">tree</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/pkg/ggtree/man/attacher.html">%&lt;+%</a></span> <span class="va">d2</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/lims.html">xlim</a></span><span class="op">(</span><span class="cn">NA</span>, <span class="fl">6</span><span class="op">)</span> <span class="op">+</span>
    <span class="fu"><a href="https://rdrr.io/pkg/ggtree/man/geom_tiplab.html">geom_tiplab</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>label<span class="op">=</span><span class="va">lab</span><span class="op">)</span>, parse<span class="op">=</span><span class="cn">T</span><span class="op">)</span></code></pre></div>
<p>Using Markdown or HTML to format text may be easier, and this is supported via the <a href="https://CRAN.R-project.org/package=ggtext"><strong>ggtext</strong></a> package (Figure <a href="faq.html#fig:formatTip">A.3</a>B).</p>
<div class="sourceCode" id="cb274"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://wilkelab.org/ggtext/">ggtext</a></span><span class="op">)</span>

<span class="va">p2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/ggtree/man/ggtree.html">ggtree</a></span><span class="op">(</span><span class="va">tree</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/pkg/ggtree/man/attacher.html">%&lt;+%</a></span> <span class="va">d2</span> <span class="op">+</span> 
  <span class="fu"><a href="https://wilkelab.org/ggtext/reference/geom_richtext.html">geom_richtext</a></span><span class="op">(</span>data<span class="op">=</span><span class="fu"><a href="https://rdrr.io/pkg/ggtree/man/td_filter.html">td_filter</a></span><span class="op">(</span><span class="va">isTip</span><span class="op">)</span>, 
                <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>label<span class="op">=</span><span class="va">name</span><span class="op">)</span>, label.color<span class="op">=</span><span class="cn">NA</span><span class="op">)</span> <span class="op">+</span> 
  <span class="fu"><a href="https://rdrr.io/pkg/ggtree/man/ggexpand.html">hexpand</a></span><span class="op">(</span><span class="fl">.3</span><span class="op">)</span>

<span class="fu"><a href="https://rdrr.io/pkg/aplot/man/plot_list.html">plot_list</a></span><span class="op">(</span><span class="va">p1</span>, <span class="va">p2</span>, ncol<span class="op">=</span><span class="fl">2</span>, tag_levels <span class="op">=</span> <span class="st">'A'</span><span class="op">)</span> </code></pre></div>


<div class="figure">
<span style="display:block;" id="fig:formatTip"></span>
<img src="treedata_files/figure-html/formatTip-1.svg" alt="Formatting labels. Formatting specific tip labels using plotmath expression (A), and Markdown/HTML (B)." width="100%"><p class="caption">
FIGURE A.3: <strong>Formatting labels.</strong> Formatting specific tip labels using <code>plotmath</code> expression (A), and Markdown/HTML (B).
</p>
</div>
</div>
<div id="faq-ggrepel" class="section level3" number="14.4.4">
<h3>
<span class="header-section-number">A.4.4</span> Avoid overlapping text labels<a class="anchor" aria-label="anchor" href="#faq-ggrepel"><i class="fas fa-link"></i></a>
</h3>
<p>Users can use the <a href="https://CRAN.R-project.org/package=ggrepel"><strong>ggrepel</strong></a> package to repel overlapping text labels (Figure <a href="faq.html#fig:repelTip">A.4</a>).</p>


<div class="sourceCode" id="cb275"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/slowkow/ggrepel">ggrepel</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://yulab-smu.top/treedata-book/">ggtree</a></span><span class="op">)</span>
<span class="va">raxml_file</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/system.file.html">system.file</a></span><span class="op">(</span><span class="st">"extdata/RAxML"</span>, <span class="st">"RAxML_bipartitionsBranchLabels.H3"</span>, package<span class="op">=</span><span class="st">"treeio"</span><span class="op">)</span>
<span class="va">raxml</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://docs.ropensci.org/treeio/reference/read.raxml.html">read.raxml</a></span><span class="op">(</span><span class="va">raxml_file</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/pkg/ggtree/man/ggtree.html">ggtree</a></span><span class="op">(</span><span class="va">raxml</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/pkg/ggrepel/man/geom_text_repel.html">geom_label_repel</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>label<span class="op">=</span><span class="va">bootstrap</span>, fill<span class="op">=</span><span class="va">bootstrap</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> 
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html">theme</a></span><span class="op">(</span>legend.position <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/S4Vectors/man/Vector-class.html">c</a></span><span class="op">(</span><span class="fl">.1</span>, <span class="fl">.8</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_viridis.html">scale_fill_viridis_c</a></span><span class="op">(</span><span class="op">)</span></code></pre></div>
<div class="figure">
<span style="display:block;" id="fig:repelTip"></span>
<img src="treedata_files/figure-html/repelTip-1.svg" alt="Repel labels. Repel labels to avoid overlapping." width="100%"><p class="caption">
FIGURE A.4: <strong>Repel labels.</strong> Repel labels to avoid overlapping.
</p>
</div>
</div>
<div id="faq-bootstrap" class="section level3" number="14.4.5">
<h3>
<span class="header-section-number">A.4.5</span> Bootstrap values from Newick format<a class="anchor" aria-label="anchor" href="#faq-bootstrap"><i class="fas fa-link"></i></a>
</h3>
<p>It’s quite command to store <em>bootstrap</em> value as node label in the Newick format. Visualizing node label is easy using <code>geom_text2(aes(subset = !isTip, label=label))</code>.</p>
<p>If you want to only display a subset of <em>bootstrap</em> (<em>e.g.</em> bootstrap &gt; 80), you can’t simply using <code>geom_text2(subset= (label &gt; 80), label=label)</code> (or <code>geom_label2</code>) since <code>label</code> is a character vector, which contains node label (bootstrap value) and tip label (taxa name). If we use <code>geom_text2(subset=(as.numeric(label) &gt; 80), label=label)</code>, it will also fail since <code>NAs</code> were introduced by coercion. We need to convert <code>NAs</code> to logical <code>FALSE</code>, this can be done by the following code:</p>


<div class="sourceCode" id="cb276"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">nwk</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/system.file.html">system.file</a></span><span class="op">(</span><span class="st">"extdata/RAxML"</span>,<span class="st">"RAxML_bipartitions.H3"</span>, package<span class="op">=</span><span class="st">'treeio'</span><span class="op">)</span>
<span class="va">tr</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/ape/man/read.tree.html">read.tree</a></span><span class="op">(</span><span class="va">nwk</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/pkg/ggtree/man/ggtree.html">ggtree</a></span><span class="op">(</span><span class="va">tr</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/pkg/ggtree/man/geom_label2.html">geom_label2</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>label<span class="op">=</span><span class="va">label</span>, 
      subset <span class="op">=</span> <span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html">is.na</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/numeric.html">as.numeric</a></span><span class="op">(</span><span class="va">label</span><span class="op">)</span><span class="op">)</span> <span class="op">&amp;</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html">as.numeric</a></span><span class="op">(</span><span class="va">label</span><span class="op">)</span> <span class="op">&gt;</span> <span class="fl">80</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<div class="figure">
<span style="display:block;" id="fig:nwkbs"></span>
<img src="treedata_files/figure-html/nwkbs-1.svg" alt="Bootstrap value stored in node label." width="100%"><p class="caption">
FIGURE A.5: <strong>Bootstrap value stored in node label.</strong>
</p>
</div>
<p>As this is a very common issue, we implemented a <code><a href="https://rdrr.io/pkg/phytools/man/read.newick.html">read.newick()</a></code> function in the <a href="http://bioconductor.org/packages/treeio"><strong>treeio</strong></a> package to allow parsing internal node labels as support values. So that it can be easier to display bootstrap values using the following code:</p>
<div class="sourceCode" id="cb277"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">tr</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://docs.ropensci.org/treeio/reference/read.newick.html">read.newick</a></span><span class="op">(</span><span class="va">nwk</span>, node.label<span class="op">=</span><span class="st">'support'</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/pkg/ggtree/man/ggtree.html">ggtree</a></span><span class="op">(</span><span class="va">tr</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/pkg/ggtree/man/geom_nodelab.html">geom_nodelab</a></span><span class="op">(</span>geom<span class="op">=</span><span class="st">'label'</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>label<span class="op">=</span><span class="va">support</span>, subset<span class="op">=</span><span class="va">support</span> <span class="op">&gt;</span> <span class="fl">80</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<!-- 

Another solution is converting the bootstrap value outside `ggtree`.


q <- ggtree(tr)
d <- q$data
d <- d[!d$isTip,]
d$label <- as.numeric(d$label)
d <- d[d$label > 80,]

q + geom_text(data=d, aes(label=label))

-->
</div>
</div>
<div id="branch-setting" class="section level2" number="14.5">
<h2>
<span class="header-section-number">A.5</span> Branch setting<a class="anchor" aria-label="anchor" href="#branch-setting"><i class="fas fa-link"></i></a>
</h2>
<div id="plot-the-same-tree-as-in-plot.phylo" class="section level3" number="14.5.1">
<h3>
<span class="header-section-number">A.5.1</span> Plot the same tree as in <code>plot.phylo()</code><a class="anchor" aria-label="anchor" href="#plot-the-same-tree-as-in-plot.phylo"><i class="fas fa-link"></i></a>
</h3>
<p>By default, <code><a href="https://rdrr.io/pkg/ggtree/man/ggtree.html">ggtree()</a></code> ladderizes the input tree so that the tree will appear less cluttered. This is the reason why the tree visualized by <code><a href="https://rdrr.io/pkg/ggtree/man/ggtree.html">ggtree()</a></code> is different from the one using <code><a href="https://rdrr.io/pkg/ape/man/plot.phylo.html">plot.phylo()</a></code> which displays nonladderized tree. To disable the ladderize effect, user can pass the parameter <code>ladderize = FALSE</code> to the <code><a href="https://rdrr.io/pkg/ggtree/man/ggtree.html">ggtree()</a></code> function as demonstrated in Figure <a href="faq.html#fig:ggtreeladderize">A.6</a>.</p>
<div class="sourceCode" id="cb278"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="http://ape-package.ird.fr/">ape</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://yulab-smu.top/treedata-book/">ggtree</a></span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/Random.html">set.seed</a></span><span class="op">(</span><span class="fl">42</span><span class="op">)</span>
<span class="va">x</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/ape/man/rtree.html">rtree</a></span><span class="op">(</span><span class="fl">5</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/pkg/phylobase/man/treePlot-methods.html">plot</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/pkg/ggtree/man/ggtree.html">ggtree</a></span><span class="op">(</span><span class="va">x</span>, ladderize <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/pkg/ggtree/man/geom_tiplab.html">geom_tiplab</a></span><span class="op">(</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/pkg/ggtree/man/ggtree.html">ggtree</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/pkg/ggtree/man/geom_tiplab.html">geom_tiplab</a></span><span class="op">(</span><span class="op">)</span></code></pre></div>


<div class="figure">
<span style="display:block;" id="fig:ggtreeladderize"></span>
<img src="treedata_files/figure-html/ggtreeladderize-1.svg" alt="Ladderize and nonladderize tree. plot.phylo() displays nonladderized tree (A), use ladderize = FALSE to display nonladderized tree in ggtree() (B), ggtree() displays ladderized tree by default (C)." width="100%"><p class="caption">
FIGURE A.6: <strong>Ladderize and nonladderize tree.</strong> <code><a href="https://rdrr.io/pkg/ape/man/plot.phylo.html">plot.phylo()</a></code> displays nonladderized tree (A), use <code>ladderize = FALSE</code> to display nonladderized tree in <code><a href="https://rdrr.io/pkg/ggtree/man/ggtree.html">ggtree()</a></code> (B), <code><a href="https://rdrr.io/pkg/ggtree/man/ggtree.html">ggtree()</a></code> displays ladderized tree by default (C).
</p>
</div>
</div>
<div id="specifying-the-order-of-the-tips" class="section level3" number="14.5.2">
<h3>
<span class="header-section-number">A.5.2</span> Specifying the order of the tips<a class="anchor" aria-label="anchor" href="#specifying-the-order-of-the-tips"><i class="fas fa-link"></i></a>
</h3>
<p>The <code><a href="https://rdrr.io/pkg/ape/man/rotate.html">rotateConstr()</a></code> function provided in the <a href="https://CRAN.R-project.org/package=ape"><strong>ape</strong></a> package rotates internal branches based on the specified order of the tips and the order should be followed when plotting the tree (from bottom to top). As <code><a href="https://rdrr.io/pkg/ggtree/man/ggtree.html">ggtree()</a></code> by default ladderizes the input tree, users need to disable by passing <code>ladderize = FALSE</code>. Then the order of the tree will be displayed as expected (Figure <a href="faq.html#fig:rotateConstr">A.7</a>). Users can also extract tip order that displayed by <code><a href="https://rdrr.io/pkg/ggtree/man/ggtree.html">ggtree()</a></code> using the <code><a href="https://rdrr.io/pkg/ggtree/man/get_taxa_name.html">get_taxa_name()</a></code> function as demonstrated in <a href="chapter12.html#tiporder">session 12.6</a>.</p>


<div class="sourceCode" id="cb279"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">y</span> <span class="op">&lt;-</span> <span class="fu">ape</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/ape/man/rotate.html">rotateConstr</a></span><span class="op">(</span><span class="va">x</span>, <span class="fu"><a href="https://rdrr.io/pkg/S4Vectors/man/Vector-class.html">c</a></span><span class="op">(</span><span class="st">'t4'</span>, <span class="st">'t2'</span>, <span class="st">'t5'</span>, <span class="st">'t1'</span>, <span class="st">'t3'</span><span class="op">)</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/pkg/ggtree/man/ggtree.html">ggtree</a></span><span class="op">(</span><span class="va">y</span>, ladderize <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/pkg/ggtree/man/geom_tiplab.html">geom_tiplab</a></span><span class="op">(</span><span class="op">)</span></code></pre></div>
<div class="figure">
<span style="display:block;" id="fig:rotateConstr"></span>
<img src="treedata_files/figure-html/rotateConstr-1.svg" alt="Specifying tree order. The order of the input tree will be maintained in ggtree() when ladderize = FALSE." width="100%"><p class="caption">
FIGURE A.7: <strong>Specifying tree order.</strong> The order of the input tree will be maintained in <code><a href="https://rdrr.io/pkg/ggtree/man/ggtree.html">ggtree()</a></code> when <code>ladderize = FALSE</code>.
</p>
</div>
</div>
<div id="shrink-outlier-long-branch" class="section level3" number="14.5.3">
<h3>
<span class="header-section-number">A.5.3</span> Shrink outlier long branch<a class="anchor" aria-label="anchor" href="#shrink-outlier-long-branch"><i class="fas fa-link"></i></a>
</h3>
<p>When outgroups are on a very long branch length (Figure <a href="faq.html#fig:outgroupEdge">A.8</a>A), we would like to keep the outgroups in the tree but ignore their branch lengths (Figure <a href="faq.html#fig:outgroupEdge">A.8</a>B)<a class="footnote-ref" tabindex="0" data-toggle="popover" data-content='&lt;p&gt;example from: &lt;a href="https://groups.google.com/d/msg/bioc-ggtree/T2ySvqv351g/mHsyljvBCwAJ" class="uri"&gt;https://groups.google.com/d/msg/bioc-ggtree/T2ySvqv351g/mHsyljvBCwAJ&lt;/a&gt;&lt;/p&gt;'><sup>21</sup></a>. This can be easily done by modifying the coordinations of the outgroups (Figure <a href="faq.html#fig:outgroupEdge">A.8</a>B). Another approach is to truncate the plot using the <a href="https://CRAN.R-project.org/package=ggbreak"><strong>ggbreak</strong></a> package (Figure <a href="faq.html#fig:outgroupEdge">A.8</a>C).</p>


<div class="sourceCode" id="cb280"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/YuLab-SMU/TDBook">TDbook</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://yulab-smu.top/treedata-book/">ggtree</a></span><span class="op">)</span>

<span class="va">x</span> <span class="op">&lt;-</span> <span class="va">tree_long_branch_example</span>
<span class="va">m</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/tidytree/man/MRCA.html">MRCA</a></span><span class="op">(</span><span class="va">x</span>, <span class="fl">75</span>, <span class="fl">76</span><span class="op">)</span>
<span class="va">y</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/tidytree/man/groupClade.html">groupClade</a></span><span class="op">(</span><span class="va">x</span>, <span class="va">m</span><span class="op">)</span>

<span class="co">## A</span>
<span class="va">p</span> <span class="op">&lt;-</span> <span class="va">p1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/ggtree/man/ggtree.html">ggtree</a></span><span class="op">(</span><span class="va">y</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>linetype <span class="op">=</span> <span class="va">group</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> 
  <span class="fu"><a href="https://rdrr.io/pkg/ggtree/man/geom_tiplab.html">geom_tiplab</a></span><span class="op">(</span>size <span class="op">=</span> <span class="fl">2</span><span class="op">)</span> <span class="op">+</span> 
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html">theme</a></span><span class="op">(</span>legend.position <span class="op">=</span> <span class="st">'none'</span><span class="op">)</span> 

<span class="co">## B</span>
<span class="va">p</span><span class="op">$</span><span class="va">data</span><span class="op">[</span><span class="va">p</span><span class="op">$</span><span class="va">data</span><span class="op">$</span><span class="va">node</span> <span class="op"><a href="https://rdrr.io/pkg/BiocGenerics/man/match.html">%in%</a></span> <span class="fu"><a href="https://rdrr.io/pkg/S4Vectors/man/Vector-class.html">c</a></span><span class="op">(</span><span class="fl">75</span>, <span class="fl">76</span><span class="op">)</span>, <span class="st">"x"</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/BiocGenerics/man/mean.html">mean</a></span><span class="op">(</span><span class="va">p</span><span class="op">$</span><span class="va">data</span><span class="op">$</span><span class="va">x</span><span class="op">)</span>

<span class="co">## C</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/YuLab-SMU/ggbreak">ggbreak</a></span><span class="op">)</span>
<span class="va">p2</span> <span class="op">&lt;-</span> <span class="va">p1</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/pkg/ggbreak/man/scale_break.html">scale_x_break</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/S4Vectors/man/Vector-class.html">c</a></span><span class="op">(</span><span class="fl">0.03</span>, <span class="fl">0.09</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/pkg/ggtree/man/ggexpand.html">hexpand</a></span><span class="op">(</span><span class="fl">.05</span><span class="op">)</span>

<span class="co">## align plot</span>
<span class="fu"><a href="https://rdrr.io/pkg/aplot/man/plot_list.html">plot_list</a></span><span class="op">(</span><span class="va">p1</span>, <span class="va">p</span>, <span class="va">p2</span>, ncol<span class="op">=</span><span class="fl">3</span>, tag_levels<span class="op">=</span><span class="st">"A"</span><span class="op">)</span></code></pre></div>
<div class="figure">
<span style="display:block;" id="fig:outgroupEdge"></span>
<img src="treedata_files/figure-html/outgroupEdge-1.png" alt="Shrink outlier long branch. Original tree (A); reduced outgroup branch length (B); truncated tree plot (C)." width="100%"><p class="caption">
FIGURE A.8: <strong>Shrink outlier long branch.</strong> Original tree (A); reduced outgroup branch length (B); truncated tree plot (C).
</p>
</div>
</div>
<div id="bind-tip" class="section level3" number="14.5.4">
<h3>
<span class="header-section-number">A.5.4</span> Attach a new tip to a tree<a class="anchor" aria-label="anchor" href="#bind-tip"><i class="fas fa-link"></i></a>
</h3>
<p>Sometimes there are known branches that are not in the tree, and we would like to have them on the tree. Another scenario is that we have a new sequence species and would like to update the reference tree with this species by inferring its evolutionary position.</p>
<p>Users can use <code><a href="https://rdrr.io/pkg/phytools/man/bind.tip.html">phytools::bind.tip()</a></code> <span class="citation">(<a href="references.html#ref-revell_phytools_2012" role="doc-biblioref">Revell 2012</a>)</span> to attach a new tip to a tree. With <a href="https://CRAN.R-project.org/package=tidytree"><strong>tidytree</strong></a>, it is easy to add an annotation to differentiate newly introduced and original branches and to reflect the uncertainty of the added branch splits off as demonstrated in Figure <a href="faq.html#fig:bindTip">A.9</a>.</p>


<div class="sourceCode" id="cb281"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/liamrevell/phytools">phytools</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://yulab-smu.top/treedata-book/">tidytree</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://ggplot2.tidyverse.org">ggplot2</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://yulab-smu.top/treedata-book/">ggtree</a></span><span class="op">)</span>

<span class="fu"><a href="https://rdrr.io/r/base/Random.html">set.seed</a></span><span class="op">(</span><span class="fl">2019</span><span class="op">-</span><span class="fl">11</span><span class="op">-</span><span class="fl">18</span><span class="op">)</span>
<span class="va">tr</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/ape/man/rtree.html">rtree</a></span><span class="op">(</span><span class="fl">5</span><span class="op">)</span>

<span class="va">tr2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/phytools/man/bind.tip.html">bind.tip</a></span><span class="op">(</span><span class="va">tr</span>, <span class="st">'U'</span>, edge.length <span class="op">=</span> <span class="fl">0.1</span>, where <span class="op">=</span> <span class="fl">7</span>, position<span class="op">=</span><span class="fl">0.15</span><span class="op">)</span>
<span class="va">d</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://tibble.tidyverse.org/reference/as_tibble.html">as_tibble</a></span><span class="op">(</span><span class="va">tr2</span><span class="op">)</span>
<span class="va">d</span><span class="op">$</span><span class="va">type</span> <span class="op">&lt;-</span> <span class="st">"original"</span>
<span class="va">d</span><span class="op">$</span><span class="va">type</span><span class="op">[</span><span class="va">d</span><span class="op">$</span><span class="va">label</span> <span class="op">==</span> <span class="st">'U'</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="st">'newly introduce'</span>
<span class="va">d</span><span class="op">$</span><span class="va">sd</span> <span class="op">&lt;-</span> <span class="cn">NA</span>
<span class="va">d</span><span class="op">$</span><span class="va">sd</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/pkg/tidytree/man/parent.html">parent</a></span><span class="op">(</span><span class="va">d</span>, <span class="st">'U'</span><span class="op">)</span><span class="op">$</span><span class="va">node</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fl">0.05</span>

<span class="va">tr3</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/tidytree/man/as.treedata.html">as.treedata</a></span><span class="op">(</span><span class="va">d</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/pkg/ggtree/man/ggtree.html">ggtree</a></span><span class="op">(</span><span class="va">tr3</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>linetype<span class="op">=</span><span class="va">type</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>  <span class="fu"><a href="https://rdrr.io/pkg/ggtree/man/geom_tiplab.html">geom_tiplab</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_errorbarh.html">geom_errorbarh</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>xmin<span class="op">=</span><span class="va">x</span><span class="op">-</span><span class="va">sd</span>, xmax<span class="op">=</span><span class="va">x</span><span class="op">+</span><span class="va">sd</span>, y <span class="op">=</span> <span class="va">y</span> <span class="op">-</span> <span class="fl">0.3</span><span class="op">)</span>, 
                linetype<span class="op">=</span><span class="st">'dashed'</span>, height<span class="op">=</span><span class="fl">0.1</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_manual.html">scale_linetype_manual</a></span><span class="op">(</span>values <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/S4Vectors/man/Vector-class.html">c</a></span><span class="op">(</span><span class="st">"newly introduce"</span> <span class="op">=</span> <span class="st">"dashed"</span>, 
                                   <span class="st">"original"</span> <span class="op">=</span> <span class="st">"solid"</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> 
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html">theme</a></span><span class="op">(</span>legend.position<span class="op">=</span><span class="fu"><a href="https://rdrr.io/pkg/S4Vectors/man/Vector-class.html">c</a></span><span class="op">(</span><span class="fl">.8</span>, <span class="fl">.2</span><span class="op">)</span><span class="op">)</span> </code></pre></div>
<div class="figure">
<span style="display:block;" id="fig:bindTip"></span>
<img src="treedata_files/figure-html/bindTip-1.svg" alt="Attaching a new tip to a tree. Different line types were employed to distinguish the newly introduce tip and an error bar was added to indicate the uncertainty of the added branch position." width="100%"><p class="caption">
FIGURE A.9: <strong>Attaching a new tip to a tree.</strong> Different line types were employed to distinguish the newly introduce tip and an error bar was added to indicate the uncertainty of the added branch position.
</p>
</div>
</div>
<div id="change-colors-or-line-types-of-arbitrarily-selected-branches" class="section level3" number="14.5.5">
<h3>
<span class="header-section-number">A.5.5</span> Change colors or line types of arbitrarily selected branches<a class="anchor" aria-label="anchor" href="#change-colors-or-line-types-of-arbitrarily-selected-branches"><i class="fas fa-link"></i></a>
</h3>
<p>If you want to color or change line types of specific branches, you only need to prepare a data frame with variables of branch setting (e.g. selected and unselected).</p>


<div class="sourceCode" id="cb282"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/Random.html">set.seed</a></span><span class="op">(</span><span class="fl">123</span><span class="op">)</span>
<span class="va">x</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/ape/man/rtree.html">rtree</a></span><span class="op">(</span><span class="fl">10</span><span class="op">)</span>
<span class="co">## binary choices of colors</span>
<span class="va">d</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span>node<span class="op">=</span><span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://docs.ropensci.org/treeio/reference/getNodeNum.html">Nnode2</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span>, colour <span class="op">=</span> <span class="st">'black'</span><span class="op">)</span>
<span class="va">d</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/pkg/S4Vectors/man/Vector-class.html">c</a></span><span class="op">(</span><span class="fl">2</span>,<span class="fl">3</span>,<span class="fl">14</span>,<span class="fl">15</span><span class="op">)</span>, <span class="fl">2</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="st">"red"</span>

<span class="co">## multiple choices of line types</span>
<span class="va">d2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span>node<span class="op">=</span><span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://docs.ropensci.org/treeio/reference/getNodeNum.html">Nnode2</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span>, lty <span class="op">=</span> <span class="fl">1</span><span class="op">)</span>
<span class="va">d2</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/pkg/S4Vectors/man/Vector-class.html">c</a></span><span class="op">(</span><span class="fl">2</span>,<span class="fl">5</span>,<span class="fl">13</span>, <span class="fl">14</span><span class="op">)</span>, <span class="fl">2</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/S4Vectors/man/Vector-class.html">c</a></span><span class="op">(</span><span class="fl">2</span>, <span class="fl">3</span>, <span class="fl">2</span>,<span class="fl">4</span><span class="op">)</span>

<span class="va">p</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/ggtree/man/ggtree.html">ggtree</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_text.html">geom_label</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>label<span class="op">=</span><span class="va">node</span><span class="op">)</span><span class="op">)</span>
<span class="va">p</span> <span class="op"><a href="https://rdrr.io/pkg/ggtree/man/attacher.html">%&lt;+%</a></span> <span class="va">d</span> <span class="op"><a href="https://rdrr.io/pkg/ggtree/man/attacher.html">%&lt;+%</a></span> <span class="va">d2</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>colour<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/AsIs.html">I</a></span><span class="op">(</span><span class="va">colour</span><span class="op">)</span>, linetype<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/AsIs.html">I</a></span><span class="op">(</span><span class="va">lty</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<div class="figure">
<span style="display:block;" id="fig:btype"></span>
<img src="treedata_files/figure-html/btype-1.svg" alt="Change colors and line types of specific branches." width="100%"><p class="caption">
FIGURE A.10: <strong>Change colors and line types of specific branches.</strong>
</p>
</div>
<p>Users can use the <a href="https://CRAN.R-project.org/package=gginnards"><strong>gginnards</strong></a> package to manipulate plot elements for more complicated scenarios.</p>
</div>
<div id="arbitrary-point" class="section level3" number="14.5.6">
<h3>
<span class="header-section-number">A.5.6</span> Add an arbitrary point to a branch<a class="anchor" aria-label="anchor" href="#arbitrary-point"><i class="fas fa-link"></i></a>
</h3>
<p>If you want to add an arbitrary point to a branch<a class="footnote-ref" tabindex="0" data-toggle="popover" data-content='&lt;p&gt;&lt;a href="https://twitter.com/melanoidin/status/1262703932993871874" class="uri"&gt;https://twitter.com/melanoidin/status/1262703932993871874&lt;/a&gt;&lt;/p&gt;'><sup>22</sup></a>, you can use <code><a href="https://rdrr.io/pkg/ggtree/man/geom_nodepoint.html">geom_nodepoint()</a></code>, <code><a href="https://rdrr.io/pkg/ggtree/man/geom_tippoint.html">geom_tippoint()</a></code>, or <code><a href="https://rdrr.io/pkg/ggtree/man/geom_point2.html">geom_point2()</a></code> (works for both external and internal nodes) to filter selected node (the endpoint of the branch) via the <code>subset</code> aesthetic mapping and specify horizontal position by <code>x = x - offset</code> aesthetic mapping, where the offset can be an absolute value (Figure <a href="faq.html#fig:pointOnBranch">A.11</a>A) or proportion to the branch length (Figure <a href="faq.html#fig:pointOnBranch">A.11</a>B).</p>


<div class="sourceCode" id="cb283"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/Random.html">set.seed</a></span><span class="op">(</span><span class="fl">2020</span><span class="op">-</span><span class="fl">05</span><span class="op">-</span><span class="fl">20</span><span class="op">)</span>
<span class="va">x</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/ape/man/rtree.html">rtree</a></span><span class="op">(</span><span class="fl">10</span><span class="op">)</span>
<span class="va">p</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/ggtree/man/ggtree.html">ggtree</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span>

<span class="va">p1</span> <span class="op">&lt;-</span> <span class="va">p</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/pkg/ggtree/man/geom_nodepoint.html">geom_nodepoint</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>subset <span class="op">=</span> <span class="va">node</span> <span class="op">==</span> <span class="fl">13</span>, x <span class="op">=</span> <span class="va">x</span> <span class="op">-</span> <span class="fl">.1</span><span class="op">)</span>,
                        size <span class="op">=</span> <span class="fl">5</span>, colour <span class="op">=</span> <span class="st">'firebrick'</span>, shape <span class="op">=</span> <span class="fl">21</span><span class="op">)</span>

<span class="va">p2</span> <span class="op">&lt;-</span> <span class="va">p</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/pkg/ggtree/man/geom_nodepoint.html">geom_nodepoint</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>subset <span class="op">=</span> <span class="va">node</span> <span class="op">==</span> <span class="fl">13</span>, x <span class="op">=</span> <span class="va">x</span> <span class="op">-</span> <span class="va">branch.length</span> <span class="op">*</span> <span class="fl">0.2</span><span class="op">)</span>,
                        size <span class="op">=</span> <span class="fl">3</span>, colour <span class="op">=</span> <span class="st">'firebrick'</span><span class="op">)</span> <span class="op">+</span> 
       <span class="fu"><a href="https://rdrr.io/pkg/ggtree/man/geom_nodepoint.html">geom_nodepoint</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>subset <span class="op">=</span> <span class="va">node</span> <span class="op">==</span> <span class="fl">13</span>, x <span class="op">=</span> <span class="va">x</span> <span class="op">-</span> <span class="va">branch.length</span> <span class="op">*</span> <span class="fl">0.8</span><span class="op">)</span>,
                        size <span class="op">=</span> <span class="fl">5</span>, colour <span class="op">=</span> <span class="st">'steelblue'</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/pkg/aplot/man/plot_list.html">plot_list</a></span><span class="op">(</span><span class="va">p1</span>, <span class="va">p2</span>, ncol<span class="op">=</span><span class="fl">2</span>, tag_levels<span class="op">=</span><span class="st">"A"</span><span class="op">)</span></code></pre></div>
<div class="figure">
<span style="display:block;" id="fig:pointOnBranch"></span>
<img src="treedata_files/figure-html/pointOnBranch-1.svg" alt="Add an arbitrary point on a branch. Position of the symbolic point can be adjusted by an absolute value (A) or proportion to the branch length (B)." width="100%"><p class="caption">
FIGURE A.11: <strong>Add an arbitrary point on a branch.</strong> Position of the symbolic point can be adjusted by an absolute value (A) or proportion to the branch length (B).
</p>
</div>
</div>
</div>
<div id="different-x-axis-labels-for-different-facet-panels" class="section level2" number="14.6">
<h2>
<span class="header-section-number">A.6</span> Different x-axis labels for different facet panels<a class="anchor" aria-label="anchor" href="#different-x-axis-labels-for-different-facet-panels"><i class="fas fa-link"></i></a>
</h2>
<p>This is not supported by <a href="https://CRAN.R-project.org/package=ggplot2"><strong>ggplot2</strong></a> in general. However, we can just draw text labels for each panel and put the labels beyond the plot panels as demonstrated in Figure <a href="faq.html#fig:xlabFacets">A.12</a>.</p>


<div class="sourceCode" id="cb284"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://yulab-smu.top/treedata-book/">ggtree</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://ggplot2.tidyverse.org">ggplot2</a></span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/Random.html">set.seed</a></span><span class="op">(</span><span class="fl">2019</span><span class="op">-</span><span class="fl">05</span><span class="op">-</span><span class="fl">02</span><span class="op">)</span>
<span class="va">x</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/ape/man/rtree.html">rtree</a></span><span class="op">(</span><span class="fl">30</span><span class="op">)</span>
<span class="va">p</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/ggtree/man/ggtree.html">ggtree</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/pkg/ggtree/man/geom_tiplab.html">geom_tiplab</a></span><span class="op">(</span><span class="op">)</span>
<span class="va">d</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span>label <span class="op">=</span> <span class="va">x</span><span class="op">$</span><span class="va">tip.label</span>, 
                value <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html">rnorm</a></span><span class="op">(</span><span class="fl">30</span><span class="op">)</span><span class="op">)</span>
<span class="va">p2</span> <span class="op">&lt;-</span> <span class="va">p</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/pkg/ggtree/man/facet-plot.html">geom_facet</a></span><span class="op">(</span>panel <span class="op">=</span> <span class="st">"Dot"</span>, data <span class="op">=</span> <span class="va">d</span>, 
            geom <span class="op">=</span> <span class="va">geom_point</span>, mapping <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">value</span><span class="op">)</span><span class="op">)</span> 
            
<span class="va">p2</span> <span class="op">&lt;-</span> <span class="va">p2</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html">theme_bw</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span> 
    <span class="fu"><a href="https://rdrr.io/pkg/ggtree/man/xlim_tree.html">xlim_tree</a></span><span class="op">(</span><span class="fl">5</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/pkg/ggtree/man/xlim_expand.html">xlim_expand</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/S4Vectors/man/Vector-class.html">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">5</span>, <span class="fl">5</span><span class="op">)</span>, <span class="st">'Dot'</span><span class="op">)</span> 

<span class="co"># .panel is the internal variable use in `geom_facet` for faceting.</span>
<span class="va">d</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span>.panel <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/S4Vectors/man/Vector-class.html">c</a></span><span class="op">(</span><span class="st">'Tree'</span>, <span class="st">'Dot'</span><span class="op">)</span>, 
                lab <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/S4Vectors/man/Vector-class.html">c</a></span><span class="op">(</span><span class="st">"Distance"</span>, <span class="st">"Dot Units"</span><span class="op">)</span>, 
                x<span class="op">=</span><span class="fu"><a href="https://rdrr.io/pkg/S4Vectors/man/Vector-class.html">c</a></span><span class="op">(</span><span class="fl">2.5</span>,<span class="fl">0</span><span class="op">)</span>, y<span class="op">=</span><span class="op">-</span><span class="fl">2</span><span class="op">)</span>

<span class="va">p2</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_continuous.html">scale_y_continuous</a></span><span class="op">(</span>limits<span class="op">=</span><span class="fu"><a href="https://rdrr.io/pkg/S4Vectors/man/Vector-class.html">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">31</span><span class="op">)</span>, 
                        expand<span class="op">=</span><span class="fu"><a href="https://rdrr.io/pkg/S4Vectors/man/Vector-class.html">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">0</span><span class="op">)</span>, 
                        oob<span class="op">=</span><span class="kw">function</span><span class="op">(</span><span class="va">x</span>, <span class="va">...</span><span class="op">)</span> <span class="va">x</span><span class="op">)</span> <span class="op">+</span>
    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_text.html">geom_text</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>label<span class="op">=</span><span class="va">lab</span><span class="op">)</span>, data<span class="op">=</span><span class="va">d</span><span class="op">)</span> <span class="op">+</span> 
    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/coord_cartesian.html">coord_cartesian</a></span><span class="op">(</span>clip<span class="op">=</span><span class="st">'off'</span><span class="op">)</span>  <span class="op">+</span> 
    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html">theme</a></span><span class="op">(</span>plot.margin<span class="op">=</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">margin</a></span><span class="op">(</span><span class="fl">6</span>, <span class="fl">6</span>, <span class="fl">40</span>, <span class="fl">6</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<div class="figure">
<span style="display:block;" id="fig:xlabFacets"></span>
<img src="treedata_files/figure-html/xlabFacets-1.svg" alt="X-axis titles for different facet panels." width="100%"><p class="caption">
FIGURE A.12: <strong>X-axis titles for different facet panels.</strong>
</p>
</div>
</div>
<div id="faq-under-the-tree" class="section level2" number="14.7">
<h2>
<span class="header-section-number">A.7</span> Plot something behind the phylogeny<a class="anchor" aria-label="anchor" href="#faq-under-the-tree"><i class="fas fa-link"></i></a>
</h2>
<p>The <code><a href="https://rdrr.io/pkg/ggtree/man/ggtree.html">ggtree()</a></code> function plot the tree structure and normally we add layers on top of the tree.</p>
<div class="sourceCode" id="cb285"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/Random.html">set.seed</a></span><span class="op">(</span><span class="fl">1982</span><span class="op">)</span>
<span class="va">x</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/ape/man/rtree.html">rtree</a></span><span class="op">(</span><span class="fl">5</span><span class="op">)</span>
<span class="va">p</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/ggtree/man/ggtree.html">ggtree</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/pkg/ggtree/man/geom-hilight.html">geom_hilight</a></span><span class="op">(</span>node<span class="op">=</span><span class="fl">7</span>, alpha<span class="op">=</span><span class="fl">1</span><span class="op">)</span></code></pre></div>
<p>If we want the layers behind the tree layer, we can reverse the order of all the layers.</p>
<div class="sourceCode" id="cb286"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">p</span><span class="op">$</span><span class="va">layers</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/S4Vectors/man/Vector-class.html">rev</a></span><span class="op">(</span><span class="va">p</span><span class="op">$</span><span class="va">layers</span><span class="op">)</span></code></pre></div>
<p>Another solution is to use <code><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot()</a></code> instead of <code><a href="https://rdrr.io/pkg/ggtree/man/ggtree.html">ggtree()</a></code> and <code>+ geom_tree()</code> to add the layer of tree structure at the correct position of the layer stack.</p>
<div class="sourceCode" id="cb287"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/pkg/ggtree/man/geom-hilight.html">geom_hilight</a></span><span class="op">(</span>node<span class="op">=</span><span class="fl">7</span>, alpha<span class="op">=</span><span class="fl">1</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/pkg/ggtree/man/geom_tree.html">geom_tree</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/pkg/ggtree/man/theme_tree.html">theme_tree</a></span><span class="op">(</span><span class="op">)</span>     </code></pre></div>


<div class="figure">
<span style="display:block;" id="fig:treeLayerOrder"></span>
<img src="treedata_files/figure-html/treeLayerOrder-1.svg" alt="Add layers behind the tree structure. A layer on top of the tree structure (A). Reverse layer order of A (B). Add layer behind the tree layer (C)." width="100%"><p class="caption">
FIGURE A.13: <strong>Add layers behind the tree structure.</strong> A layer on top of the tree structure (A). Reverse layer order of A (B). Add layer behind the tree layer (C).
</p>
</div>
</div>
<div id="faq-enlarge-center-space" class="section level2" number="14.8">
<h2>
<span class="header-section-number">A.8</span> Enlarge center space in circular/fan layout tree<a class="anchor" aria-label="anchor" href="#faq-enlarge-center-space"><i class="fas fa-link"></i></a>
</h2>
<p>This question was asked several times<a class="footnote-ref" tabindex="0" data-toggle="popover" data-content='&lt;p&gt;&lt;a href="https://groups.google.com/d/msg/bioc-ggtree/gruC4FztU8I/mwavqWCXAQAJ" class="uri"&gt;https://groups.google.com/d/msg/bioc-ggtree/gruC4FztU8I/mwavqWCXAQAJ&lt;/a&gt;, &lt;a href="https://groups.google.com/d/msg/bioc-ggtree/UoGQekWHIvw/ZswUUZKSGwAJ" class="uri"&gt;https://groups.google.com/d/msg/bioc-ggtree/UoGQekWHIvw/ZswUUZKSGwAJ&lt;/a&gt; and &lt;a href="https://github.com/GuangchuangYu/ggtree/issues/95" class="uri"&gt;https://github.com/GuangchuangYu/ggtree/issues/95&lt;/a&gt;&lt;/p&gt;'><sup>23</sup></a>, and a published example can be found in <span class="citation">(<a href="references.html#ref-barton_broad_2016" role="doc-biblioref">Barton et al. 2016</a>)</span>. Increasing the percentage of center white space in a circular tree is useful to avoid overlapping tip labels and to increase the readability of the tree by moving all nodes and branches further out. This can be done simply by using <code><a href="https://ggplot2.tidyverse.org/reference/lims.html">xlim()</a></code> or <code><a href="https://rdrr.io/pkg/ggtree/man/ggexpand.html">hexpand()</a></code> to allocate more space, just like in Figure <a href="chapter4.html#fig:layout2">4.3</a>G, or assign a long root branch that is similar to the “Root Length” parameter in <a href="http://beast.community/figtree"><strong>FigTree</strong></a>.</p>


<div class="sourceCode" id="cb288"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/Random.html">set.seed</a></span><span class="op">(</span><span class="fl">1982</span><span class="op">)</span>
<span class="va">tree</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/ape/man/rtree.html">rtree</a></span><span class="op">(</span><span class="fl">30</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/pkg/aplot/man/plot_list.html">plot_list</a></span><span class="op">(</span>
  <span class="fu"><a href="https://rdrr.io/pkg/ggtree/man/ggtree.html">ggtree</a></span><span class="op">(</span><span class="va">tree</span>, layout<span class="op">=</span><span class="st">'circular'</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/lims.html">xlim</a></span><span class="op">(</span><span class="op">-</span><span class="fl">10</span>, <span class="cn">NA</span><span class="op">)</span>,
  <span class="fu"><a href="https://rdrr.io/pkg/ggtree/man/ggtree.html">ggtree</a></span><span class="op">(</span><span class="va">tree</span>, layout<span class="op">=</span><span class="st">'circular'</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/pkg/ggtree/man/geom_rootedge.html">geom_rootedge</a></span><span class="op">(</span><span class="fl">5</span><span class="op">)</span>,
  tag_levels <span class="op">=</span> <span class="st">"A"</span>, ncol<span class="op">=</span><span class="fl">2</span>
<span class="op">)</span></code></pre></div>
<div class="figure">
<span style="display:block;" id="fig:circular-space"></span>
<img src="treedata_files/figure-html/circular-space-1.svg" alt="Enlarge center space in circular tree. Allocate more space by xlim (A) or long root branch (B)." width="100%"><p class="caption">
FIGURE A.14: <strong>Enlarge center space in circular tree.</strong> Allocate more space by <code>xlim</code> (A) or long root branch (B).
</p>
</div>
</div>
<div id="use-the-most-distant-tip-from-the-root-as-the-origin-of-the-time-scale" class="section level2" number="14.9">
<h2>
<span class="header-section-number">A.9</span> Use the most distant tip from the root as the origin of the time scale<a class="anchor" aria-label="anchor" href="#use-the-most-distant-tip-from-the-root-as-the-origin-of-the-time-scale"><i class="fas fa-link"></i></a>
</h2>
<p>The <code><a href="https://rdrr.io/pkg/ggtree/man/revts.html">revts()</a></code> will reverse the x-axis by setting the most recent tip to 0. We can use <code>scale_x_continuous(labels=abs)</code> to label x-axis using absolute values.</p>


<div class="sourceCode" id="cb289"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">tr</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/ape/man/rtree.html">rtree</a></span><span class="op">(</span><span class="fl">10</span><span class="op">)</span>
<span class="va">p</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/ggtree/man/ggtree.html">ggtree</a></span><span class="op">(</span><span class="va">tr</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/pkg/ggtree/man/theme_tree2.html">theme_tree2</a></span><span class="op">(</span><span class="op">)</span>
<span class="va">p2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/ggtree/man/revts.html">revts</a></span><span class="op">(</span><span class="va">p</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_continuous.html">scale_x_continuous</a></span><span class="op">(</span>labels<span class="op">=</span><span class="va">abs</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/pkg/aplot/man/plot_list.html">plot_list</a></span><span class="op">(</span><span class="va">p</span>, <span class="va">p2</span>, ncol<span class="op">=</span><span class="fl">2</span>, tag_levels<span class="op">=</span><span class="st">"A"</span><span class="op">)</span></code></pre></div>
<div class="figure">
<span style="display:block;" id="fig:distantTip"></span>
<img src="treedata_files/figure-html/distantTip-1.svg" alt="Origin of the time scale. Forward: from the root to tips (A). Backward: from the most distant tip to the root (B)." width="100%"><p class="caption">
FIGURE A.15: <strong>Origin of the time scale.</strong> Forward: from the root to tips (A). Backward: from the most distant tip to the root (B).
</p>
</div>
</div>
<div id="circular-blank" class="section level2" number="14.10">
<h2>
<span class="header-section-number">A.10</span> Remove blank margins for circular layout tree<a class="anchor" aria-label="anchor" href="#circular-blank"><i class="fas fa-link"></i></a>
</h2>
<p>For plots in polar coordinates, such as a circular layout tree, it is very common that extra spaces will be generated.</p>
<p>If you are using <code>Rmarkdown</code>, you can set the following options for <a href="https://CRAN.R-project.org/package=knitr"><strong>knitr</strong></a> to remove extra white space automatically.</p>
<div class="sourceCode" id="cb290"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://yihui.org/knitr/">knitr</a></span><span class="op">)</span>
<span class="va">knit_hooks</span><span class="op">$</span><span class="fu">set</span><span class="op">(</span>crop <span class="op">=</span> <span class="va">hook_pdfcrop</span><span class="op">)</span>
<span class="va">opts_chunk</span><span class="op">$</span><span class="fu">set</span><span class="op">(</span>crop <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></code></pre></div>
<p>Otherwise, we can use command-line tools to remove extra white space:</p>
<pre class="shell"><code>## for pdf
pdfcrop x.pdf

## for png
convert -trim x.png x-crop.png</code></pre>
<p>If you want to do it in R, you can use the <a href="https://CRAN.R-project.org/package=magick"><strong>magick</strong></a> package:</p>
<div class="sourceCode" id="cb292"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://docs.ropensci.org/magick/">magick</a></span><span class="op">)</span>

<span class="va">x</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://docs.ropensci.org/magick/reference/editing.html">image_read</a></span><span class="op">(</span><span class="st">"x.png"</span><span class="op">)</span>
<span class="co">## x &lt;- image_read_pdf("x.pdf") # for PDF</span>

<span class="fu"><a href="https://docs.ropensci.org/magick/reference/transform.html">image_trim</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span></code></pre></div>
<p>Here is an example:</p>


<div class="sourceCode" id="cb293"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://ggplot2.tidyverse.org">ggplot2</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://yulab-smu.top/treedata-book/">ggtree</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://patchwork.data-imaginist.com">patchwork</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://docs.ropensci.org/magick/">magick</a></span><span class="op">)</span>

<span class="fu"><a href="https://rdrr.io/r/base/Random.html">set.seed</a></span><span class="op">(</span><span class="fl">2021</span><span class="op">)</span>
<span class="va">tr</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/ape/man/rtree.html">rtree</a></span><span class="op">(</span><span class="fl">30</span><span class="op">)</span>
<span class="va">p</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/ggtree/man/ggtree.html">ggtree</a></span><span class="op">(</span><span class="va">tr</span>, size<span class="op">=</span><span class="fl">1</span>, colour<span class="op">=</span><span class="st">"purple"</span>, layout<span class="op">=</span><span class="st">'circular'</span><span class="op">)</span>

<span class="va">f</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/tempfile.html">tempfile</a></span><span class="op">(</span>fileext<span class="op">=</span><span class="st">".png"</span><span class="op">)</span>
<span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggsave.html">ggsave</a></span><span class="op">(</span>filename <span class="op">=</span> <span class="va">f</span>, plot <span class="op">=</span> <span class="va">p</span>, width<span class="op">=</span><span class="fl">7</span>, height<span class="op">=</span><span class="fl">7</span><span class="op">)</span>

<span class="va">x</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://docs.ropensci.org/magick/reference/editing.html">image_read</a></span><span class="op">(</span><span class="va">f</span>, density<span class="op">=</span><span class="fl">300</span><span class="op">)</span>
<span class="va">y</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://docs.ropensci.org/magick/reference/transform.html">image_trim</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span>

<span class="va">panel_border</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html">theme</a></span><span class="op">(</span>panel.border<span class="op">=</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_rect</a></span><span class="op">(</span>colour<span class="op">=</span><span class="st">'black'</span>, fill<span class="op">=</span><span class="cn">NA</span>, size<span class="op">=</span><span class="fl">2</span><span class="op">)</span><span class="op">)</span>
<span class="va">xx</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://docs.ropensci.org/magick/reference/image_ggplot.html">image_ggplot</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="op">+</span> <span class="va">panel_border</span>
<span class="va">yy</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://docs.ropensci.org/magick/reference/image_ggplot.html">image_ggplot</a></span><span class="op">(</span><span class="va">y</span><span class="op">)</span> <span class="op">+</span> <span class="va">panel_border</span>

<span class="fu"><a href="https://rdrr.io/pkg/aplot/man/plot_list.html">plot_list</a></span><span class="op">(</span><span class="va">xx</span>, <span class="va">yy</span>, tag_levels <span class="op">=</span> <span class="st">"A"</span>, ncol<span class="op">=</span><span class="fl">2</span><span class="op">)</span></code></pre></div>
<div class="figure">
<span style="display:block;" id="fig:trimSpace"></span>
<img src="treedata_files/figure-html/trimSpace-1.svg" alt="Trim extra white space for polar coordinates. Original plot (A). Trim version (B)." width="100%"><p class="caption">
FIGURE A.16: <strong>Trim extra white space for polar coordinates.</strong> Original plot (A). Trim version (B).
</p>
</div>
</div>
<div id="export-edit" class="section level2" number="14.11">
<h2>
<span class="header-section-number">A.11</span> Edit tree graphic details<a class="anchor" aria-label="anchor" href="#export-edit"><i class="fas fa-link"></i></a>
</h2>
<p>It can be hard to modify plot details for ordinary users using <a href="https://CRAN.R-project.org/package=ggplot2"><strong>ggplot2</strong></a>/<a href="http://bioconductor.org/packages/ggtree"><strong>ggtree</strong></a>. We recommend using the <a href="https://CRAN.R-project.org/package=eoffice"><strong>eoffice</strong></a> package to export <a href="http://bioconductor.org/packages/ggtree"><strong>ggtree</strong></a> output to ‘Microsoft Office’ Document and edit the tree graphic in ‘PowerPoint.’</p>

<div style="page-break-after: always;"></div>
</div>
</div>

  <div class="chapter-nav">
<div class="prev"><a href="chapter13.html"><span class="header-section-number">13</span> Gallery of reproducible examples</a></div>
<div class="next"><a href="related-tools.html"><span class="header-section-number">B</span> Related tools</a></div>
</div></main><div class="col-md-3 col-lg-2 d-none d-md-block sidebar sidebar-chapter">
    <nav id="toc" data-toggle="toc" aria-label="On this page"><h2>On this page</h2>
      <ul class="nav navbar-nav">
<li><a class="nav-link" href="#faq"><span class="header-section-number">A</span> Frequently asked questions</a></li>
<li><a class="nav-link" href="#installation"><span class="header-section-number">A.1</span> Installation</a></li>
<li>
<a class="nav-link" href="#faq-r"><span class="header-section-number">A.2</span> Basic R related</a><ul class="nav navbar-nav"><li><a class="nav-link" href="#faq-local-file"><span class="header-section-number">A.2.1</span> Use your local file</a></li></ul>
</li>
<li>
<a class="nav-link" href="#faq-aes-mapping"><span class="header-section-number">A.3</span> Aesthetic mapping</a><ul class="nav navbar-nav">
<li><a class="nav-link" href="#faq-inherit-aes"><span class="header-section-number">A.3.1</span> Inherit aesthetic mapping</a></li>
<li><a class="nav-link" href="#faq-dollar-aes"><span class="header-section-number">A.3.2</span> Never use $ in aesthetic mapping</a></li>
</ul>
</li>
<li>
<a class="nav-link" href="#faq-text"><span class="header-section-number">A.4</span> Text &amp; Label</a><ul class="nav navbar-nav">
<li><a class="nav-link" href="#faq-label-truncated"><span class="header-section-number">A.4.1</span> Tip label truncated</a></li>
<li><a class="nav-link" href="#faq-modify-label"><span class="header-section-number">A.4.2</span> Modify (tip) labels</a></li>
<li><a class="nav-link" href="#faq-formatting-label"><span class="header-section-number">A.4.3</span> Formatting (tip) labels</a></li>
<li><a class="nav-link" href="#faq-ggrepel"><span class="header-section-number">A.4.4</span> Avoid overlapping text labels</a></li>
<li><a class="nav-link" href="#faq-bootstrap"><span class="header-section-number">A.4.5</span> Bootstrap values from Newick format</a></li>
</ul>
</li>
<li>
<a class="nav-link" href="#branch-setting"><span class="header-section-number">A.5</span> Branch setting</a><ul class="nav navbar-nav">
<li><a class="nav-link" href="#plot-the-same-tree-as-in-plot.phylo"><span class="header-section-number">A.5.1</span> Plot the same tree as in plot.phylo()</a></li>
<li><a class="nav-link" href="#specifying-the-order-of-the-tips"><span class="header-section-number">A.5.2</span> Specifying the order of the tips</a></li>
<li><a class="nav-link" href="#shrink-outlier-long-branch"><span class="header-section-number">A.5.3</span> Shrink outlier long branch</a></li>
<li><a class="nav-link" href="#bind-tip"><span class="header-section-number">A.5.4</span> Attach a new tip to a tree</a></li>
<li><a class="nav-link" href="#change-colors-or-line-types-of-arbitrarily-selected-branches"><span class="header-section-number">A.5.5</span> Change colors or line types of arbitrarily selected branches</a></li>
<li><a class="nav-link" href="#arbitrary-point"><span class="header-section-number">A.5.6</span> Add an arbitrary point to a branch</a></li>
</ul>
</li>
<li><a class="nav-link" href="#different-x-axis-labels-for-different-facet-panels"><span class="header-section-number">A.6</span> Different x-axis labels for different facet panels</a></li>
<li><a class="nav-link" href="#faq-under-the-tree"><span class="header-section-number">A.7</span> Plot something behind the phylogeny</a></li>
<li><a class="nav-link" href="#faq-enlarge-center-space"><span class="header-section-number">A.8</span> Enlarge center space in circular/fan layout tree</a></li>
<li><a class="nav-link" href="#use-the-most-distant-tip-from-the-root-as-the-origin-of-the-time-scale"><span class="header-section-number">A.9</span> Use the most distant tip from the root as the origin of the time scale</a></li>
<li><a class="nav-link" href="#circular-blank"><span class="header-section-number">A.10</span> Remove blank margins for circular layout tree</a></li>
<li><a class="nav-link" href="#export-edit"><span class="header-section-number">A.11</span> Edit tree graphic details</a></li>
</ul>

      <div class="book-extra">
        <ul class="list-unstyled">
          
        </ul>
</div>
    </nav>
</div>

</div>
</div> <!-- .container -->

<footer class="bg-primary text-light mt-5"><div class="container"><div class="row">

  <div class="col-12 col-md-6 mt-3">
    <p>"<strong>Data Integration, Manipulation and Visualization of Phylogenetic Trees</strong>" was written by Guangchuang Yu. It was last built on 2021-11-09.</p>
  </div>

  <div class="col-12 col-md-6 mt-3">
    <p>This book was built by the <a class="text-light" href="https://bookdown.org">bookdown</a> R package.</p>
  </div>

</div></div>
</footer><!-- dynamically load mathjax for compatibility with self-contained --><script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script><script type="text/x-mathjax-config">const popovers = document.querySelectorAll('a.footnote-ref[data-toggle="popover"]');
for (let popover of popovers) {
  const div = document.createElement('div');
  div.setAttribute('style', 'position: absolute; top: 0, left:0; width:0, height:0, overflow: hidden; visibility: hidden;');
  div.innerHTML = popover.getAttribute('data-content');

  var has_math = div.querySelector("span.math");
  if (has_math) {
    document.body.appendChild(div);
    MathJax.Hub.Queue(["Typeset", MathJax.Hub, div]);
    MathJax.Hub.Queue(function() {
      popover.setAttribute('data-content', div.innerHTML);
      document.body.removeChild(div);
    })
  }
}
</script>
</body>
</html>
